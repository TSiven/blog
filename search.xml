<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä¸­é—´ä»¶Dockerå®¹å™¨ç¯å¢ƒéƒ¨ç½²</title>
      <link href="//posts/1c6433c8.html"/>
      <url>//posts/1c6433c8.html</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€mysql"><a href="#ä¸€ã€mysql" class="headerlink" title="ä¸€ã€mysql"></a>ä¸€ã€mysql</h2><h3 id="1-åˆ›å»º-data-mysqlç›®å½•ï¼š"><a href="#1-åˆ›å»º-data-mysqlç›®å½•ï¼š" class="headerlink" title="1. åˆ›å»º/data/mysqlç›®å½•ï¼š"></a>1. åˆ›å»º/data/mysqlç›®å½•ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/mysql/</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨-data-mysql-confç›®å½•ä¸‹åˆ›å»ºmy-cnfæ–‡ä»¶"><a href="#2-åœ¨-data-mysql-confç›®å½•ä¸‹åˆ›å»ºmy-cnfæ–‡ä»¶" class="headerlink" title="2. åœ¨/data/mysql/confç›®å½•ä¸‹åˆ›å»ºmy.cnfæ–‡ä»¶"></a>2. åœ¨/data/mysql/confç›®å½•ä¸‹åˆ›å»ºmy.cnfæ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /data/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure><a id="more"></a><p>è¯¥æ–‡ä»¶ä¸ºmysqlé…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">pid-file    = /var/run/mysqld/mysqld.pid</span><br><span class="line">socket      = /var/run/mysqld/mysqld.sock</span><br><span class="line">log-error   = /var/run/mysqld/logs/error.log</span><br><span class="line">datadir     = /var/lib/mysql</span><br><span class="line"></span><br><span class="line">user = mysql</span><br><span class="line">tmpdir = /tmp</span><br><span class="line"></span><br><span class="line">default-storage-engine=INNODB </span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server = utf8_general_ci </span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br></pre></td></tr></table></figure></p><h3 id="3-æ‹‰å–mysqlé•œåƒï¼š"><a href="#3-æ‹‰å–mysqlé•œåƒï¼š" class="headerlink" title="3. æ‹‰å–mysqlé•œåƒï¼š"></a>3. æ‹‰å–mysqlé•œåƒï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.6</span><br></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºå¹¶è¿è¡Œmysqlå®¹å™¨ï¼š"><a href="#4-åˆ›å»ºå¹¶è¿è¡Œmysqlå®¹å™¨ï¼š" class="headerlink" title="4. åˆ›å»ºå¹¶è¿è¡Œmysqlå®¹å™¨ï¼š"></a>4. åˆ›å»ºå¹¶è¿è¡Œmysqlå®¹å™¨ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --name mysql \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --privileged=true \</span><br><span class="line">    -p 3306:3306 \</span><br><span class="line">    -e TZ=&quot;Asia/Shanghai&quot; \</span><br><span class="line">    -v /etc/localtime:/etc/localtime \</span><br><span class="line">    -v /data/mysql/my.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf \</span><br><span class="line">    -v /data/mysql/data:/var/lib/mysql \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=p@ssw0rd \</span><br><span class="line">    -d mysql:5.6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">    --name mysql \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --privileged=true \</span><br><span class="line">    -p 3306:3306 \</span><br><span class="line">    -v /data/mysql/data:/var/lib/mysql \</span><br><span class="line">    -v /data/mysql/conf/my.cnf:/etc/mysql/conf.d/mysqld.cnf \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=p@ssw0rd \</span><br><span class="line">    -d mysql:5.6</span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¯´æ˜</strong></p><ul><li>â€“name mysqlï¼šæŒ‡å®šå®¹å™¨åç§°</li><li>â€“restart=alwaysï¼šéšdockerä¸»æœºå¯åŠ¨è€Œå¯åŠ¨</li><li>â€“privileged=true: ä½¿ç”¨è¯¥å‚æ•°ï¼Œcontainerå†…çš„rootæ‹¥æœ‰çœŸæ­£çš„rootæƒé™, å¦åˆ™ï¼Œcontainerå†…çš„rootåªæ˜¯å¤–éƒ¨çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æƒé™ã€‚</li><li>-p 3306:3306ï¼šå°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£</li><li>-v /data/mysql/conf/my.cnf:/etc/mysql/conf.d/mysqld.cnfï¼šå°†ä¸»æœº/data/mysql/cnf/my.cnfæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„/etc/mysql/mysql.conf.d/mysqld.cnf</li><li>-v /data/mysql/data:/var/lib/mysqlï¼šå°†ä¸»æœº/data/mysql/dataæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„/var/lib/mysql</li><li>-e MYSQL_ROOT_PASSWORD=p@ssw0rdï¼šåˆå§‹åŒ–rootç”¨æˆ·çš„å¯†ç </li><li>-dï¼šåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</li><li>mysql:5.6: mysqlé•œåƒåç§°</li></ul><h2 id="äºŒã€rabbitmq"><a href="#äºŒã€rabbitmq" class="headerlink" title="äºŒã€rabbitmq"></a>äºŒã€rabbitmq</h2><h3 id="1-åˆ›å»º-data-rabbitmqç›®å½•ï¼š"><a href="#1-åˆ›å»º-data-rabbitmqç›®å½•ï¼š" class="headerlink" title="1. åˆ›å»º/data/rabbitmqç›®å½•ï¼š"></a>1. åˆ›å»º/data/rabbitmqç›®å½•ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/rabbitmq</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨-data-rabbitmqç›®å½•ä¸‹åˆ›å»ºrabbitmq-confæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºrabbitmqé…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š"><a href="#2-åœ¨-data-rabbitmqç›®å½•ä¸‹åˆ›å»ºrabbitmq-confæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºrabbitmqé…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š" class="headerlink" title="2. åœ¨/data/rabbitmqç›®å½•ä¸‹åˆ›å»ºrabbitmq.confæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºrabbitmqé…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š"></a>2. åœ¨/data/rabbitmqç›®å½•ä¸‹åˆ›å»ºrabbitmq.confæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºrabbitmqé…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loopback_users.guest = false</span><br><span class="line">listeners.tcp.default = 5672</span><br><span class="line">default_pass = admin</span><br><span class="line">default_user = admin</span><br><span class="line">hipe_compile = false</span><br></pre></td></tr></table></figure><h3 id="3-æ‹‰å–rabbitmqé•œåƒï¼š"><a href="#3-æ‹‰å–rabbitmqé•œåƒï¼š" class="headerlink" title="3. æ‹‰å–rabbitmqé•œåƒï¼š"></a>3. æ‹‰å–rabbitmqé•œåƒï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:management</span><br></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºå¹¶è¿è¡Œrabbitmqå®¹å™¨ï¼š"><a href="#4-åˆ›å»ºå¹¶è¿è¡Œrabbitmqå®¹å™¨ï¼š" class="headerlink" title="4. åˆ›å»ºå¹¶è¿è¡Œrabbitmqå®¹å™¨ï¼š"></a>4. åˆ›å»ºå¹¶è¿è¡Œrabbitmqå®¹å™¨ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --name rabbit \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --privileged=true \</span><br><span class="line">    -p 15672:15672 \</span><br><span class="line">    -p 5672:5672 \</span><br><span class="line">    -e TZ=&quot;Asia/Shanghai&quot; \</span><br><span class="line">    -v /etc/localtime:/etc/localtime \</span><br><span class="line">    -v /data/rabbitmq:/var/lib/rabbitmq \</span><br><span class="line">    -e RABBITMQ_DEFAULT_USER=admin \</span><br><span class="line">    -e RABBITMQ_DEFAULT_PASS=admin \</span><br><span class="line">    -d rabbitmq:3.7-management</span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¯´æ˜</strong></p><ul><li>â€“name rabbitï¼šæŒ‡å®šå®¹å™¨åç§°</li><li>â€“restart=alwaysï¼šéšdockerä¸»æœºå¯åŠ¨è€Œå¯åŠ¨</li><li>-p 15672:15672ï¼šå°†å®¹å™¨çš„15672ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„15672ç«¯å£</li><li>-p 5672:5672ï¼šå°†å®¹å™¨çš„5672ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„5672ç«¯å£</li><li>-v /data/rabbitmq:/var/lib/rabbitmqï¼šå°†ä¸»æœº/data/rabbitmqæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„/var/lib/rabbitmq</li><li>-e RABBITMQ_DEFAULT_USER=adminï¼šåˆå§‹åŒ–ç”¨æˆ·å</li><li>-e RABBITMQ_DEFAULT_PASS=hongte888ï¼šåˆå§‹åŒ–å¯†ç </li><li>-dï¼šåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</li><li>rabbitmq:3.7-management: é•œåƒåç§°</li></ul><h3 id="5-è®¿é—®rabbitmq"><a href="#5-è®¿é—®rabbitmq" class="headerlink" title="5. è®¿é—®rabbitmq"></a>5. è®¿é—®rabbitmq</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:15672/</span><br><span class="line">è´¦å·å¯†ç ï¼šadmin/admin</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€redis"><a href="#ä¸‰ã€redis" class="headerlink" title="ä¸‰ã€redis"></a>ä¸‰ã€redis</h2><h3 id="1-åˆ›å»º-data-redisç›®å½•ï¼š"><a href="#1-åˆ›å»º-data-redisç›®å½•ï¼š" class="headerlink" title="1. åˆ›å»º/data/redisç›®å½•ï¼š"></a>1. åˆ›å»º/data/redisç›®å½•ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/mysql</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨-data-redisç›®å½•ä¸‹åˆ›å»ºredis-confæ–‡ä»¶ï¼ˆæ–‡ä»¶å†…å®¹é»˜è®¤ä¸ºç©ºï¼‰ï¼Œè¯¥æ–‡ä»¶ä¸ºredisçš„é…ç½®æ–‡ä»¶ï¼›"><a href="#2-åœ¨-data-redisç›®å½•ä¸‹åˆ›å»ºredis-confæ–‡ä»¶ï¼ˆæ–‡ä»¶å†…å®¹é»˜è®¤ä¸ºç©ºï¼‰ï¼Œè¯¥æ–‡ä»¶ä¸ºredisçš„é…ç½®æ–‡ä»¶ï¼›" class="headerlink" title="2. åœ¨/data/redisç›®å½•ä¸‹åˆ›å»ºredis.confæ–‡ä»¶ï¼ˆæ–‡ä»¶å†…å®¹é»˜è®¤ä¸ºç©ºï¼‰ï¼Œè¯¥æ–‡ä»¶ä¸ºredisçš„é…ç½®æ–‡ä»¶ï¼›"></a>2. åœ¨/data/redisç›®å½•ä¸‹åˆ›å»ºredis.confæ–‡ä»¶ï¼ˆæ–‡ä»¶å†…å®¹é»˜è®¤ä¸ºç©ºï¼‰ï¼Œè¯¥æ–‡ä»¶ä¸ºredisçš„é…ç½®æ–‡ä»¶ï¼›</h3><h3 id="3-æ‹‰å–redisé•œåƒï¼š"><a href="#3-æ‹‰å–redisé•œåƒï¼š" class="headerlink" title="3. æ‹‰å–redisé•œåƒï¼š"></a>3. æ‹‰å–redisé•œåƒï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:4.0.5</span><br></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºå¹¶è¿è¡Œrediså®¹å™¨ï¼š"><a href="#4-åˆ›å»ºå¹¶è¿è¡Œrediså®¹å™¨ï¼š" class="headerlink" title="4. åˆ›å»ºå¹¶è¿è¡Œrediså®¹å™¨ï¼š"></a>4. åˆ›å»ºå¹¶è¿è¡Œrediså®¹å™¨ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --name redis \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --privileged=true \</span><br><span class="line">    -p 6379:6379 \</span><br><span class="line">    -e TZ=&quot;Asia/Shanghai&quot; \</span><br><span class="line">    -v /etc/localtime:/etc/localtime \</span><br><span class="line">    -v /data/redis/redis.conf:/usr/local/etc/redis/redis.conf \</span><br><span class="line">    -v /data/redis/data:/data  \</span><br><span class="line">    -d redis:4.0.5 \</span><br><span class="line">    redis-server /usr/local/etc/redis/redis.conf\</span><br><span class="line">    --appendonly yes \</span><br><span class="line">    --requirepass &quot;admin&quot;</span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¯´æ˜</strong></p><ul><li>â€“name redisï¼šæŒ‡å®šå®¹å™¨åç§°</li><li>â€“restart=alwaysï¼šéšdockerä¸»æœºå¯åŠ¨è€Œå¯åŠ¨</li><li>-p 6379:6379ï¼šå°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£</li><li>-v /data/redis/redis.conf:/usr/local/etc/redis/redis.confï¼šå°†ä¸»æœº/data/redis/redis.confæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„/usr/local/etc/redis/redis.conf</li><li>-v /data/redis/data:/dataï¼šå°†ä¸»æœº/data/redis/dataæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„/data</li><li>-dï¼šåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</li><li>redis:4.0.5: é•œåƒåç§°</li><li>â€“requirepass â€œadminâ€ï¼šredisè®¿é—®å¯†ç </li></ul><h3 id="5-è¿æ¥redisçš„æ–¹æ³•ï¼š"><a href="#5-è¿æ¥redisçš„æ–¹æ³•ï¼š" class="headerlink" title="5. è¿æ¥redisçš„æ–¹æ³•ï¼š"></a>5. è¿æ¥redisçš„æ–¹æ³•ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it redis redis-cli -a hongte888</span><br></pre></td></tr></table></figure><h2 id="å››ã€nexus"><a href="#å››ã€nexus" class="headerlink" title="å››ã€nexus"></a>å››ã€nexus</h2><h3 id="1-åˆ›å»º-data-nexus-dataç›®å½•ï¼š"><a href="#1-åˆ›å»º-data-nexus-dataç›®å½•ï¼š" class="headerlink" title="1. åˆ›å»º/data/nexus/dataç›®å½•ï¼š"></a>1. åˆ›å»º/data/nexus/dataç›®å½•ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/nexus &amp;&amp; mkdir /data/nexus/data &amp;&amp; chown -R 200 /data/nexus/data</span><br></pre></td></tr></table></figure><h3 id="2-æ‹‰å–nexus3é•œåƒï¼š"><a href="#2-æ‹‰å–nexus3é•œåƒï¼š" class="headerlink" title="2. æ‹‰å–nexus3é•œåƒï¼š"></a>2. æ‹‰å–nexus3é•œåƒï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nexus3:3.8.0</span><br></pre></td></tr></table></figure><h3 id="3-åˆ›å»ºå¹¶è¿è¡Œnexus3å®¹å™¨ï¼š"><a href="#3-åˆ›å»ºå¹¶è¿è¡Œnexus3å®¹å™¨ï¼š" class="headerlink" title="3. åˆ›å»ºå¹¶è¿è¡Œnexus3å®¹å™¨ï¼š"></a>3. åˆ›å»ºå¹¶è¿è¡Œnexus3å®¹å™¨ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --name nexus \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --privileged=true \</span><br><span class="line">    -p 8081:8081 \</span><br><span class="line">    -e TZ=&quot;Asia/Shanghai&quot; \</span><br><span class="line">    -v /etc/localtime:/etc/localtime \</span><br><span class="line">    -v /data/nexus/data:/nexus-data \</span><br><span class="line">    -d nexus3:3.8.0</span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¯´æ˜</strong></p><ul><li>â€“name nexusï¼šæŒ‡å®šå®¹å™¨åç§°</li><li>â€“restart=alwaysï¼šéšdockerä¸»æœºå¯åŠ¨è€Œå¯åŠ¨</li><li>-p 8081:8081ï¼šå°†å®¹å™¨çš„8081ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8081ç«¯å£</li><li>-v /data/nexus/data:/nexus-dataï¼šå°†ä¸»æœº/data/nexus/dataæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„/nexus-data</li><li>-dï¼šåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</li><li>nexus3:3.8.0: é•œåƒåç§°</li></ul><h3 id="4-è®¿é—®nexus"><a href="#4-è®¿é—®nexus" class="headerlink" title="4. è®¿é—®nexus"></a>4. è®¿é—®nexus</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.200.111:8081/</span><br><span class="line">é»˜è®¤è´¦å·å¯†ç ï¼šadmin/admin123</span><br></pre></td></tr></table></figure><h2 id="äº”ã€jenkins"><a href="#äº”ã€jenkins" class="headerlink" title="äº”ã€jenkins"></a>äº”ã€jenkins</h2><h3 id="1-åˆ›å»º-data-jenkinsç›®å½•ï¼š"><a href="#1-åˆ›å»º-data-jenkinsç›®å½•ï¼š" class="headerlink" title="1. åˆ›å»º/data/jenkinsç›®å½•ï¼š"></a>1. åˆ›å»º/data/jenkinsç›®å½•ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/jenkins &amp;&amp; chown -R 1000 /data/jenkins</span><br></pre></td></tr></table></figure><h3 id="2-æ‹‰å–jenkinsé•œåƒï¼š"><a href="#2-æ‹‰å–jenkinsé•œåƒï¼š" class="headerlink" title="2. æ‹‰å–jenkinsé•œåƒï¼š"></a>2. æ‹‰å–jenkinsé•œåƒï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull jenkins/jenkins:2.138.2</span><br></pre></td></tr></table></figure><h3 id="3-åˆ›å»ºå¹¶è¿è¡Œjenkinså®¹å™¨ï¼š"><a href="#3-åˆ›å»ºå¹¶è¿è¡Œjenkinså®¹å™¨ï¼š" class="headerlink" title="3. åˆ›å»ºå¹¶è¿è¡Œjenkinså®¹å™¨ï¼š"></a>3. åˆ›å»ºå¹¶è¿è¡Œjenkinså®¹å™¨ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --name jenkins \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --privileged=true \</span><br><span class="line">    --net=host \</span><br><span class="line">    -e TZ=&quot;Asia/Shanghai&quot; \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock   \</span><br><span class="line">    -v /usr/bin/docker:/usr/bin/docker  \</span><br><span class="line">    -v /usr/lib64/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7 \</span><br><span class="line">    -v /etc/localtime:/etc/localtime \</span><br><span class="line">    -v /data/jenkins:/var/jenkins_home \</span><br><span class="line">    -v /data/apache-maven-3.5.4:/data/apache-maven-3.5.4 \</span><br><span class="line">    --env JAVA_OPTS=&quot;-Djava.util.logging.config.file=/var/jenkins_home/log.properties&quot; \</span><br><span class="line">    -d jenkins/jenkins:2.138.2</span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¯´æ˜</strong></p><ul><li>â€“name jenkinsï¼šæŒ‡å®šå®¹å™¨åç§°</li><li>â€“restart=alwaysï¼šéšdockerä¸»æœºå¯åŠ¨è€Œå¯åŠ¨</li><li>-p 8080:8080ï¼šå°†å®¹å™¨çš„8080ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8080ç«¯å£</li><li>-p 50000:50000ï¼šå°†å®¹å™¨çš„50000ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„50000ç«¯å£</li><li>-v /data/jenkins:/var/jenkins_homeï¼šå°†ä¸»æœº<code>/data/jenkins</code>æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„<code>/ver/jenkins_home</code></li><li>-v /data/apache-maven-3.5.2:/data/apache-maven-3.5.2ï¼šå°†ä¸»æœº<code>/data/apache-maven-3.5.2</code>æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„<code>/data/apache-maven-3.5.2</code>ï¼Œç”±äºjenkinså®¹å™¨å†…æ²¡æœ‰å®‰è£…mavenï¼Œæ‰€ä»¥éœ€è¦å¤–æŒ‚mavenåˆ°å®¹å™¨å†…</li><li>-dï¼šåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</li><li>jenkins:2.89.4: é•œåƒåç§°</li></ul><p><strong>æ³¨æ„</strong><br>dockeråœ¨å®¹å™¨å†…æ„å»ºçš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°æƒé™ä¸å¤Ÿä»€ä¹ˆçš„ã€‚å¯ä»¥åœ¨å®¿ä¸»æœºä¸­ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 /var/run/docker.sock</span><br><span class="line">æˆ–è€…</span><br><span class="line">usermod -a -G docker jenkin</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">### 4. è®¿é—®jenkins</span><br></pre></td></tr></table></figure></p><p><a href="http://172.16.200.111:8080/" target="_blank" rel="noopener">http://172.16.200.111:8080/</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## å…­ã€mongo</span><br><span class="line">### 1. æ‹‰å–mongoé•œåƒï¼š</span><br></pre></td></tr></table></figure></p><p>docker pull mongo:3.4.1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### 2. åˆ›å»ºå¹¶è¿è¡Œmongoå®¹å™¨ï¼š</span><br></pre></td></tr></table></figure></p><p>docker run \<br>    â€“name mongo \<br>    â€“restart=always \<br>    â€“privileged=true \<br>    -p 27017:27017 \<br>    -e TZ=â€Asia/Shanghaiâ€ \<br>    -v /etc/localtime:/etc/localtime \<br>    -v /data/mongo/datadir:/data/db \<br>    -d mongo:3.4.1 â€“auth<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">**å‘½ä»¤è¯´æ˜**</span><br><span class="line"></span><br><span class="line">- --name mongoï¼šæŒ‡å®šå®¹å™¨åç§°</span><br><span class="line">- --restart=alwaysï¼šéšdockerä¸»æœºå¯åŠ¨è€Œå¯åŠ¨</span><br><span class="line">- -p 27017:27017ï¼šå°†å®¹å™¨çš„27017ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„27017ç«¯å£</span><br><span class="line">- -v /data/mongo/datadir:/data/dbï¼šå°†ä¸»æœº`/data/mongo/datadir`æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„`/data/db`</span><br><span class="line">- -dï¼šåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</span><br><span class="line">- mongo:3.4.1: é•œåƒåç§°</span><br><span class="line"></span><br><span class="line">### 3. åˆ›å»ºè´¦å·å¯†ç ï¼š</span><br></pre></td></tr></table></figure></p><p>docker exec -it mongo mongo admin</p><p>connecting to: admin</p><blockquote><p>db.createUser({ user: â€˜rootâ€™, pwd: â€˜hongte888â€™, roles: [ { role: â€œrootâ€, db: â€œadminâ€ } ] });<br>Successfully added user: {<br>    â€œuserâ€ : â€œrootâ€,<br>    â€œrolesâ€ : [<br>        {<br>            â€œroleâ€ : â€œrootâ€,<br>            â€œdbâ€ : â€œadminâ€<br>        }<br>    ]<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## å…­ã€sonar</span><br><span class="line">### 1. åœ¨mysqlæ•°æ®åº“ä¸­åˆ›å»ºsonarï¼Œå¹¶åˆ›å»ºç‹¬ç«‹çš„è´¦å·å¯†ç ç”¨äºæ“ä½œsonaræ•°æ®åº“ã€‚</span><br><span class="line">### 2. æ‹‰å–sonaré•œåƒï¼š</span><br></pre></td></tr></table></figure></p></blockquote><p>docker pull sonarqube:7.0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### 3. åˆ›å»ºå¹¶ä¸”å¯åŠ¨å®¹å™¨</span><br></pre></td></tr></table></figure></p><p>docker run \<br>    â€“name sonar \<br>    â€“restart=always \<br>    â€“privileged=true \<br>    -p 9000:9000 \<br>    -p 9092:9092 \<br>    -e TZ=â€Asia/Shanghaiâ€ \<br>    -v /etc/localtime:/etc/localtime \<br>    -e SONARQUBE_JDBC_USERNAME=sonar \<br>    -e SONARQUBE_JDBC_PASSWORD=1vgne9Xu \<br>    -e SONARQUBE_JDBC_URL=jdbc:mysql://172.16.200.111:3306/sonar?useUnicode=true\&amp;characterEncoding=utf8 \<br>    -d sonarqube:7.0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">**å‘½ä»¤è¯´æ˜**</span><br><span class="line"></span><br><span class="line">- --name sonarï¼šæŒ‡å®šå®¹å™¨åç§°</span><br><span class="line">- --restart=alwaysï¼šéšdockerä¸»æœºå¯åŠ¨è€Œå¯åŠ¨</span><br><span class="line">- -p 9000:9000ï¼šå°†å®¹å™¨çš„9000ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„9000ç«¯å£</span><br><span class="line">- -p 9092:9092ï¼šå°†å®¹å™¨çš„9092ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„9092ç«¯å£</span><br><span class="line">- -e SONARQUBE_JDBC_USERNAME=sonarï¼šè¿æ¥æ•°æ®åº“çš„è´¦å·</span><br><span class="line">- -e SONARQUBE_JDBC_PASSWORD=1vgne9Xuï¼šè¿æ¥æ•°æ®åº“çš„å¯†ç </span><br><span class="line">- -e SONARQUBE_JDBC_URL=jdbc:mysql://mysql_server:3306/sonar?useUnicode=true\&amp;characterEncoding=utf8ï¼šè¿æ¥æ•°æ®åº“çš„jdbcurlï¼Œæ³¨æ„`useUnicode=true\&amp;characterEncoding=utf8`æ˜¯å¿…é¡»åŠ çš„</span><br><span class="line">- -dï¼šåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</span><br><span class="line">- sonarqube:7.0: é•œåƒåç§°</span><br><span class="line"></span><br><span class="line">### 4. æ±‰åŒ–sonar</span><br><span class="line">### 1. [ä¸‹è½½æ±‰åŒ–åŒ…](https://github.com/SonarQubeCommunity/sonar-l10n-zh)</span><br><span class="line">### 2. è½½åï¼Œæ”¾å…¥sonarç›®å½•ï¼Œå¦‚ï¼šsonarqube-5.6\extensions\plugins</span><br><span class="line">### 3. dockeré€šè¿‡ä»¥ä¸‹å‘½ä»¤æ”¾å…¥å®¹å™¨ä¸­ï¼š</span><br></pre></td></tr></table></figure></p><p>docker cp /data/sonar/sonar-l10n-zh-plugin-1.20.jar sonar:/opt/sonarqube/extensions/plugins<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### 4. è®¿é—®sonar</span><br></pre></td></tr></table></figure></p><p><a href="http://172.16.200.111:9000/" target="_blank" rel="noopener">http://172.16.200.111:9000/</a><br>è´¦å·å¯†ç ï¼šadmin/admin<br><code>`</code></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç§‘å­¦ä¸Šç½‘</title>
      <link href="//posts/812d49a5.html"/>
      <url>//posts/812d49a5.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è‡ªå»ºç§‘å­¦ä¸Šç½‘å…±äº«å·¥å…·ï¼Œç°å¼€æ”¾æ³¨å†Œï¼Œæ¬¢è¿ä½¿ç”¨ï¼š <a href="http://vpn.siven.net" target="_blank" rel="noopener">http://vpn.siven.net</a></p><p>æœåŠ¡æ˜¯åŸºäºssserveræ­å»ºï¼Œéœ€è¦å®‰è£…shadowsockså®¢æˆ·ç«¯æ–¹å¯ä½¿ç”¨ï¼Œä»¥ä¸‹ä¸ºWindowsã€Mac OSã€Androidå’ŒiOSä¸‹è½½sså®¢æˆ·ç«¯åŠé…ç½®æ–¹æ³•ï¼Œä»¥ä¾›å‚è€ƒã€‚å¦‚æœ‰ä»»ä½•ä½¿ç”¨ç–‘é—®ï¼Œå¯éšæ—¶<a href="http://chat.daovoice.io?id=0b11d332" target="_blank" rel="noopener">ä¸æˆ‘è”ç³»</a>ğŸ˜Šã€‚</p><h1 id="å®¢æˆ·ç«¯åˆ—è¡¨"><a href="#å®¢æˆ·ç«¯åˆ—è¡¨" class="headerlink" title="å®¢æˆ·ç«¯åˆ—è¡¨"></a>å®¢æˆ·ç«¯åˆ—è¡¨</h1><ul><li><a href="https://github.com/shadowsocks/shadowsocks-windows/releases" target="_blank" rel="noopener">Windows</a></li><li><a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases" target="_blank" rel="noopener">Mac OS</a></li><li><a href="https://github.com/shadowsocks/shadowsocks-android/releases" target="_blank" rel="noopener">Android</a></li></ul><a id="more"></a><hr><p>IOSå®¢æˆ·ç«¯å®‰è£…åŠæ³•ï¼šç›´æ¥åœ¨ã€ŒApp Storeã€é‡Œæœç´¢<code>shadowsock</code>å…³é”®å­—ï¼ˆæˆ–è€…<code>wingy</code>å…³é”®å­—ï¼‰ï¼Œè½¯ä»¶ç»å¸¸è¢«ä¸‹æ¶ï¼Œæˆ‘ç›®å‰ç”¨çš„æ˜¯<code>SuperWingy</code> &amp; Shadowrocket~å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡PPåŠ©æ‰‹å»ä¸‹è½½Shadowrocketã€‚<br>æ”¶è´¹è½¯ä»¶ï¼šã€ŒSuperWingyã€ï¼Œã€ŒShadowBrokenã€ã€‚æ¨èå…è´¹ä¸‹è½½iOSå®¢æˆ·ç«¯æ–¹æ³•ï¼šä¹Ÿå¯ä»¥ç”µè„‘ä¸‹è½½PPåŠ©æ‰‹ï¼Œæ‰‹æœºè¿ä¸Šç”µè„‘åä¼šè‡ªåŠ¨å°†PPåŠ©æ‰‹åŒæ­¥è‡³æ‰‹æœºï¼Œä¸éœ€è¦è¶Šç‹±ï¼Œä¹‹ååœ¨æ‰‹æœºä¸Šé€šè¿‡PPåŠ©æ‰‹ä¸‹è½½shadowrocket</p><h1 id="é…ç½®æ–¹æ³•"><a href="#é…ç½®æ–¹æ³•" class="headerlink" title="é…ç½®æ–¹æ³•"></a>é…ç½®æ–¹æ³•</h1><p>æ³¨å†Œå®‰è£…å®Œæˆåï¼Œ ç‚¹å‡»â€è´¦å·â€æŒ‰é’®å¯æŸ¥çœ‹IPã€ç«¯å£ã€å¯†ç ã€åŠ å¯†æ–¹å¼ã€äºŒç»´ç ç­‰èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p><ul><li>èŠ‚ç‚¹ä¿¡æ¯:<br><img src="http://qiniu-pic.siven.net/blog/52tmg.png" alt></li></ul><h2 id="å¿«æ·é…ç½®"><a href="#å¿«æ·é…ç½®" class="headerlink" title="å¿«æ·é…ç½®"></a>å¿«æ·é…ç½®</h2><p>ä¸‹è½½å®‰è£…å®¢æˆ·ç«¯åï¼Œå¯ä½¿ç”¨æ‰«æå±å¹•äºŒç»´ç åŠŸèƒ½å¿«æ·æ·»åŠ èŠ‚ç‚¹ä¿¡æ¯(éœ€è¦æ‰“å¼€äºŒç»´ç é¡µç )ï¼Œå®‰å“ã€è‹¹æœç­‰è®¾å¤‡äº¦å¯ä½¿ç”¨å®¢æˆ·ç«¯çš„ã€Œæ‰«æäºŒç»´ç ã€åŠŸèƒ½æ·»åŠ èŠ‚ç‚¹ä¿¡æ¯ã€‚è¿™é‡Œå°±ä¸åšæ¼”ç¤ºï¼Œè‡ªè¡Œç ”ç©¶ä¸€ä¸‹å°±æ˜ç™½äº† ğŸ˜Š</p><ul><li>æ‰«æå±å¹•äºŒç»´ç :<br><img src="http://qiniu-pic.siven.net/blog/rnh2b.png" alt></li></ul><ul><li>Mac OS æ·»åŠ èŠ‚ç‚¹ç¤ºä¾‹:<br><img src="http://qiniu-pic.siven.net/blog/gol85.gif" alt></li></ul><h2 id="Windowså®¢æˆ·ç«¯"><a href="#Windowså®¢æˆ·ç«¯" class="headerlink" title="Windowså®¢æˆ·ç«¯"></a>Windowså®¢æˆ·ç«¯</h2><p>ä¸‹è½½å¥½Shadowsocks.zipï¼Œè§£å‹ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªShadowsocks.exeã€‚æ‰“å¼€ï¼Œè¾“å…¥è‡ªå·±çš„æœåŠ¡å™¨ipã€ç«¯å£ã€å¯†ç ï¼š<br><img src="http://qiniu-pic.siven.net/blog/dssa7.jpg" alt></p><p>ç¡®å®šååœ¨ç”µè„‘å³ä¸‹è§’é£æœºå›¾æ ‡ç‚¹å¯åŠ¨ç³»ç»Ÿä»£ç†ï¼Œç³»ç»Ÿä»£ç†æ¨¡å¼æœ‰PACæ¨¡å¼å’Œå…¨å±€æ¨¡å¼ï¼Œå‰è€…æ˜¯åªæœ‰è¢«å¢™çš„ç½‘ç«™ç”¨vpsä»£ç†ï¼Œåè€…æ˜¯æ‰€æœ‰è¿æ¥èµ°ä»£ç†<br><img src="http://qiniu-pic.siven.net/blog/261d6.jpg" alt></p><h2 id="Androidå®¢æˆ·ç«¯"><a href="#Androidå®¢æˆ·ç«¯" class="headerlink" title="Androidå®¢æˆ·ç«¯"></a>Androidå®¢æˆ·ç«¯</h2><p>å®‰è£…ä¸‹è½½çš„apkæ–‡ä»¶ï¼Œå®‰è£…å®Œæˆåæ‰“å¼€â€œå½±æ¢­â€ï¼Œç‚¹å‡»â€œæ‰‹åŠ¨è®¾ç½®â€<br><img src="http://qiniu-pic.siven.net/blog/ol45p.jpg" alt></p><p>å¡«å†™æœåŠ¡å™¨ä¿¡æ¯<br><img src="http://qiniu-pic.siven.net/blog/nkaef.jpg" alt></p><p>ä¸ºäº†æœ‰æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œæˆ‘å¼ºçƒˆå»ºè®®å¦‚ä¸‹è®¾ç½®ã€‚</p><blockquote><p>åŠŸèƒ½è®¾ç½®é‡Œçš„è·¯ç”±ï¼Œç”±åŸæ¥çš„å…¨å±€æ¨¡å¼ï¼Œä¿®æ”¹ä¸ºâ€œç»•è¿‡å±€åŸŸç½‘åŠä¸­å›½å¤§é™†åœ°å€â€ã€‚è¿™æ ·ä¸ä¼šå¹²æ‰°ä½ çš„æ­£å¸¸ä¸Šç½‘ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¸Šç™¾åº¦ã€å¾®åšã€å¾®ä¿¡ä¹‹ç±»çš„ç½‘ç«™æˆ–åº”ç”¨ï¼Œä¸ä¼šå½±å“åˆ°ä½ çš„æµç•…ä½“éªŒã€‚</p></blockquote><p><img src="http://qiniu-pic.siven.net/blog/vxlis.jpg" alt></p><p>æ·»åŠ å®Œé…ç½®åï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹å„é¡¹å‚æ•°ï¼Œå¦‚æœç¡®è®¤æ— è¯¯ï¼Œå°±å¯ä»¥ç‚¹å‡»å³ä¸Šè§’çš„å°é£æœºï¼Œæ§åˆ¶å¼€å§‹å’Œå…³é—­ã€‚ç°è‰²è¡¨ç¤ºå…³é—­çŠ¶æ€ï¼›ç»¿è‰²è¡¨ç¤ºå·²æ‰“å¼€ã€‚<br><img src="http://qiniu-pic.siven.net/blog/jouug.jpg" alt></p><h2 id="Mac-OSå®¢æˆ·ç«¯"><a href="#Mac-OSå®¢æˆ·ç«¯" class="headerlink" title="Mac OSå®¢æˆ·ç«¯"></a>Mac OSå®¢æˆ·ç«¯</h2><p>ä¸‹è½½å®‰è£…åï¼Œç‚¹å‡»é£æœºå›¾æ ‡ï¼Œé€‰æ‹©<code>æœåŠ¡å™¨</code>ï¼Œç‚¹å‡»<code>æœåŠ¡å™¨è®¾ç½®</code><br><img src="http://qiniu-pic.siven.net/blog/f6f40.png" alt></p><p>ç‚¹å‡»å·¦ä¸‹è§’<code>+</code>,å¡«å†™IPï¼Œç«¯å£ï¼Œé€‰æ‹©è®¾ç½®çš„åŠ å¯†æ–¹æ³•ï¼Œå¡«å†™å¯†ç åï¼Œç‚¹å‡»ç¡®å®šå³å¯<br><img src="http://qiniu-pic.siven.net/blog/yjnrz.png" alt></p><h2 id="iOSå®¢æˆ·ç«¯"><a href="#iOSå®¢æˆ·ç«¯" class="headerlink" title="iOSå®¢æˆ·ç«¯"></a>iOSå®¢æˆ·ç«¯</h2><p>ä»¥ä¸‹ä½¿ç”¨çš„å®¢æˆ·ç«¯ä¸º<code>SuperWingy</code>ï¼Œä¸åŒçš„å®¢æˆ·ç«¯å¯èƒ½æœ‰ä¸€äº›å·®å¼‚ï¼Œä»…ä¾›å‚è€ƒï¼›<br>æ·»åŠ æœåŠ¡å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ‰«ä¸€æ‰«äºŒç»´ç æ·»åŠ æœåŠ¡å™¨ï¼ˆæ¨èï¼‰</li><li>ç‚¹å‡»â€œ+â€æŒ‰é’®ï¼Œæ–°å¢æœåŠ¡å™¨</li></ul><p><img src="http://qiniu-pic.siven.net/blog/vmgse.jpg" alt></p><p>é€‰æ‹©<code>SS</code>ç±»å‹<br><img src="http://qiniu-pic.siven.net/blog/40o82.jpg" alt></p><p>å¡«å†™IPï¼Œç«¯å£ï¼Œé€‰æ‹©è®¾ç½®çš„åŠ å¯†æ–¹æ³•ï¼Œå¡«å†™å¯†ç åï¼Œç‚¹å‡»ç¡®å®šå³å¯<br><img src="http://qiniu-pic.siven.net/blog/r26yi.jpg" alt></p><hr><ul><li><a href="https://vultr.aicnm.com/Windowsã€Macã€å®‰å“å’ŒiOSä¸‹è½½sså®¢æˆ·ç«¯åŠé…ç½®æ–¹æ³•/" target="_blank" rel="noopener">å‚è€ƒæ–‡ç« </a></li></ul>]]></content>
      
      
      <categories>
          
          <category> shadowsock </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shadowsock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå¸¸ç”¨å‘½ä»¤</title>
      <link href="//posts/29dc6fe8.html"/>
      <url>//posts/29dc6fe8.html</url>
      
        <content type="html"><![CDATA[<h1 id="Dockeré•œåƒ"><a href="#Dockeré•œåƒ" class="headerlink" title="Dockeré•œåƒ"></a>Dockeré•œåƒ</h1><h2 id="æœç´¢é•œåƒ"><a href="#æœç´¢é•œåƒ" class="headerlink" title="æœç´¢é•œåƒ"></a>æœç´¢é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure><h2 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:latest <span class="comment">#latest:æ˜¯æŒ‡é•œåƒæœ€é«˜ç‰ˆæœ¬å·</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹é•œåƒåˆ—è¡¨"><a href="#æŸ¥çœ‹é•œåƒåˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹é•œåƒåˆ—è¡¨"></a>æŸ¥çœ‹é•œåƒåˆ—è¡¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="æŸ¥çœ‹é•œåƒæ„å»ºè¿‡ç¨‹"><a href="#æŸ¥çœ‹é•œåƒæ„å»ºè¿‡ç¨‹" class="headerlink" title="æŸ¥çœ‹é•œåƒæ„å»ºè¿‡ç¨‹"></a>æŸ¥çœ‹é•œåƒæ„å»ºè¿‡ç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker <span class="built_in">history</span> [OPTIONS] IMAGE</span><br><span class="line">Show the <span class="built_in">history</span> of an image</span><br><span class="line">Options:</span><br><span class="line">        â€â€format string ä½¿ç”¨Goæ¨¡æ¿çš„ç¾è§‚çš„æ‰“å°é•œåƒã€‚</span><br><span class="line">    â€H, â€â€human æ‰“å°äººç±»å¯è¯»çš„å¤§å°å’Œæ—¥æœŸæ ¼å¼(default <span class="literal">true</span>)</span><br><span class="line">        â€â€noâ€trunc ä¸æˆªæ–­è¾“å‡º</span><br><span class="line">    â€q, â€â€quiet åªæ˜¾ç¤ºé•œåƒç¼–å·</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line">Remove one or more images</span><br><span class="line">Options:</span><br><span class="line">    â€f, â€â€force å¼ºåˆ¶åˆ é™¤é•œåƒ</span><br><span class="line">        â€â€noâ€prune ä¸ç§»é™¤è¯¥é•œåƒçš„è¿‡ç¨‹é•œåƒï¼Œé»˜è®¤ç§»é™¤</span><br></pre></td></tr></table></figure><h1 id="Dockerå®¹å™¨"><a href="#Dockerå®¹å™¨" class="headerlink" title="Dockerå®¹å™¨"></a>Dockerå®¹å™¨</h1><h2 id="æŸ¥çœ‹é…ç½®ä¿¡æ¯"><a href="#æŸ¥çœ‹é…ç½®ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é…ç½®ä¿¡æ¯"></a>æŸ¥çœ‹é…ç½®ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å®¹å™¨åˆ—è¡¨"><a href="#æŸ¥çœ‹å®¹å™¨åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹å®¹å™¨åˆ—è¡¨"></a>æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker ps [OPTIONS]</span><br><span class="line">List containers</span><br><span class="line">Options:</span><br><span class="line">    â€a, â€â€all æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ (é»˜è®¤æ˜¾ç¤ºè¿è¡Œ)</span><br><span class="line">    â€f, â€â€filter filter æ ¹æ®æä¾›çš„æ¡ä»¶è¿‡æ»¤æ˜¾ç¤ºçš„å†…å®¹</span><br><span class="line">        â€â€format string ä½¿ç”¨Goæ¨¡æ¿çš„ç¾è§‚çš„æ‰“å°å®¹å™¨ã€‚</span><br><span class="line">    â€n, â€â€last int æ˜¾ç¤ºæœ€åä¸€ä¸ªåˆ›å»ºçš„å®¹å™¨ (includes all states) (default â€1)</span><br><span class="line">    â€l, â€â€latest æ˜¾ç¤ºæœ€æ–°åˆ›å»ºçš„å®¹å™¨ã€‚(includes all states)</span><br><span class="line">        â€â€noâ€trunc ä¸æˆªæ–­è¾“å‡º</span><br><span class="line">    â€q, â€â€quiet åªæ˜¾ç¤ºå®¹å™¨ç¼–å·</span><br><span class="line">    â€s, â€â€size æ˜¾ç¤ºæ€»çš„æ–‡ä»¶å¤§å°</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨"><a href="#åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨" class="headerlink" title="åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨"></a>åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker run [OPTIONS]</span><br><span class="line">Options:</span><br><span class="line">Â Â Â Â -d åå°è¿è¡Œ</span><br><span class="line">Â Â Â Â -it è¿›å…¥å®¹å™¨</span><br><span class="line">Â Â Â Â --name ç»™å®¹å™¨å–å</span><br></pre></td></tr></table></figure><ul><li>éšæœºæ˜ å°„ç«¯å£</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name mynginx nginx</span><br></pre></td></tr></table></figure><ul><li>æŒ‡å®šæ˜ å°„ç«¯å£</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 --name mynginx nginx</span><br></pre></td></tr></table></figure><ul><li>æ˜ å°„å®¿ä¸»æœºæ–‡ä»¶ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name volume-test1 -h nginx -v /data centos</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹å®¿ä¸»æœºæ–‡ä»¶ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format <span class="string">"&#123;&#123;.Mounts&#125;&#125;"</span> volume-test1</span><br></pre></td></tr></table></figure><ul><li>æ˜ å°„å®¿ä¸»æœºæŒ‡å®šæ–‡ä»¶ç›®å½•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name volume-test2 -h nginx -v /root/blog:/root/blog centos</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨ã€åœæ­¢ã€é‡å¯å®¹å™¨"><a href="#å¯åŠ¨ã€åœæ­¢ã€é‡å¯å®¹å™¨" class="headerlink" title="å¯åŠ¨ã€åœæ­¢ã€é‡å¯å®¹å™¨"></a>å¯åŠ¨ã€åœæ­¢ã€é‡å¯å®¹å™¨</h2><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker start [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line">Start one or more stopped containers</span><br><span class="line">Options:</span><br><span class="line">    â€a, â€â€attach å¯åŠ¨ä¸€ä¸ªå®¹å™¨å¹¶æ‰“å°è¾“å‡ºç»“æœå’Œé”™è¯¯</span><br><span class="line">        â€â€checkpoint string ä»è¿™ä¸ªæ£€æŸ¥ç‚¹æ¢å¤</span><br><span class="line">        â€â€checkpointâ€dir string ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰æ£€æŸ¥ç‚¹å­˜å‚¨ç›®å½•</span><br><span class="line">        â€â€detachâ€keys string é‡å†™åˆ†ç¦»å®¹å™¨çš„é”®åºåˆ—</span><br><span class="line">    â€i, â€â€interactive å¯åŠ¨ä¸€ä¸ªå®¹å™¨å¹¶è¿›å…¥äº¤äº’æ¨¡å¼</span><br></pre></td></tr></table></figure><h3 id="é‡å¯"><a href="#é‡å¯" class="headerlink" title="é‡å¯"></a>é‡å¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker restart [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line">Restart one or more containers</span><br><span class="line">Options:</span><br><span class="line">    â€t, â€â€time int åœæ­¢æˆ–è€…é‡å¯å®¹å™¨çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…æ—¶åç³»ç»Ÿå°†æ€æ­»è¿›ç¨‹(default 10)</span><br><span class="line">åœæ­¢</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢"><a href="#åœæ­¢" class="headerlink" title="åœæ­¢"></a>åœæ­¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker stop [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line">Stop one or more running containers</span><br><span class="line">Options:</span><br><span class="line">    â€t, â€â€time int åœæ­¢æˆ–è€…é‡å¯å®¹å™¨çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…æ—¶åç³»ç»Ÿå°†æ€æ­»è¿›ç¨‹(default 10)</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line">Remove one or more containers</span><br><span class="line">Options:</span><br><span class="line">    â€f, â€â€force å¼ºåˆ¶ç§»é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨(uses SIGKILL)</span><br><span class="line">    â€l, â€â€link åˆ é™¤æŒ‡å®šçš„é“¾æ¥</span><br><span class="line">    â€v, â€â€volumes åˆ é™¤ä¸å®¹å™¨å…³è”çš„å·</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker logs [OPTIONS] CONTAINER</span><br><span class="line">Fetch the logs of a container</span><br><span class="line">Options:</span><br><span class="line">        â€â€details å‘æ—¥å¿—æ˜¾ç¤ºé¢å¤–çš„è¯¦ç»†ä¿¡æ¯ã€‚</span><br><span class="line">    â€f, â€â€follow  è·Ÿè¸ªæ—¥å¿—è¾“å‡º</span><br><span class="line">        â€â€since string æ˜¾ç¤ºæŸä¸ªå¼€å§‹æ—¶é—´çš„æ‰€æœ‰æ—¥å¿— (e.g. 2013â€01â€02T13:23:37) or relative</span><br><span class="line">        (e.g. 42m <span class="keyword">for</span> 42 minutes)</span><br><span class="line">        â€â€tail string ä»æ—¥å¿—æœ«å°¾æ˜¾ç¤ºçš„è¡Œæ•°</span><br><span class="line">        (default <span class="string">"all"</span>)</span><br><span class="line">    â€t, â€â€timestamps æ˜¾ç¤ºæ—¶é—´æˆ³</span><br><span class="line">        â€â€until string æ˜¾ç¤ºæŸä¸ªæ—¶é—´æˆ³ä¹‹å‰çš„æ—¥å¿— (e.g. 2013â€01â€02T13:23:37) or relative</span><br><span class="line">    (e.g. 42m <span class="keyword">for</span> 42 minutes)</span><br></pre></td></tr></table></figure><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -t -f --tail=500 PID</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹"><a href="#æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹"></a>æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker top [OPTIONS] CONTAINER [ps OPTIONS]</span><br><span class="line"><span class="comment"># ä¾‹å¦‚ï¼š</span></span><br><span class="line">sudo docker top name/id</span><br></pre></td></tr></table></figure><h2 id="æ·±å…¥å®¹å™¨ä¿¡æ¯"><a href="#æ·±å…¥å®¹å™¨ä¿¡æ¯" class="headerlink" title="æ·±å…¥å®¹å™¨ä¿¡æ¯"></a>æ·±å…¥å®¹å™¨ä¿¡æ¯</h2><p>åŒ…æ‹¬é…ç½®ä¿¡æ¯ï¼Œåç§°ï¼Œå‘½ä»¤ã€ç½‘è·¯é…ç½®ä»¥åŠå¾ˆå¤šæœ‰ç”¨æ•°æ®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Usage: docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br><span class="line">Return lowâ€level information on Docker objects</span><br><span class="line">Options:</span><br><span class="line">    â€f, â€â€format string ä½¿ç”¨ç»™å®šçš„Goæ¨¡æ¿æ ¼å¼åŒ–è¾“å‡º</span><br><span class="line">    â€s, â€â€size å¦‚æœç±»å‹ä¸ºå®¹å™¨ï¼Œåˆ™æ˜¾ç¤ºæ€»æ–‡ä»¶å¤§å°</span><br><span class="line">        â€â€<span class="built_in">type</span> string è¿”å›æŒ‡å®šç±»å‹çš„JSON</span><br></pre></td></tr></table></figure></p><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Â é¦–å…ˆè·å–å®¹å™¨çš„pid</span></span><br><span class="line">docker inspect --format <span class="string">"&#123;&#123;.State.Pid&#125;&#125;"</span> å®¹å™¨å</span><br><span class="line"><span class="comment">## æ ¹æ®è¿›ç¨‹å·è¿›å…¥æŒ‚è½½</span></span><br><span class="line">nsenter --target è¿›ç¨‹å·(Pid) --mount --uts --ipc --net --pid</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç½‘ç»œé…ç½®"><a href="#æŸ¥çœ‹ç½‘ç»œé…ç½®" class="headerlink" title="æŸ¥çœ‹ç½‘ç»œé…ç½®"></a>æŸ¥çœ‹ç½‘ç»œé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect â€â€format <span class="string">'&#123;&#123;.NetworkSettings&#125;&#125;'</span> å®¹å™¨ID</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å®¹å™¨IPåœ°å€"><a href="#æŸ¥çœ‹å®¹å™¨IPåœ°å€" class="headerlink" title="æŸ¥çœ‹å®¹å™¨IPåœ°å€"></a>æŸ¥çœ‹å®¹å™¨IPåœ°å€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect â€â€format <span class="string">'&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;'</span> å®¹å™¨ID</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„IPåœ°å€"><a href="#æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„IPåœ°å€" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„IPåœ°å€"></a>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„IPåœ°å€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect â€â€format=<span class="string">'&#123;&#123;.Name&#125;&#125; â€ &#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;end&#125;&#125;'</span> $(docker ps â€aq)</span><br></pre></td></tr></table></figure><h1 id="Dockerå®¹å™¨è¿›å…¥çš„4ç§æ–¹å¼"><a href="#Dockerå®¹å™¨è¿›å…¥çš„4ç§æ–¹å¼" class="headerlink" title="Dockerå®¹å™¨è¿›å…¥çš„4ç§æ–¹å¼"></a>Dockerå®¹å™¨è¿›å…¥çš„4ç§æ–¹å¼</h1><h2 id="SSHç™»é™†è¿›å®¹å™¨"><a href="#SSHç™»é™†è¿›å®¹å™¨" class="headerlink" title="SSHç™»é™†è¿›å®¹å™¨"></a>SSHç™»é™†è¿›å®¹å™¨</h2><ul><li>æ–¹æ³•1ï¼šéœ€è¦åœ¨å®¹å™¨ä¸­å¯åŠ¨sshdï¼Œå­˜åœ¨å¼€é”€å’Œæ”»å‡»é¢å¢å¤§çš„é—®é¢˜ã€‚åŒæ—¶ä¹Ÿè¿åäº†Dockeræ‰€å€¡å¯¼çš„ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªè¿›ç¨‹<br>çš„åŸåˆ™ã€‚</li><li>æ–¹æ³•2ï¼šéœ€è¦é¢å¤–å­¦ä¹ ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ã€‚</li></ul><h2 id="nsenterã€nsinitç­‰ç¬¬ä¸‰æ–¹å·¥å…·"><a href="#nsenterã€nsinitç­‰ç¬¬ä¸‰æ–¹å·¥å…·" class="headerlink" title="nsenterã€nsinitç­‰ç¬¬ä¸‰æ–¹å·¥å…·"></a>nsenterã€nsinitç­‰ç¬¬ä¸‰æ–¹å·¥å…·</h2><p>æ‰€ä»¥å¤§å¤šæ•°æƒ…å†µæœ€å¥½è¿˜æ˜¯ä½¿ç”¨DockeråŸç”Ÿæ–¹æ³•ï¼ŒDockerç›®å‰ä¸»è¦æä¾›äº†<code>docker exec</code>å’Œ<code>docker attach</code>ä¸¤ä¸ªå‘½<br>ä»¤ã€‚</p><h2 id="docker-attach"><a href="#docker-attach" class="headerlink" title="docker attach"></a>docker attach</h2><p>Docker attachå¯ä»¥attachåˆ°ä¸€ä¸ªå·²ç»è¿è¡Œçš„å®¹å™¨çš„<code>stdin</code>ï¼Œç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„åŠ¨ä½œã€‚<br>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä»è¿™ä¸ª<code>stdin</code>ä¸­<code>exit</code>ï¼Œä¼š<code>å¯¼è‡´å®¹å™¨åœæ­¢</code>ã€‚</p><ol><li><p>å¿…é¡»ä½¿ç”¨<code>/bin/bash</code>å‘½ä»¤åˆ›å»ºçš„å®¹å™¨æ‰èƒ½ä½¿ç”¨Docker attachè¿›å…¥å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run â€itd ubuntu:14.04 /bin/bash</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨<code>docker ps</code>æŸ¥çœ‹åˆ°è¯¥å®¹å™¨ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°±ä½¿ç”¨<code>docker attach</code>è¿›å…¥è¯¥å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker attach 44fc0f0582d9</span><br></pre></td></tr></table></figure></li></ol><h2 id="docker-exec"><a href="#docker-exec" class="headerlink" title="docker exec"></a>docker exec</h2><p>å…³äº-iã€-tå‚æ•°</p><ul><li>-i<br>å¯ä»¥çœ‹å‡ºåªç”¨-iæ—¶ï¼Œç”±äºæ²¡æœ‰åˆ†é…ä¼ªç»ˆç«¯ï¼Œçœ‹èµ·æ¥åƒpipeæ‰§è¡Œä¸€æ ·ã€‚ä½†æ˜¯æ‰§è¡Œç»“æœã€å‘½ä»¤è¿”å›å€¼éƒ½å¯ä»¥æ­£ç¡®<br>è·å–ã€‚</li><li>-it<br>  ä½¿ç”¨-itæ—¶ï¼Œåˆ™å’Œæˆ‘ä»¬å¹³å¸¸æ“ä½œconsoleç•Œé¢ç±»ä¼¼ã€‚è€Œä¸”ä¹Ÿä¸ä¼šåƒ<code>attach</code>æ–¹å¼å› ä¸ºé€€å‡ºï¼Œå¯¼è‡´æ•´ä¸ªå®¹å™¨é€€å‡ºã€‚<br>è¿™ç§æ–¹å¼å¯ä»¥æ›¿ä»£<code>ssh</code>æˆ–è€…<code>nsenter</code>ã€<code>nsinit</code>æ–¹å¼ï¼Œåœ¨å®¹å™¨å†…è¿›è¡Œæ“ä½œã€‚</li><li>-t<br>  å¦‚æœåªä½¿ç”¨-tå‚æ•°ï¼Œåˆ™å¯ä»¥çœ‹åˆ°ä¸€ä¸ªconsoleçª—å£ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤ä¼šå‘ç°ç”±äºæ²¡æœ‰è·å¾—stdinçš„è¾“å‡ºï¼Œæ— æ³•çœ‹<br>åˆ°å‘½ä»¤æ‰§è¡Œæƒ…å†µã€‚<br>å…³äº-då‚æ•°</li><li>-d<br>  åœ¨åå°æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸€ä¸ªå‘½ä»¤éœ€è¦é•¿æ—¶é—´è¿›ç¨‹ï¼Œä½¿ç”¨-då‚æ•°ä¼šå¾ˆå¿«è¿”å›ã€‚ ç¨‹åºåœ¨åå°è¿<br>è¡Œã€‚ å¦‚æœä¸ä½¿ç”¨<code>-d</code>å‚æ•°ï¼Œç”±äºå‘½ä»¤éœ€è¦é•¿æ—¶é—´æ‰§è¡Œï¼Œ<code>docker exec</code>ä¼šå¡ä½ï¼Œä¸€ç›´ç­‰å‘½ä»¤æ‰§è¡Œå®Œæˆ æ‰è¿”å›ã€‚</li></ul><p>ä½¿ç”¨<code>docker exec</code>è¿›å…¥å®¹å™¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="built_in">exec</span> â€it 775c7c9ee1e1 /bin/bash</span><br></pre></td></tr></table></figure></p><h1 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h1><h2 id="åœæ­¢å®¹å™¨-amp-åˆ é™¤å®¹å™¨æ‰€æœ‰å®¹å™¨-æ…ç”¨"><a href="#åœæ­¢å®¹å™¨-amp-åˆ é™¤å®¹å™¨æ‰€æœ‰å®¹å™¨-æ…ç”¨" class="headerlink" title="åœæ­¢å®¹å™¨ &amp; åˆ é™¤å®¹å™¨æ‰€æœ‰å®¹å™¨ (æ…ç”¨)"></a>åœæ­¢å®¹å™¨ &amp; åˆ é™¤å®¹å™¨æ‰€æœ‰å®¹å™¨ (æ…ç”¨)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq)</span><br></pre></td></tr></table></figure><h2 id="æ¸…é™¤åçš„-lt-none-gt-lt-none-gt-é•œåƒ"><a href="#æ¸…é™¤åçš„-lt-none-gt-lt-none-gt-é•œåƒ" class="headerlink" title="æ¸…é™¤åçš„&lt;none&gt;:&lt;none&gt;é•œåƒ"></a>æ¸…é™¤åçš„<code>&lt;none&gt;:&lt;none&gt;</code>é•œåƒ</h2><ul><li>åçš„é•œåƒçš„äº§ç”Ÿ<br><code>docker build</code> æˆ–æ˜¯ <code>pull</code> å‘½ä»¤å°±ä¼šäº§ç”Ÿä¸´æ—¶é•œåƒã€‚å¦‚æœæˆ‘ä»¬ç”¨<code>dockerfile</code>åˆ›å»ºä¸€ä¸ªhelloworldé•œåƒåï¼Œå› ä¸ºç‰ˆæœ¬æ›´æ–°éœ€è¦é‡æ–°åˆ›å»ºï¼Œé‚£ä¹ˆä»¥å‰é‚£ä¸ªç‰ˆæœ¬çš„é•œåƒå°±ä¼š<br>æˆä¸ºä¸´æ—¶é•œåƒã€‚è¿™ä¸ªæ˜¯éœ€è¦åˆ é™¤çš„ã€‚åˆ é™¤å‘½ä»¤è§ä¸‹ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi $(docker images -f <span class="string">"dangling=true"</span> -q)</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¿«é€Ÿè¿›å…¥å®¹å™¨è„šæœ¬"><a href="#å¿«é€Ÿè¿›å…¥å®¹å™¨è„šæœ¬" class="headerlink" title="å¿«é€Ÿè¿›å…¥å®¹å™¨è„šæœ¬"></a>å¿«é€Ÿè¿›å…¥å®¹å™¨è„šæœ¬</h2><ul><li>åˆ›å»ºè„šæœ¬</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim in.sh</span><br></pre></td></tr></table></figure><ul><li>å†…å®¹å¦‚ä¸‹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">CNAME=<span class="variable">$1</span></span><br><span class="line">CPID=$(docker inspect --format <span class="string">"&#123;&#123;.State.Pid&#125;&#125;"</span> <span class="variable">$CNAME</span>)</span><br><span class="line">nsenter --target <span class="string">"<span class="variable">$CPID</span>"</span> --mount --uts --ipc --net --pid</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ–¹å¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./in.sh mynginx</span><br></pre></td></tr></table></figure><h2 id="å®¹å™¨å¼€æœºè‡ªåŠ¨å¯åŠ¨"><a href="#å®¹å™¨å¼€æœºè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="å®¹å™¨å¼€æœºè‡ªåŠ¨å¯åŠ¨"></a>å®¹å™¨å¼€æœºè‡ªåŠ¨å¯åŠ¨</h2><p>åœ¨ä½¿ç”¨<code>docker run</code>å¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨<code>â€“restart</code>å‚æ•°æ¥è®¾ç½®ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run â€m 512m â€â€memoryâ€swap 1G â€it â€p 58080:8080 â€â€restart=always â€â€name bvrfis â€â€</span><br><span class="line">volumesâ€from logdata mytomcat:4.0 /root/run.sh</span><br></pre></td></tr></table></figure></p><ul><li>å‘½ä»¤è¯´æ˜ï¼š<br>  â€“restartå…·ä½“å‚æ•°å€¼è¯¦ç»†ä¿¡æ¯ï¼š<br>  no - å®¹å™¨é€€å‡ºæ—¶ï¼Œä¸é‡å¯å®¹å™¨ï¼›<br>  on-failure - åªæœ‰åœ¨é0çŠ¶æ€é€€å‡ºæ—¶æ‰ä»æ–°å¯åŠ¨å®¹å™¨ï¼›<br>  always - æ— è®ºé€€å‡ºçŠ¶æ€æ˜¯å¦‚ä½•ï¼Œéƒ½é‡å¯å®¹å™¨ã€‚</li></ul><p>å¦‚æœåˆ›å»ºæ—¶æœªæŒ‡å®š <code>â€“restart=always</code> ,å¯é€šè¿‡<code>update</code> å‘½ä»¤è®¾ç½®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update â€â€restart=always xxx</span><br></pre></td></tr></table></figure></p><p>è¿˜å¯ä»¥åœ¨ä½¿ç”¨ <code>on-failure</code> ç­–ç•¥æ—¶ï¼ŒæŒ‡å®šDockerå°†å°è¯•é‡æ–°å¯åŠ¨å®¹å™¨çš„æœ€å¤§æ¬¡æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerå°†å°è¯•æ°¸è¿œé‡æ–°<br>å¯åŠ¨å®¹å™¨ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run â€â€restart=onâ€failure:10 redis</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GITåˆå§‹åŒ–ä»“åº“</title>
      <link href="//posts/b3ff4f99.html"/>
      <url>//posts/b3ff4f99.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‘½ä»¤è¡ŒæŒ‡ä»¤"><a href="#å‘½ä»¤è¡ŒæŒ‡ä»¤" class="headerlink" title="å‘½ä»¤è¡ŒæŒ‡ä»¤"></a>å‘½ä»¤è¡ŒæŒ‡ä»¤</h2><h3 id="Git-å…¨å±€è®¾ç½®"><a href="#Git-å…¨å±€è®¾ç½®" class="headerlink" title="Git å…¨å±€è®¾ç½®"></a>Git å…¨å±€è®¾ç½®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;åç§°&quot;</span><br><span class="line">git config --global user.email &quot;ä½ çš„é‚®ç®±&quot;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ–°ç‰ˆæœ¬åº“"><a href="#åˆ›å»ºæ–°ç‰ˆæœ¬åº“" class="headerlink" title="åˆ›å»ºæ–°ç‰ˆæœ¬åº“"></a>åˆ›å»ºæ–°ç‰ˆæœ¬åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone git@172.16.200.102:dev1/sims-ui.git</span><br><span class="line">cd sims-ui</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;add README&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="å·²å­˜åœ¨çš„æ–‡ä»¶å¤¹"><a href="#å·²å­˜åœ¨çš„æ–‡ä»¶å¤¹" class="headerlink" title="å·²å­˜åœ¨çš„æ–‡ä»¶å¤¹"></a>å·²å­˜åœ¨çš„æ–‡ä»¶å¤¹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin git@172.16.200.102:dev1/sims-ui.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="å·²å­˜åœ¨çš„-Git-ç‰ˆæœ¬åº“"><a href="#å·²å­˜åœ¨çš„-Git-ç‰ˆæœ¬åº“" class="headerlink" title="å·²å­˜åœ¨çš„ Git ç‰ˆæœ¬åº“"></a>å·²å­˜åœ¨çš„ Git ç‰ˆæœ¬åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd existing_repo</span><br><span class="line">git remote rename origin old-origin</span><br><span class="line">git remote add origin git@172.16.200.102:dev1/sims-ui.git</span><br><span class="line">git push -u origin --all</span><br><span class="line">git push -u origin --tags</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç³»ç»ŸåŠŸèƒ½é¡µé¢ä¹±ç é—®é¢˜è§£å†³è¿‡ç¨‹</title>
      <link href="//posts/e910f696.html"/>
      <url>//posts/e910f696.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä»¥ä¸‹å¯¹æµè§ˆå™¨åŠ è½½èµ„æºæ–‡ä»¶çš„æ—¶å€™, æˆ–å‡ºç°ä¹±ç æƒ…å†µçš„æ—¶å€™, å¯¹è§£å†³è¿‡ç¨‹è¿›è¡Œè®°å½•ï¼Œ å¦‚æœ‰ä»¥ä¸‹æƒ…å†µçš„åŒå­¦å¯ä»¥å€Ÿé‰´å‚è€ƒï¼›</p></blockquote><a id="more"></a><h2 id="æƒ…å†µä¸€"><a href="#æƒ…å†µä¸€" class="headerlink" title="æƒ…å†µä¸€"></a>æƒ…å†µä¸€</h2><ul><li><p>é—®é¢˜æè¿°:<br>åº”ç”¨èµ„æºæ–‡ä»¶ç¼–ç ä¸æ­£ç¡®ï¼Œ å¯¼è‡´æœ€ç»ˆæµè§ˆå™¨ç¼–ç </p></li><li><p>è§£å†³è¿‡ç¨‹:<br>æ‰¾åˆ°å¯¹åº”ä¹±ç çš„<code>html</code>æˆ–è€…<code>js</code>æ–‡ä»¶, å°†æ–‡ä»¶ç¼–ç ä¿å­˜ä¸ºåº”ç”¨ç»Ÿä¸€çš„ç¼–ç å³å¯ï¼›</p></li></ul><h2 id="æƒ…å†µäºŒ"><a href="#æƒ…å†µäºŒ" class="headerlink" title="æƒ…å†µäºŒ"></a>æƒ…å†µäºŒ</h2><ul><li>é—®é¢˜æè¿°:<br>jsçš„æ–‡ä»¶ç¼–ç ä¸ºåº”ç”¨ç»Ÿä¸€çš„æ ‡å‡†ç¼–ç (å¦‚GBK), ä½†æ˜¯æµè§ˆå™¨å±•ç°è¿˜æ˜¯ä¸ºä¹±ç , å¦‚ä¸‹å›¾:</li></ul><p>jsèµ„æºæ–‡ä»¶ç¼–ç ä¸º<code>GBK</code><br><img src="http://qiniu-pic.siven.net/blog/2018-03-15-034645.png" alt></p><p>æµè§ˆå™¨åŠ è½½çš„<code>JS</code>èµ„æºæ–‡ä»¶ä¸ºä¹±ç <br><img src="http://qiniu-pic.siven.net/blog/2018-03-15-034744.png" alt></p><ul><li>è§£å†³æ–¹æ³•:<br>ä¸€èˆ¬è¿™ç§æƒ…å†µæœ‰ä¸¤ç§å¯èƒ½    </li></ul><ol><li>æµè§ˆå™¨ç¼“å­˜äº†ä¹‹å‰ç¼–ç ä¸æ­£ç¡®çš„èµ„æºæ–‡ä»¶, åˆ é™¤æµè§ˆå™¨ç¼“å­˜å³å¯;</li><li>æ£€æŸ¥HTMLå¼•å…¥<code>JS</code>èµ„æºçš„æ—¶å€™, æŒ‡å®šäº†<code>JS</code>èµ„æºçš„ç¼–ç <code>charset=&quot;utf-8&quot;</code>,ä½†èµ„æºæ–‡ä»¶å®é™…ç¼–ç ä¸º<code>GBK</code>, æœ€ç»ˆå¯¼è‡´æµè§ˆå™¨å±•ç¤ºä¹±ç , å¦‚ä¸‹å›¾:<br><img src="http://qiniu-pic.siven.net/blog/2018-03-15-034931.png" alt><br>è§£å†³åŠæ³•äº¦æ˜¯å°†<code>charset</code>æŒ‡å®šä¸ºæ­£ç¡®çš„ç¼–ç æˆ–åˆ æ‰å³å¯</li></ol><h2 id="é—®é¢˜æ€»ç»“"><a href="#é—®é¢˜æ€»ç»“" class="headerlink" title="é—®é¢˜æ€»ç»“"></a>é—®é¢˜æ€»ç»“</h2><p>å½“ç„¶ä¹±ç çš„æƒ…å†µè¿˜æœ‰å¾ˆå¤šç§,ä»€ä¹ˆæäº¤æ•°æ®ä¹±ç è¯¸å¦‚æ­¤ç±»,è¿™äº›é—®é¢˜å°±åº”è¯¥åœ¨ä»£ç å±‚é¢å»ä¿éšœäº†, å¯¹æäº¤çš„å‚æ•°è¿›è¡Œ<code>encoding</code>ç¼–ç , åå°æ¥æ”¶æ•°æ®å¯¹å‚æ•°è¿›è¡Œè§£ç æ“ä½œç­‰, ä½†æ˜¯å¯¹äºæ–‡ä»¶æœ¬èº«å°±å­˜åœ¨ç¼–ç ä¸æ­£ç¡®ä¹±ç çš„é—®é¢˜å¯ä»¥å‚è€ƒä¸Šé¢çš„æƒ…å†µå»è§£å†³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
            <tag> JS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RocketMQé›†ç¾¤æ­å»º</title>
      <link href="//posts/d91bf2fe.html"/>
      <url>//posts/d91bf2fe.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¨èçš„å‡ ç§<code>Broker</code>é›†ç¾¤éƒ¨ç½²æ–¹å¼ï¼Œè¿™é‡Œçš„<code>Slave</code>ä¸å¯å†™ï¼Œä½†å¯è¯»ï¼Œç±»ä¼¼äº Mysqlä¸»å¤‡æ–¹å¼ã€‚</p><h2 id="å¤šMasteræ¨¡å¼ï¼ˆ2m-noslaveï¼‰"><a href="#å¤šMasteræ¨¡å¼ï¼ˆ2m-noslaveï¼‰" class="headerlink" title="å¤šMasteræ¨¡å¼ï¼ˆ2m-noslaveï¼‰"></a>å¤šMasteræ¨¡å¼ï¼ˆ2m-noslaveï¼‰</h2><p>ä¸€ä¸ªé›†ç¾¤æ— Slaveï¼Œå…¨æ˜¯Masterï¼Œä¾‹å¦‚2ä¸ªMasteræˆ–è€…3ä¸ªMaster</p><ul><li>ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œå•ä¸ªMasterå®•æœºæˆ–é‡å¯ç»´æŠ¤å¯¹åº”ç”¨æ— å½±å“ï¼Œåœ¨ç£ç›˜é…ç½®ä¸ºRAID10æ—¶ï¼Œå³ä½¿æœºå™¨å®•æœºä¸å¯æ¢å¤æƒ…å†µä¸‹ï¼Œç”±äºRAID10ç£ç›˜éå¸¸å¯é ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢ï¼ˆå¼‚æ­¥åˆ·ç›˜ä¸¢å¤±å°‘é‡æ¶ˆæ¯ï¼ŒåŒæ­¥åˆ·ç›˜ä¸€æ¡ä¸ä¸¢ï¼‰ã€‚æ€§èƒ½æœ€é«˜ã€‚</li><li>ç¼ºç‚¹ï¼šå•å°æœºå™¨å®•æœºæœŸé—´ï¼Œè¿™å°æœºå™¨ä¸Šæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨æœºå™¨æ¢å¤ä¹‹å‰ä¸å¯è®¢é˜…ï¼Œæ¶ˆæ¯å®æ—¶æ€§ä¼šå—åˆ°å—åˆ°å½±å“ã€‚</li></ul><a id="more"></a><h2 id="å¤šMasterå¤šSlaveæ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶ï¼ˆ2m-2s-asyncï¼‰"><a href="#å¤šMasterå¤šSlaveæ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶ï¼ˆ2m-2s-asyncï¼‰" class="headerlink" title="å¤šMasterå¤šSlaveæ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶ï¼ˆ2m-2s-asyncï¼‰"></a>å¤šMasterå¤šSlaveæ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶ï¼ˆ2m-2s-asyncï¼‰</h2><p>æ¯ä¸ªMasteré…ç½®ä¸€ä¸ªSlaveï¼Œæœ‰å¤šå¯¹Master-Slaveï¼ŒHAé‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œä¸»å¤‡æœ‰çŸ­æš‚æ¶ˆæ¯å»¶è¿Ÿï¼Œæ¯«ç§’çº§ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šå³ä½¿ç£ç›˜æŸåï¼Œæ¶ˆæ¯ä¸¢å¤±çš„éå¸¸å°‘ï¼Œä¸”æ¶ˆæ¯å®æ—¶æ€§ä¸ä¼šå—å½±å“ï¼Œå› ä¸ºMasterå®•æœºåï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥ä»Slaveæ¶ˆè´¹ï¼Œæ­¤è¿‡ç¨‹å¯¹åº”ç”¨é€æ˜ã€‚ä¸éœ€è¦äººå·¥å¹²é¢„ã€‚æ€§èƒ½åŒå¤šMasteræ¨¡å¼å‡ ä¹ä¸€æ ·ã€‚</li><li>ç¼ºç‚¹ï¼šMasterå®•æœºï¼Œç£ç›˜æŸåæƒ…å†µï¼Œä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚</li></ul><h2 id="å¤šMasterå¤šSlaveæ¨¡å¼ï¼ŒåŒæ­¥åŒå†™ï¼ˆ2m-noslaveï¼‰"><a href="#å¤šMasterå¤šSlaveæ¨¡å¼ï¼ŒåŒæ­¥åŒå†™ï¼ˆ2m-noslaveï¼‰" class="headerlink" title="å¤šMasterå¤šSlaveæ¨¡å¼ï¼ŒåŒæ­¥åŒå†™ï¼ˆ2m-noslaveï¼‰"></a>å¤šMasterå¤šSlaveæ¨¡å¼ï¼ŒåŒæ­¥åŒå†™ï¼ˆ2m-noslaveï¼‰</h2><p>æ¯ä¸ªMasteré…ç½®ä¸€ä¸ªSlaveï¼Œæœ‰å¤šå¯¹Master-Slaveï¼ŒHAé‡‡ç”¨åŒæ­¥åŒå†™æ–¹å¼ï¼Œä¸»å¤‡éƒ½å†™æˆåŠŸï¼Œå‘åº”ç”¨è¿”å›æˆåŠŸã€‚</p><ul><li>ä¼˜ç‚¹ï¼šæ•°æ®ä¸æœåŠ¡éƒ½æ— å•ç‚¹ï¼ŒMasterå®•æœºæƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ— å»¶è¿Ÿï¼ŒæœåŠ¡å¯ç”¨æ€§ä¸æ•°æ®å¯ç”¨æ€§éƒ½éå¸¸é«˜</li><li>ç¼ºç‚¹ï¼šæ€§èƒ½æ¯”å¼‚æ­¥å¤åˆ¶æ¨¡å¼ç•¥ä½ï¼Œå¤§çº¦ä½10%å·¦å³ï¼Œå‘é€å•ä¸ªæ¶ˆæ¯çš„RTä¼šç•¥é«˜ã€‚ç›®å‰ä¸»å®•æœºåï¼Œå¤‡æœºä¸èƒ½è‡ªåŠ¨åˆ‡æ¢ä¸ºä¸»æœºï¼Œåç»­ä¼šæ”¯æŒè‡ªåŠ¨åˆ‡æ¢åŠŸèƒ½ã€‚</li></ul><h1 id="é›†ç¾¤éƒ¨ç½²"><a href="#é›†ç¾¤éƒ¨ç½²" class="headerlink" title="é›†ç¾¤éƒ¨ç½²"></a>é›†ç¾¤éƒ¨ç½²</h1><h2 id="å¤šMasteræ¨¡å¼æ­å»º"><a href="#å¤šMasteræ¨¡å¼æ­å»º" class="headerlink" title="å¤šMasteræ¨¡å¼æ­å»º"></a>å¤šMasteræ¨¡å¼æ­å»º</h2><h3 id="æ€»ä½“æ¶æ„"><a href="#æ€»ä½“æ¶æ„" class="headerlink" title="æ€»ä½“æ¶æ„"></a>æ€»ä½“æ¶æ„</h3><p><img src="http://qiniu-pic.siven.net/blog/2018-02-09-094447.png" alt></p><h3 id="æœåŠ¡å™¨ç¯å¢ƒ"><a href="#æœåŠ¡å™¨ç¯å¢ƒ" class="headerlink" title="æœåŠ¡å™¨ç¯å¢ƒ"></a>æœåŠ¡å™¨ç¯å¢ƒ</h3><table><thead><tr><th>åºå·</th><th>IP</th><th>è§’è‰²</th><th>æ¶æ„æ¨¡å¼</th></tr></thead><tbody><tr><td>1</td><td>10.211.55.14</td><td>nameserverã€brokerserver</td><td>Master1ï¼ˆåŒMasteræ¨¡å¼ï¼‰</td></tr><tr><td>2</td><td>10.211.55.15</td><td>nameserverã€brokerserver</td><td>Master2ï¼ˆåŒMasteræ¨¡å¼ï¼‰</td></tr></tbody></table><hr><blockquote><p><strong>æ³¨:</strong> ä»¥ä¸‹é…ç½®éœ€è¦åŒæ—¶åœ¨ä»¥ä¸Šä¸¤å°æœåŠ¡å™¨ä¸­è¿›è¡Œ</p></blockquote><h3 id="Hostsæ·»åŠ ä¿¡æ¯"><a href="#Hostsæ·»åŠ ä¿¡æ¯" class="headerlink" title="Hostsæ·»åŠ ä¿¡æ¯"></a>Hostsæ·»åŠ ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure><p>é…ç½®å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># rocketmq hosts</span><br><span class="line">10.211.55.14 rocketmq-nameserver1</span><br><span class="line">10.211.55.14 rocketmq-master1</span><br><span class="line">10.211.55.15 rocketmq-nameserver2</span><br><span class="line">10.211.55.15 rocketmq-master2</span><br></pre></td></tr></table></figure></p><p>é…ç½®å®Œæˆå, é‡å¯ç½‘å¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure></p><h3 id="é˜²ç«å¢™é…ç½®"><a href="#é˜²ç«å¢™é…ç½®" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><p>å®¿ä¸»æœºéœ€è¦è¿œç¨‹è®¿é—®è™šæ‹Ÿæœºçš„rocketmqæœåŠ¡å’ŒwebæœåŠ¡ï¼Œéœ€è¦å¼€æ”¾ç›¸å…³çš„ç«¯å£å·ï¼Œç®€å•ç²—æš´çš„æ–¹å¼æ˜¯ç›´æ¥å…³é—­é˜²ç«å¢™<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­é˜²ç«å¢™</span></span><br><span class="line">service iptables stop </span><br><span class="line"><span class="comment"># æŸ¥çœ‹é˜²ç«å¢™çš„çŠ¶æ€</span></span><br><span class="line">service iptables status </span><br><span class="line"><span class="comment"># å¯åŠ¨é˜²ç«å¢™</span></span><br><span class="line">service iptables start</span><br></pre></td></tr></table></figure></p><p>æˆ–è€…ä¸ºäº†å®‰å…¨ï¼Œåªå¼€æ”¾ç‰¹å®šçš„ç«¯å£å·ï¼ŒRocketMQé»˜è®¤ä½¿ç”¨3ä¸ªç«¯å£ï¼š9876 ã€10911ã€10912ã€‚å¦‚æœé˜²ç«å¢™æ²¡æœ‰å…³é—­çš„è¯ï¼Œé‚£ä¹ˆé˜²ç«å¢™å°±å¿…é¡»å¼€æ”¾è¿™äº›ç«¯å£ï¼š</p><ul><li><code>name server</code> é»˜è®¤ä½¿ç”¨ 9876 ç«¯å£</li><li><code>master</code> é»˜è®¤ä½¿ç”¨ 10911 ç«¯å£</li><li><code>slave</code> é»˜è®¤ä½¿ç”¨10912 ç«¯å£ (å½“å‰é›†ç¾¤æ¨¡å¼å¯ä¸å¼€å¯)</li></ul><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€æ”¾name serveré»˜è®¤ç«¯å£</span></span><br><span class="line">/sbin/iptables -I INPUT -p tcp --dport 9876 -j ACCEPT  </span><br><span class="line"><span class="comment"># å¼€æ”¾masteré»˜è®¤ç«¯å£</span></span><br><span class="line">/sbin/iptables -I INPUT -p tcp --dport 10911 -j ACCEPT  </span><br><span class="line"><span class="comment"># å¼€æ”¾slaveé»˜è®¤ç«¯å£ (å½“å‰é›†ç¾¤æ¨¡å¼å¯ä¸å¼€å¯)</span></span><br><span class="line">/sbin/iptables -I INPUT -p tcp --dport 10912 -j ACCEPT  </span><br><span class="line"><span class="comment"># ä¿å­˜é…ç½®</span></span><br><span class="line">service iptables save  </span><br><span class="line"><span class="comment"># é‡å¯é˜²ç«å¢™</span></span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p><h3 id="ä¸‹è½½å¹¶è§£å‹"><a href="#ä¸‹è½½å¹¶è§£å‹" class="headerlink" title="ä¸‹è½½å¹¶è§£å‹"></a>ä¸‹è½½å¹¶è§£å‹</h3><p>RocketMQå®˜ç½‘: <a href="http://rocketmq.apache.org/" target="_blank" rel="noopener">http://rocketmq.apache.org/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirror.bit.edu.cn/apache/rocketmq/4.2.0/rocketmq-all-4.2.0-bin-release.zip</span><br><span class="line">unzip rocketmq-all-4.2.0-bin-release.zip</span><br><span class="line">mv rocketmq-all-4 /usr/<span class="built_in">local</span>/rocketmq</span><br></pre></td></tr></table></figure></p><h3 id="ç¯å¢ƒå˜é‡é…ç½®"><a href="#ç¯å¢ƒå˜é‡é…ç½®" class="headerlink" title="ç¯å¢ƒå˜é‡é…ç½®"></a>ç¯å¢ƒå˜é‡é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>åœ¨profileæ–‡ä»¶çš„æœ«å°¾åŠ å…¥å¦‚ä¸‹å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#set rocketmq</span></span><br><span class="line">ROCKETMQ_HOME=/usr/<span class="built_in">local</span>/rocketmq</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$ROCKETMQ_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> ROCKETMQ_HOME PATH</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥:wq! ä¿å­˜å¹¶é€€å‡ºï¼Œ å¹¶ä½¿å¾—é…ç½®ç«‹åˆ»ç”Ÿæ•ˆï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p><h3 id="åˆ›å»ºå­˜å‚¨è·¯å¾„"><a href="#åˆ›å»ºå­˜å‚¨è·¯å¾„" class="headerlink" title="åˆ›å»ºå­˜å‚¨è·¯å¾„"></a>åˆ›å»ºå­˜å‚¨è·¯å¾„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store/commitlog</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store/consumequeue</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store/index</span><br></pre></td></tr></table></figure><h3 id="RocketMQé…ç½®æ–‡ä»¶"><a href="#RocketMQé…ç½®æ–‡ä»¶" class="headerlink" title="RocketMQé…ç½®æ–‡ä»¶"></a>RocketMQé…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/rocketmq/conf/2m-noslave/broker-a.properties</span><br><span class="line">vim /usr/<span class="built_in">local</span>/rocketmq/conf/2m-noslave/broker-b.properties</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#æ‰€å±é›†ç¾¤åå­—</span><br><span class="line">brokerClusterName=rocketmq-cluster</span><br><span class="line">#brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·</span><br><span class="line">brokerName=broker-a|broker-b</span><br><span class="line">#0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave</span><br><span class="line">brokerId=0</span><br><span class="line">#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span><br><span class="line">namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876</span><br><span class="line">#åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span><br><span class="line">defaultTopicQueueNums=4</span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateTopicEnable=true</span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateSubscriptionGroup=true</span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br><span class="line">listenPort=10911</span><br><span class="line">#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹</span><br><span class="line">deleteWhen=04</span><br><span class="line">#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶</span><br><span class="line">fileReservedTime=120</span><br><span class="line">#commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G</span><br><span class="line">mapedFileSizeCommitLog=1073741824</span><br><span class="line">#ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´</span><br><span class="line">mapedFileSizeConsumeQueue=300000</span><br><span class="line">#destroyMapedFileIntervalForcibly=120000</span><br><span class="line">#redeleteHangedFileInterval=120000</span><br><span class="line">#æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´</span><br><span class="line">diskMaxUsedSpaceRatio=88</span><br><span class="line">#å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathRootDir=/usr/local/rocketmq/store</span><br><span class="line">#commitLog å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathCommitLog=/usr/local/rocketmq/store/commitlog</span><br><span class="line">#æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathConsumeQueue=/usr/local/rocketmq/store/consumequeue</span><br><span class="line">#æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathIndex=/usr/local/rocketmq/store/index</span><br><span class="line">#checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">storeCheckpoint=/usr/local/rocketmq/store/checkpoint</span><br><span class="line">#abort æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">abortFile=/usr/local/rocketmq/store/abort</span><br><span class="line">#é™åˆ¶çš„æ¶ˆæ¯å¤§å°</span><br><span class="line">maxMessageSize=65536</span><br><span class="line">#flushCommitLogLeastPages=4</span><br><span class="line">#flushConsumeQueueLeastPages=2</span><br><span class="line">#flushCommitLogThoroughInterval=10000</span><br><span class="line">#flushConsumeQueueThoroughInterval=60000</span><br><span class="line">#Broker çš„è§’è‰²</span><br><span class="line">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="line">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole=ASYNC_MASTER</span><br><span class="line">#åˆ·ç›˜æ–¹å¼</span><br><span class="line">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="line">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line">#checkTransactionMessageEnable=false</span><br><span class="line">#å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#sendMessageThreadPoolNums=128</span><br><span class="line">#æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#pullMessageThreadPoolNums=128</span><br></pre></td></tr></table></figure></p><h3 id="ä¿®æ”¹æ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹æ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹æ—¥å¿—é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹æ—¥å¿—é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/<span class="built_in">local</span>/rocketmq/logs</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/rocketmq/conf &amp;&amp; sed -i <span class="string">'s#$&#123;user.home&#125;#/usr/local/rocketmq#g'</span> *.xml</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å¯åŠ¨è„šæœ¬å‚æ•°"><a href="#ä¿®æ”¹å¯åŠ¨è„šæœ¬å‚æ•°" class="headerlink" title="ä¿®æ”¹å¯åŠ¨è„šæœ¬å‚æ•°"></a>ä¿®æ”¹å¯åŠ¨è„šæœ¬å‚æ•°</h3><h4 id="runbroker-sh"><a href="#runbroker-sh" class="headerlink" title="runbroker.sh"></a>runbroker.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/rocketmq/bin/runbroker.sh</span><br></pre></td></tr></table></figure><p>éœ€è¦æ ¹æ®å†…å­˜å¤§å°è¿›è¡Œé€‚å½“çš„å¯¹JVMå‚æ•°è¿›è¡Œè°ƒæ•´ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#===========================================================================================</span><br><span class="line"># å¼€å‘ç¯å¢ƒé…ç½® JVM Configuration</span><br><span class="line">#===========================================================================================</span><br><span class="line">JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms1g -Xmx1g -Xmn512m&quot;</span><br></pre></td></tr></table></figure></p><p>æœ¬æœºä¸ºè™šæ‹Ÿæœºï¼Œå°±è®¾ç½®å°ç‚¹ï¼Œ1-2gå†…å­˜ï¼Œå¦‚ä¸‹ï¼š<br><img src="http://qiniu-pic.siven.net/blog/2018-02-09-083045.png" alt></p><h4 id="runserver-sh"><a href="#runserver-sh" class="headerlink" title="runserver.sh"></a>runserver.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/rocketmq/bin/runserver.sh</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#===========================================================================================</span><br><span class="line"># å¼€å‘ç¯å¢ƒé…ç½® JVM Configuration</span><br><span class="line">#===========================================================================================</span><br><span class="line">JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms1g -Xmx1g -Xmn512g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span><br></pre></td></tr></table></figure><p><img src="http://qiniu-pic.siven.net/blog/2018-02-09-083329.png" alt></p><h3 id="æœåŠ¡å¯åŠ¨"><a href="#æœåŠ¡å¯åŠ¨" class="headerlink" title="æœåŠ¡å¯åŠ¨"></a>æœåŠ¡å¯åŠ¨</h3><h4 id="å¯åŠ¨NameServer-master1ã€master2"><a href="#å¯åŠ¨NameServer-master1ã€master2" class="headerlink" title="å¯åŠ¨NameServer (master1ã€master2)"></a>å¯åŠ¨NameServer (master1ã€master2)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/rocketmq/bin</span><br><span class="line">nohup sh mqnamesrv &amp;</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨BrokerServer-A-master1"><a href="#å¯åŠ¨BrokerServer-A-master1" class="headerlink" title="å¯åŠ¨BrokerServer A (master1)"></a>å¯åŠ¨BrokerServer A (master1)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/rocketmq/bin</span><br><span class="line">nohup sh mqbroker -c /usr/<span class="built_in">local</span>/rocketmq/conf/2m-noslave/broker-a.properties &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨BrokerServer-B-master2"><a href="#å¯åŠ¨BrokerServer-B-master2" class="headerlink" title="å¯åŠ¨BrokerServer B (master2)"></a>å¯åŠ¨BrokerServer B (master2)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/rocketmq/bin</span><br><span class="line">nohup sh mqbroker -c /usr/<span class="built_in">local</span>/rocketmq/conf/2m-noslave/broker-b.properties &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼š</strong> åœ¨master2ä¸Šçš„åç§°ä¸º<code>broker-b.properties</code></p><h4 id="æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€"><a href="#æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€"></a>æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€</h4><ul><li><p>jps<br><img src="http://qiniu-pic.siven.net/blog/2018-02-09-095032.png" alt></p></li><li><p>netstat -ntlp<br><img src="http://qiniu-pic.siven.net/blog/2018-02-09-095002.png" alt></p></li></ul><h4 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹nameServeræ—¥å¿—</span></span><br><span class="line">tail -500f /usr/<span class="built_in">local</span>/rocketmq/logs/rocketmqlogs/namesrv.log</span><br><span class="line"><span class="comment"># æŸ¥çœ‹brokeræ—¥å¿—</span></span><br><span class="line">tail -500f /usr/<span class="built_in">local</span>/rocketmq/logs/rocketmqlogs/broker.log</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æ¸…ç†"><a href="#æ•°æ®æ¸…ç†" class="headerlink" title="æ•°æ®æ¸…ç†"></a>æ•°æ®æ¸…ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/rocketmq/bin</span><br><span class="line">sh mqshutdown broker</span><br><span class="line">sh mqshutdown namesrv</span><br><span class="line"><span class="comment"># --ç­‰å¾…åœæ­¢</span></span><br><span class="line">rm -rf /usr/<span class="built_in">local</span>/rocketmq/store</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store/commitlog</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store/consumequeue</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/rocketmq/store/index</span><br><span class="line"><span class="comment"># --æŒ‰ç…§ä¸Šé¢æ­¥éª¤é‡å¯NameServerä¸BrokerServer</span></span><br></pre></td></tr></table></figure><h1 id="RocketMQ-Console-ç›‘æ§å¹³å°"><a href="#RocketMQ-Console-ç›‘æ§å¹³å°" class="headerlink" title="RocketMQ Console (ç›‘æ§å¹³å°)"></a>RocketMQ Console (ç›‘æ§å¹³å°)</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>RocketMQ</code>æœ‰ä¸€ä¸ªå¯¹å…¶æ‰©å±•çš„å¼€æºé¡¹ç›®<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener">incubator-rocketmq-externals</a>ï¼Œè¿™ä¸ªé¡¹ç›®ä¸­æœ‰ä¸€ä¸ªå­æ¨¡å—å«<code>rocketmq-console</code>ï¼Œè¿™ä¸ªä¾¿æ˜¯ç®¡ç†æ§åˆ¶å°é¡¹ç›®äº†ï¼Œå…ˆå°†<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener">incubator-rocketmq-externals</a>æ‹‰åˆ°æœ¬åœ°ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è‡ªå·±å¯¹<code>rocketmq-console</code>è¿›è¡Œç¼–è¯‘æ‰“åŒ…è¿è¡Œã€‚</p><p><img src="http://qiniu-pic.siven.net/blog/2018-02-09-084750.png" alt></p><h2 id="ä¸‹è½½å¹¶ç¼–è¯‘"><a href="#ä¸‹è½½å¹¶ç¼–è¯‘" class="headerlink" title="ä¸‹è½½å¹¶ç¼–è¯‘"></a>ä¸‹è½½å¹¶ç¼–è¯‘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/apache/rocketmq-externals</span><br><span class="line"><span class="built_in">cd</span> rocketmq-console</span><br><span class="line">mvn clean package -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ï¼š<br><img src="http://qiniu-pic.siven.net/blog/2018-02-09-084620.png" alt></p><p>æ­¤æ—¶åœ¨<code>rocketmq-console/target</code>ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªå«<code>rocketmq-console-ng-1.0.0.jar</code>çš„jaråŒ…ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="http://qiniu-pic.siven.net/blog/2018-02-09-084727.png" alt></p><h2 id="å¯åŠ¨è¿è¡Œ"><a href="#å¯åŠ¨è¿è¡Œ" class="headerlink" title="å¯åŠ¨è¿è¡Œ"></a>å¯åŠ¨è¿è¡Œ</h2><p>åœ¨å¯åŠ¨ä¹‹å‰, éœ€è¦åœ¨ç›®æ ‡çš„RocketMQé›†ç¾¤åº”ç”¨æœåŠ¡å™¨æˆ–å¼€æ”¾ç«¯å£10909ç«¯å£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># fastListenPort ä¸»è¦æ˜¯fastRemotingServeræœåŠ¡ä½¿ç”¨</span><br><span class="line">/sbin/iptables -I INPUT -p tcp --dport 10909 -j ACCEPT  </span><br><span class="line"># ä¿å­˜é…ç½®</span><br><span class="line">service iptables save  </span><br><span class="line"># é‡å¯é˜²ç«å¢™</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨rocketmq-consoleï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar rocketmq-console-ng-1.0.0.jar --server.port=8080 --rocketmq.config.namesrvAddr=10.211.55.14:9876;10.211.55.15:9876</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæ³¨æ„éœ€è¦è®¾ç½®ä¸¤ä¸ªå‚æ•°ï¼š<code>--server.port</code>ä¸ºè¿è¡Œçš„è¿™ä¸ªwebåº”ç”¨çš„ç«¯å£ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯é»˜è®¤ä¸º<code>8080</code>ï¼›<code>--rocketmq.config.namesrvAddr</code>ä¸ºRocketMQå‘½åæœåŠ¡åœ°å€ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯é»˜è®¤ä¸ºâ€œâ€ã€‚æˆ–è€…ä¿®æ”¹<code>rocketmq-console-ng-1.0.0.jar</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°é…ç½®æ–‡ä»¶application.propertiesï¼Œå¹¶æŒ‰ç…§è‡ªå·±éœ€æ±‚è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocketmq.config.namesrvAddr=namesrvæœåŠ¡åœ°å€ï¼ˆip1ï¼šport;ip2:portï¼‰</span><br></pre></td></tr></table></figure></p><p>é…ç½®å¥½ä¹‹å, å°±ä¸éœ€è¦æŒ‡å®š<code>--rocketmq.config.namesrvAddr</code>å‚æ•°</p><p>å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®<code>http://localhost:8080</code>è¿›å…¥æ§åˆ¶å°ç•Œé¢äº†ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="http://qiniu-pic.siven.net/blog/2018-02-09-092909.png" alt></p><p>é›†ç¾¤èŠ‚ç‚¹:<br><img src="http://qiniu-pic.siven.net/blog/2018-02-09-093021.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> RocketMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RocketMQ </tag>
            
            <tag> Cluster </tag>
            
            <tag> rocketmq-console </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java Futureæ¨¡å¼ï¼šCallableã€Futureå’ŒFutureTaskæµ…æ</title>
      <link href="//posts/b1cdc354.html"/>
      <url>//posts/b1cdc354.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨Javaä¸­ä¸€èˆ¬é€šè¿‡ç»§æ‰¿<code>Thread</code>ç±»æˆ–è€…å®ç°<code>Runnable</code>æ¥å£è¿™ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºå¤šçº¿ç¨‹ï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼éƒ½æœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸èƒ½åœ¨æ‰§è¡Œå®Œæˆåè·å–æ‰§è¡Œçš„ç»“æœï¼Œå› æ­¤Java 1.5ä¹‹åæä¾›äº†<code>Callable</code>å’Œ<code>Future</code>æ¥å£ï¼Œé€šè¿‡å®ƒä»¬å°±å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åå¾—åˆ°ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚æœ¬æ–‡ä¼šç®€è¦çš„ä»‹ç»ä½¿ç”¨æ–¹æ³•ï¼Œç„¶åä¼šä»æºä»£ç è§’åº¦åˆ†æä¸‹å…·ä½“çš„å®ç°åŸç†ã€‚<br><img src="http://qiniu-pic.siven.net/blog/2018-01-31-080956.png" alt></p><a id="more"></a><h1 id="Callableæ¥å£"><a href="#Callableæ¥å£" class="headerlink" title="Callableæ¥å£"></a>Callable<v>æ¥å£</v></h1><p>å¯¹äºéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡éœ€è¦å®ç°<code>Callable</code>æ¥å£ï¼Œ<code>Callable</code>æ¥å£å®šä¹‰å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Computes a result, or throws an exception if unable to do so.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> computed result</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception if unable to compute a result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°<code>Callable</code>æ˜¯ä¸ªæ³›å‹æ¥å£ï¼Œæ³›å‹Vå°±æ˜¯è¦<code>call()</code>æ–¹æ³•è¿”å›çš„ç±»å‹ã€‚<code>Callable</code>æ¥å£å’Œ<code>Runnable</code>æ¥å£å¾ˆåƒï¼Œéƒ½å¯ä»¥è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯æ­£å¦‚å‰é¢æ‰€è¯´çš„ï¼Œ<code>Runnable</code>ä¸ä¼šè¿”å›æ•°æ®ä¹Ÿä¸èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚</p><h1 id="Futureæ¥å£"><a href="#Futureæ¥å£" class="headerlink" title="Futureæ¥å£"></a>Future<v>æ¥å£</v></h1><p><code>Future</code>æ¥å£ä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œé€šè¿‡<code>Future</code>æ¥å£æä¾›çš„æ–¹æ³•å¯ä»¥æŸ¥çœ‹å¼‚æ­¥è®¡ç®—æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œæˆ–è€…ç­‰å¾…æ‰§è¡Œç»“æœå¹¶è·å–æ‰§è¡Œç»“æœï¼ŒåŒæ—¶è¿˜å¯ä»¥å–æ¶ˆæ‰§è¡Œã€‚<code>Future</code>æ¥å£çš„å®šä¹‰å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isCancelled</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ–¹æ³•è§£æï¼š</p><ul><li>cancel():ç”¨æ¥å–æ¶ˆå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œã€‚å¦‚æœå¼‚æ­¥ä»»åŠ¡å·²ç»å®Œæˆæˆ–è€…å·²ç»è¢«å–æ¶ˆï¼Œæˆ–è€…ç”±äºæŸäº›åŸå› ä¸èƒ½å–æ¶ˆï¼Œåˆ™ä¼šè¿”å›falseã€‚å¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰è¢«æ‰§è¡Œï¼Œåˆ™ä¼šè¿”å›trueå¹¶ä¸”å¼‚æ­¥ä»»åŠ¡ä¸ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œäº†ä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œè‹¥mayInterruptIfRunningä¸ºtrueï¼Œåˆ™ä¼šç«‹å³ä¸­æ–­æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹å¹¶è¿”å›trueï¼Œè‹¥mayInterruptIfRunningä¸ºfalseï¼Œåˆ™ä¼šè¿”å›trueä¸”ä¸ä¼šä¸­æ–­ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ã€‚</li><li>isCanceled():åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆï¼Œå¦‚æœä»»åŠ¡åœ¨ç»“æŸ(æ­£å¸¸æ‰§è¡Œç»“æŸæˆ–è€…æ‰§è¡Œå¼‚å¸¸ç»“æŸ)å‰è¢«å–æ¶ˆåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li><li>isDone():åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œå¦‚æœå®Œæˆåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ã€ä»»åŠ¡è¢«å–æ¶ˆä¹Ÿå±äºä»»åŠ¡å·²å®Œæˆï¼Œä¹Ÿä¼šè¿”å›trueã€‚</li><li>get():è·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå¦‚æœä»»åŠ¡è¿˜æ²¡å®Œæˆåˆ™ä¼šé˜»å¡ç­‰å¾…ç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚å¦‚æœä»»åŠ¡è¢«å–æ¶ˆåˆ™ä¼šæŠ›å‡ºCancellationExceptionå¼‚å¸¸ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹å‘ç”Ÿå¼‚å¸¸åˆ™ä¼šæŠ›å‡ºExecutionExceptionå¼‚å¸¸ï¼Œå¦‚æœé˜»å¡ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­åˆ™ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚</li><li>get(long timeout,Timeunit unit):å¸¦è¶…æ—¶æ—¶é—´çš„get()ç‰ˆæœ¬ï¼Œå¦‚æœé˜»å¡ç­‰å¾…è¿‡ç¨‹ä¸­è¶…æ—¶åˆ™ä¼šæŠ›å‡ºTimeoutExceptionå¼‚å¸¸ã€‚</li></ul><h1 id="FutureTaskå®ç°ç±»"><a href="#FutureTaskå®ç°ç±»" class="headerlink" title="FutureTaskå®ç°ç±»"></a>FutureTaskå®ç°ç±»</h1><p><code>Future</code>åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸èƒ½ç›´æ¥ç”¨æ¥åˆ›å»ºå¯¹è±¡ï¼Œ<code>FutureTask</code>æ˜¯<code>Future</code>çš„å®ç°ç±»ï¼Œ<code>FutureTask</code>çš„ç»§æ‰¿å›¾å¦‚ä¸‹:<br><img src="http://qiniu-pic.siven.net/blog/2018-01-31-073411.png" alt><br>å¯ä»¥çœ‹åˆ°,<code>FutureTask</code>å®ç°äº†<code>RunnableFuture</code>æ¥å£ï¼Œåˆ™<code>RunnableFuture</code>æ¥å£ç»§æ‰¿äº†<code>Runnable</code>æ¥å£å’Œ<code>Future</code>æ¥å£ï¼Œæ‰€ä»¥<code>FutureTask</code>æ—¢èƒ½å½“åšä¸€ä¸ª<code>Runnable</code>ç›´æ¥è¢«<code>Thread</code>æ‰§è¡Œï¼Œä¹Ÿèƒ½ä½œä¸º<code>Future</code>ç”¨æ¥å¾—åˆ°<code>Callable</code>çš„è®¡ç®—ç»“æœã€‚</p><h1 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h1><p><code>FutureTask</code>ä¸€èˆ¬é…åˆ<code>ExecutorService</code>æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡<code>Thread</code>æ¥ä½¿ç”¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseFuture</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸€ç§æ–¹å¼:Future + ExecutorService</span></span><br><span class="line"><span class="comment">         * Task task = new Task();</span></span><br><span class="line"><span class="comment">         * ExecutorService service = Executors.newCachedThreadPool();</span></span><br><span class="line"><span class="comment">         * Future&lt;Integer&gt; future = service.submit(task1);</span></span><br><span class="line"><span class="comment">         * service.shutdown();</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç¬¬äºŒç§æ–¹å¼: FutureTask + ExecutorService</span></span><br><span class="line"><span class="comment">         * ExecutorService executor = Executors.newCachedThreadPool();</span></span><br><span class="line"><span class="comment">         * Task task = new Task();</span></span><br><span class="line"><span class="comment">         * FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;Integer&gt;(task);</span></span><br><span class="line"><span class="comment">         * executor.submit(futureTask);</span></span><br><span class="line"><span class="comment">         * executor.shutdown();</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸‰ç§æ–¹å¼:FutureTask + Thread</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 2. æ–°å»ºFutureTask,éœ€è¦ä¸€ä¸ªå®ç°äº†Callableæ¥å£çš„ç±»çš„å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°</span></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> Task());</span><br><span class="line">        <span class="comment">// 3. æ–°å»ºThreadå¯¹è±¡å¹¶å¯åŠ¨</span></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(futureTask);</span><br><span class="line">        thread.setName(<span class="string">"Task thread"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Thread ["</span> + Thread.currentThread().getName() + <span class="string">"] is running"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. è°ƒç”¨isDone()åˆ¤æ–­ä»»åŠ¡æ˜¯å¦ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (!futureTask.isDone()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Task is not done"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 5. è°ƒç”¨get()æ–¹æ³•è·å–ä»»åŠ¡ç»“æœ,å¦‚æœä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆåˆ™é˜»å¡ç­‰å¾…</span></span><br><span class="line">            result = futureTask.get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"result is "</span> + result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ç»§æ‰¿Callableæ¥å£,å®ç°call()æ–¹æ³•,æ³›å‹å‚æ•°ä¸ºè¦è¿”å›çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Thread ["</span> + Thread.currentThread().getName() + <span class="string">"] is running"</span>);</span><br><span class="line">            <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) &#123;</span><br><span class="line">                result += i;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread [Task thread] is running</span><br><span class="line">Thread [main] is running</span><br><span class="line">Task is not done</span><br><span class="line">result is 4950</span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><code>FutureTask</code>çš„å®ç°è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå½“ç”¨æˆ·å®ç°<code>Callable</code>æ¥å£å®šä¹‰å¥½ä»»åŠ¡ä¹‹åï¼ŒæŠŠä»»åŠ¡äº¤ç»™å…¶ä»–çº¿ç¨‹è¿›è¡Œæ‰§è¡Œã€‚FutureTaskå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡çŠ¶æ€ï¼Œä»»ä½•æ“ä½œéƒ½æ˜¯å›´ç»•ç€è¿™ä¸ªçŠ¶æ€è¿›è¡Œï¼Œå¹¶éšæ—¶æ›´æ–°ä»»åŠ¡çŠ¶æ€ã€‚ä»»åŠ¡å‘èµ·è€…è°ƒç”¨get*()è·å–æ‰§è¡Œç»“æœçš„æ—¶å€™ï¼Œå¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ä¼šæŠŠè‡ªå·±æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­ç„¶åè¿›è¡Œé˜»å¡ç­‰å¾…ã€‚å½“ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ä¼šä¾æ¬¡å”¤é†’é˜»å¡ç­‰å¾…çš„çº¿ç¨‹ã€‚è°ƒç”¨cancel()å–æ¶ˆä»»åŠ¡çš„æ—¶å€™ä¹Ÿåªæ˜¯ç®€å•çš„ä¿®æ”¹ä»»åŠ¡çŠ¶æ€ï¼Œå¦‚æœéœ€è¦ä¸­æ–­ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹çš„è¯åˆ™è°ƒç”¨Thread.interrupt()ä¸­æ–­ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ã€‚</p><hr><blockquote><p>å‚è€ƒæ–‡ç« <br><a href="http://www.importnew.com/25286.html" target="_blank" rel="noopener">æ·±å…¥å­¦ä¹  FutureTask</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘æ¨¡å‹ï¼ˆäºŒï¼‰â€”â€”Master-Workeræ¨¡å¼</title>
      <link href="//posts/7d7b0ef9.html"/>
      <url>//posts/7d7b0ef9.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>Master-Worker</code>æ¨¡å¼æ˜¯å¸¸ç”¨çš„å¹¶è¡Œæ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œç³»ç»Ÿæœ‰ä¸¤ä¸ªè¿›ç¨‹åä½œå·¥ä½œï¼š<code>Master</code>è¿›ç¨‹ï¼Œè´Ÿè´£æ¥æ”¶å’Œåˆ†é…ä»»åŠ¡ï¼›<code>Worker</code>è¿›ç¨‹ï¼Œè´Ÿè´£å¤„ç†å­ä»»åŠ¡ã€‚å½“<code>Worker</code>è¿›ç¨‹å°†å­ä»»åŠ¡å¤„ç†å®Œæˆåï¼Œç»“æœè¿”å›ç»™<code>Master</code>è¿›ç¨‹ï¼Œç”±<code>Master</code>è¿›ç¨‹åšå½’çº³æ±‡æ€»ï¼Œæœ€åå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚</p><a id="more"></a><h1 id="ä»€ä¹ˆæ˜¯Master-Workeræ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯Master-Workeræ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯Master-Workeræ¨¡å¼"></a>ä»€ä¹ˆæ˜¯Master-Workeræ¨¡å¼</h1><p>è¯¥æ¨¡å¼çš„ç»“æ„å›¾:<br><img src="http://qiniu-pic.siven.net/blog/2018-01-19-071423.jpg" alt></p><p>ç»“æ„å›¾<br><img src="http://qiniu-pic.siven.net/blog/2018-01-19-071441.jpg" alt></p><ul><li><code>Worker</code>ï¼šç”¨äºå®é™…å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼›</li><li><code>Master</code>ï¼šä»»åŠ¡çš„åˆ†é…å’Œæœ€ç»ˆç»“æœçš„åˆæˆï¼›</li><li><code>Main</code>ï¼šå¯åŠ¨ç¨‹åºï¼Œè°ƒåº¦å¼€å¯Masterã€‚</li></ul><h1 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h1><p>ä¸‹é¢çš„æ˜¯ä¸€ä¸ªç®€æ˜“çš„Master-Workeræ¡†æ¶å®ç°ã€‚</p><h2 id="å®šä¹‰ä¸€ä¸ªTask"><a href="#å®šä¹‰ä¸€ä¸ªTask" class="headerlink" title="å®šä¹‰ä¸€ä¸ªTask"></a>å®šä¹‰ä¸€ä¸ªTask</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Masterçš„å®ç°"><a href="#Masterçš„å®ç°" class="headerlink" title="Masterçš„å®ç°"></a>Masterçš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Master</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1 æœ‰ä¸€ä¸ªç››æ”¾ä»»åŠ¡çš„å®¹å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ConcurrentLinkedQueue&lt;Task&gt; workQueue = <span class="keyword">new</span> ConcurrentLinkedQueue&lt;Task&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2 éœ€è¦æœ‰ä¸€ä¸ªç››æ”¾workerçš„é›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String, Thread&gt; workers = <span class="keyword">new</span> HashMap&lt;String, Thread&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3 éœ€è¦æœ‰ä¸€ä¸ªç››æ”¾æ¯ä¸€ä¸ªworkeræ‰§è¡Œä»»åŠ¡çš„ç»“æœé›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ConcurrentHashMap&lt;String, Object&gt; resultMap = <span class="keyword">new</span> ConcurrentHashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 4 Masterçš„æ„é€ ï¼Œéœ€è¦ä¸€ä¸ªWorkerè¿›ç¨‹é€»è¾‘ï¼Œå’Œéœ€è¦Workerè¿›ç¨‹æ•°é‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> worker      è¿›ç¨‹é€»è¾‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workerCount è¿›ç¨‹æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Master</span><span class="params">(Worker worker, <span class="keyword">int</span> workerCount)</span> </span>&#123;</span><br><span class="line">        worker.setWorkQueue(<span class="keyword">this</span>.workQueue);</span><br><span class="line">        worker.setResultMap(<span class="keyword">this</span>.resultMap);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; workerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.workers.put(Integer.toString(i), <span class="keyword">new</span> Thread(worker));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 5 éœ€è¦ä¸€ä¸ªæäº¤ä»»åŠ¡çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.workQueue.add(task);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 6 éœ€è¦æœ‰ä¸€ä¸ªæ‰§è¡Œçš„æ–¹æ³•ï¼Œå¯åŠ¨æ‰€æœ‰çš„workeræ–¹æ³•å»æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Thread&gt; me : workers.entrySet()) &#123;</span><br><span class="line">            me.getValue().start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 7 åˆ¤æ–­æ˜¯å¦è¿è¡Œç»“æŸçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Thread&gt; me : workers.entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (me.getValue().getState() != Thread.State.TERMINATED) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 8 è®¡ç®—ç»“æœæ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> priceResult = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; me : resultMap.entrySet()) &#123;</span><br><span class="line">            priceResult += (Integer) me.getValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> priceResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Workerçš„å®ç°"><a href="#Workerçš„å®ç°" class="headerlink" title="Workerçš„å®ç°"></a>Workerçš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨äºå–å¾—å­ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ConcurrentLinkedQueue&lt;Task&gt; workQueue;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­ä»»åŠ¡å¤„ç†ç»“æœé›†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ConcurrentHashMap&lt;String, Object&gt; resultMap;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWorkQueue</span><span class="params">(ConcurrentLinkedQueue&lt;Task&gt; workQueue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResultMap</span><span class="params">(ConcurrentHashMap&lt;String, Object&gt; resultMap)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.resultMap = resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//è·å–å­ä»»åŠ¡</span></span><br><span class="line">            Task input = <span class="keyword">this</span>.workQueue.poll();</span><br><span class="line">            <span class="keyword">if</span> (input == <span class="keyword">null</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//å¤„ç†å­ä»»åŠ¡</span></span><br><span class="line">            Object output = handle(input);</span><br><span class="line">            <span class="keyword">this</span>.resultMap.put(Integer.toString(input.getId()), output);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŠ½è±¡å­ä»»åŠ¡å¤„ç†çš„é€»è¾‘ï¼Œåœ¨å­ç±»ä¸­å®ç°å…·ä½“é€»è¾‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> input</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Object <span class="title">handle</span><span class="params">(Task input)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="WorkeræŠ½è±¡æ–¹æ³•handleçš„å®ç°"><a href="#WorkeræŠ½è±¡æ–¹æ³•handleçš„å®ç°" class="headerlink" title="WorkeræŠ½è±¡æ–¹æ³•handleçš„å®ç°"></a>WorkeræŠ½è±¡æ–¹æ³•handleçš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWoker</span> <span class="keyword">extends</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">handle</span><span class="params">(Task input)</span> </span>&#123;</span><br><span class="line">        Object output = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å¤„ç†ä»»åŠ¡çš„è€—æ—¶ã€‚ã€‚ æ¯”å¦‚è¯´è¿›è¡Œæ“ä½œæ•°æ®åº“ã€‚ã€‚ã€‚</span></span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            output = input.getPrice();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿›è¡Œè®¡ç®—çš„Mainå‡½æ•°"><a href="#è¿›è¡Œè®¡ç®—çš„Mainå‡½æ•°" class="headerlink" title="è¿›è¡Œè®¡ç®—çš„Mainå‡½æ•°"></a>è¿›è¡Œè®¡ç®—çš„Mainå‡½æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–ç³»ç»Ÿå¯ç”¨çš„çº¿ç¨‹æ•°</span></span><br><span class="line">        <span class="keyword">int</span> i1 = Runtime.getRuntime().availableProcessors();</span><br><span class="line">        System.out.println(i1);</span><br><span class="line">        Master master = <span class="keyword">new</span> Master(<span class="keyword">new</span> MyWoker(), i1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ Taskå¹¶æäº¤masterä»»åŠ¡</span></span><br><span class="line">        Random r = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            Task t = <span class="keyword">new</span> Task();</span><br><span class="line">            t.setId(i);</span><br><span class="line">            t.setPrice(r.nextInt(<span class="number">1000</span>));</span><br><span class="line">            master.submit(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">        master.execute();</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (master.isComplete()) &#123;</span><br><span class="line">                <span class="keyword">long</span> end = System.currentTimeMillis() - start;</span><br><span class="line">                <span class="keyword">int</span> priceResult = master.getResult();</span><br><span class="line">                System.out.println(<span class="string">"æœ€ç»ˆç»“æœï¼š"</span> + priceResult + <span class="string">", æ‰§è¡Œæ—¶é—´ï¼š"</span> + end);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><code>Master-Worker</code>æ¨¡å¼æ˜¯ä¸€ç§å°†ä¸²è¡Œä»»åŠ¡å¹¶è¡ŒåŒ–çš„æ–¹æ¡ˆï¼Œè¢«åˆ†è§£çš„å­ä»»åŠ¡åœ¨ç³»ç»Ÿä¸­å¯ä»¥è¢«å¹¶è¡Œå¤„ç†ï¼ŒåŒæ—¶ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œ<code>Master</code>è¿›ç¨‹ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰å­ä»»åŠ¡éƒ½å®Œæˆè®¡ç®—ï¼Œå°±å¯ä»¥æ ¹æ®å·²æœ‰çš„éƒ¨åˆ†ç»“æœé›†è®¡ç®—æœ€ç»ˆç»“æœé›†ã€‚</p><hr><p>å‚è€ƒæ–‡ç« : <a href="http://blog.csdn.net/lmdcszh/article/details/39698189" target="_blank" rel="noopener">å¹¶å‘æ¨¡å‹ï¼ˆäºŒï¼‰â€”â€”Master-Workeræ¨¡å¼</a></p>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘æ¨¡å‹ï¼ˆä¸€ï¼‰â€”â€”Futureæ¨¡å¼</title>
      <link href="//posts/e3120e4f.html"/>
      <url>//posts/e3120e4f.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¤šçº¿ç¨‹å¼€å‘å¯ä»¥æ›´å¥½çš„å‘æŒ¥å¤šæ ¸cpuæ€§èƒ½ï¼Œå¸¸ç”¨çš„å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼æœ‰ï¼š<code>Future</code>ã€<code>Master-Worker</code>ã€<code>Guard Susperionsion</code>ã€ä¸å˜ã€ç”Ÿäº§è€…-æ¶ˆè´¹è€… æ¨¡å¼ï¼›jdké™¤äº†å®šä¹‰äº†è‹¥å¹²å¹¶å‘çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿå†…ç½®äº†å¤šçº¿ç¨‹æ¡†æ¶å’Œå„ç§çº¿ç¨‹æ± é”ï¼ˆåˆ†ä¸ºå†…éƒ¨é”ã€é‡å…¥é”ã€è¯»å†™é”ï¼‰ã€ThreadLocalã€ä¿¡å·é‡ç­‰åœ¨å¹¶å‘æ§åˆ¶ä¸­å‘æŒ¥ç€å·¨å¤§çš„ä½œç”¨ã€‚è¿™é‡Œé‡ç‚¹ä»‹ç»ç¬¬ä¸€ç§å¹¶å‘â€”â€”<code>Futureæ¨¡å‹</code>ã€‚</p><a id="more"></a><h1 id="ä»€ä¹ˆæ˜¯Futureæ¨¡å‹"><a href="#ä»€ä¹ˆæ˜¯Futureæ¨¡å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯Futureæ¨¡å‹"></a>ä»€ä¹ˆæ˜¯Futureæ¨¡å‹</h1><p>è¯¥æ¨¡å‹æ˜¯å°†å¼‚æ­¥è¯·æ±‚å’Œä»£ç†æ¨¡å¼è”åˆçš„æ¨¡å‹äº§ç‰©ã€‚ç±»ä¼¼å•†å“è®¢å•æ¨¡å‹ã€‚è§ä¸‹å›¾ï¼š<br><img src="http://qiniu-pic.siven.net/blog/2018-01-19-070110.jpg" alt><br>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé•¿æ—¶é—´çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸éœ€ç­‰å¾…è¯¥æ•°æ®å¤„ç†å®Œæˆä¾¿ç«‹å³è¿”å›ä¸€ä¸ªä¼ªé€ çš„ä»£ç†æ•°æ®ï¼ˆç›¸å½“äºå•†å“è®¢å•ï¼Œä¸æ˜¯å•†å“æœ¬èº«ï¼‰ï¼Œç”¨æˆ·ä¹Ÿæ— éœ€ç­‰å¾…ï¼Œå…ˆå»æ‰§è¡Œå…¶ä»–çš„è‹¥å¹²æ“ä½œåï¼Œå†å»è°ƒç”¨æœåŠ¡å™¨å·²ç»å®Œæˆç»„è£…çš„çœŸå®æ•°æ®ã€‚è¯¥æ¨¡å‹å……åˆ†åˆ©ç”¨äº†ç­‰å¾…çš„æ—¶é—´ç‰‡æ®µã€‚</p><h1 id="Futureæ¨¡å¼çš„æ ¸å¿ƒç»“æ„"><a href="#Futureæ¨¡å¼çš„æ ¸å¿ƒç»“æ„" class="headerlink" title="Futureæ¨¡å¼çš„æ ¸å¿ƒç»“æ„"></a>Futureæ¨¡å¼çš„æ ¸å¿ƒç»“æ„</h1><p><img src="http://qiniu-pic.siven.net/blog/2018-01-19-070203.jpg" alt></p><ul><li><p><code>Main</code>ï¼šå¯åŠ¨ç³»ç»Ÿï¼Œè°ƒç”¨Clientå‘å‡ºè¯·æ±‚ï¼›</p></li><li><p><code>Client</code>ï¼šè¿”å›Dataå¯¹è±¡ï¼Œç†è§£è¿”å›FutureDataï¼Œå¹¶å¼€å¯ClientThreadçº¿ç¨‹è£…é…RealDataï¼›</p></li><li><p><code>Data</code>ï¼šè¿”å›æ•°æ®çš„æ¥å£ï¼›</p></li><li><p><code>FutureData</code>ï¼šFutureæ•°æ®ï¼Œæ„é€ å¾ˆå¿«ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®ï¼Œéœ€è¦è£…é…RealDataï¼›</p></li><li><p><code>RealData</code>ï¼šçœŸå®æ•°æ®ï¼Œæ„é€ æ¯”è¾ƒæ…¢ã€‚</p></li></ul><h1 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h1><h2 id="Mainå‡½æ•°"><a href="#Mainå‡½æ•°" class="headerlink" title="Mainå‡½æ•°"></a>Mainå‡½æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">FutureClient fc = <span class="keyword">new</span> FutureClient();</span><br><span class="line">Data data = fc.request(<span class="string">"è¯·æ±‚å‚æ•°"</span>);</span><br><span class="line">System.out.println(<span class="string">"è¯·æ±‚å‘é€æˆåŠŸ!"</span>);</span><br><span class="line">System.out.println(<span class="string">"åšå…¶ä»–çš„äº‹æƒ…..."</span>);</span><br><span class="line"></span><br><span class="line">String result = data.getRequest();</span><br><span class="line">System.out.println(result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Clientçš„å®ç°"><a href="#Clientçš„å®ç°" class="headerlink" title="Clientçš„å®ç°"></a>Clientçš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Data <span class="title">request</span><span class="params">(<span class="keyword">final</span> String queryStr)</span></span>&#123;</span><br><span class="line"><span class="comment">//1 æˆ‘æƒ³è¦ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆDataæ¥å£çš„å®ç°ç±»ï¼‰å…ˆè¿”å›ç»™å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œå‘Šè¯‰ä»–è¯·æ±‚å·²ç»æ¥æ”¶åˆ°ï¼Œå¯ä»¥åšå…¶ä»–çš„äº‹æƒ…</span></span><br><span class="line"><span class="keyword">final</span> FutureData futureData = <span class="keyword">new</span> FutureData();</span><br><span class="line"><span class="comment">//2 å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå»åŠ è½½çœŸå®çš„æ•°æ®ï¼Œä¼ é€’ç»™è¿™ä¸ªä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//3 è¿™ä¸ªæ–°çš„çº¿ç¨‹å¯ä»¥å»æ…¢æ…¢çš„åŠ è½½çœŸå®å¯¹è±¡ï¼Œç„¶åä¼ é€’ç»™ä»£ç†å¯¹è±¡</span></span><br><span class="line">RealData realData = <span class="keyword">new</span> RealData(queryStr);</span><br><span class="line">futureData.setRealData(realData);</span><br><span class="line">&#125;</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> futureData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Dataçš„å®ç°"><a href="#Dataçš„å®ç°" class="headerlink" title="Dataçš„å®ç°"></a>Dataçš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Data</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">getRequest</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="FutureDataçš„å®ç°"><a href="#FutureDataçš„å®ç°" class="headerlink" title="FutureDataçš„å®ç°"></a>FutureDataçš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * æ˜¯å¯¹RealDataçš„ä¸€ä¸ªåŒ…è£… </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureData</span> <span class="keyword">implements</span> <span class="title">Data</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RealData realData;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isReady = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setRealData</span><span class="params">(RealData realData)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå·²ç»è£…è½½å®Œæ¯•äº†ï¼Œå°±ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (isReady) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡è£…è½½ï¼Œè¿›è¡Œè£…è½½çœŸå®å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">this</span>.realData = realData;</span><br><span class="line">        isReady = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">//è¿›è¡Œé€šçŸ¥</span></span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡è£…è½½å¥½ ç¨‹åºå°±ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">while</span> (!isReady) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è£…è½½å¥½ç›´æ¥è·å–æ•°æ®å³å¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.realData.getRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RealDataçš„å®ç°"><a href="#RealDataçš„å®ç°" class="headerlink" title="RealDataçš„å®ç°"></a>RealDataçš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealData</span> <span class="keyword">implements</span> <span class="title">Data</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String result ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">RealData</span> <span class="params">(String queryStr)</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"æ ¹æ®"</span> + queryStr + <span class="string">"è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆè€—æ—¶çš„æ“ä½œ.."</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"æ“ä½œå®Œæ¯•ï¼Œè·å–ç»“æœ"</span>);</span><br><span class="line">result = <span class="string">"æŸ¥è¯¢ç»“æœ"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li><p>FutureDataæ˜¯å¯¹RealDataçš„åŒ…è£…ï¼Œæ˜¯å¯¹çœŸå®æ•°æ®çš„ä¸€ä¸ªä»£ç†ï¼Œå°è£…äº†è·å–çœŸå®æ•°æ®çš„ç­‰å¾…è¿‡ç¨‹ã€‚å®ƒä»¬éƒ½å®ç°äº†å…±åŒçš„æ¥å£ï¼Œæ‰€ä»¥ï¼Œé’ˆå¯¹å®¢æˆ·ç«¯ç¨‹åºç»„æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼›</p></li><li><p>å®¢æˆ·ç«¯åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸­ï¼Œå•ç‹¬å¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å®ŒæˆçœŸå®æ•°æ®çš„ç»„ç»‡ï¼Œè¿™å¯¹è°ƒç”¨å®¢æˆ·ç«¯çš„mainå‡½æ•°å¼å°é—­çš„ï¼›</p></li><li><p>å› ä¸ºåœ¨FutureDataä¸­çš„notifyå’Œwaitå‡½æ•°ï¼Œä¸»ç¨‹åºä¼šç­‰å¾…ç»„è£…å®Œæˆåå†ä¼šç»§ç»­ä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæ²¡æœ‰ç»„è£…å®Œæˆï¼Œmainå‡½æ•°ä¼šä¸€ç›´ç­‰å¾…ã€‚</p></li></ul><hr><blockquote><p>å‚è€ƒæ–‡ç« : <a href="http://blog.csdn.net/lmdcszh/article/details/39696357" target="_blank" rel="noopener">å¹¶å‘æ¨¡å‹ï¼ˆä¸€ï¼‰â€”â€”Futureæ¨¡å¼</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat + Nginx è´Ÿè½½å‡è¡¡é…ç½®è¯¦è§£</title>
      <link href="//posts/8bcfa124.html"/>
      <url>//posts/8bcfa124.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>Nginx</code> + <code>Tomcat</code>é›†ç¾¤æ˜¯å¤§å®¶å¸¸ç”¨çš„ä¸€ç§æ­é…ï¼Œ å¥½å¤„æœ‰å¾ˆå¤š, è€Œæˆ‘åšè¿™ä¸ªçš„åˆè¡·å°±ä¸¤ä¸ªç›®çš„ï¼š </p><ol><li>è§£å†³<code>Tomcat</code>çš„è´Ÿè½½å‡è¡¡é—®é¢˜ï¼› </li><li>å½“æˆ‘ä¸Šçº¿çš„æ—¶å€™, å¯åŠ¨<code>Tomcat</code>, èƒ½å¤Ÿåšåˆ°å¤–éƒ¨è®¿é—®ä¸é—´æ–­ï¼›</li></ol><p><img src="http://qiniu-pic.siven.net/blog/2018-03-01-122855.jpg" alt></p><a id="more"></a><h1 id="Nginxå®‰è£…"><a href="#Nginxå®‰è£…" class="headerlink" title="Nginxå®‰è£…"></a>Nginxå®‰è£…</h1><p>å‚çœ‹ <a href="../posts/3347f9ca.html">Nginxçš„å®‰è£…åŠé…ç½®è¯¦è§£</a></p><h1 id="TomcatæœåŠ¡å™¨é…ç½®"><a href="#TomcatæœåŠ¡å™¨é…ç½®" class="headerlink" title="TomcatæœåŠ¡å™¨é…ç½®"></a>TomcatæœåŠ¡å™¨é…ç½®</h1><blockquote></blockquote><p>æ–°å»ºä¸¤ä¸ª<code>Tomcat</code>æœåŠ¡å™¨åˆ†åˆ«æ˜¯ï¼š<br>Tomcat1ï¼Œç«¯å£å·ï¼š<code>8180</code><br>Tomcat2ï¼Œç«¯å£å·ï¼š<code>8280</code></p><h2 id="ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat1"><a href="#ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat1" class="headerlink" title="ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat1"></a>ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat1</h2><p>ç¼–è¾‘é…ç½®æ–‡ä»¶: <code>/tomcat1/conf/server.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8105"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">port</span>=<span class="string">"8180"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8109"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p><p>è¿™3ä¸ªå…³é”®å­åœ°æ–¹çš„port, å¾ˆå¥½è®°, æˆ‘ç°åœ¨ä¿®æ”¹åéƒ½æ˜¯ä»¥ 81å¼€å¤´çš„, è€Œä¹‹åçš„tomcat2 æˆ‘å°±ä¼šä»¥82å¼€å¤´:</p><h2 id="ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat2"><a href="#ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat2" class="headerlink" title="ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat2"></a>ç¼–è¾‘Tomcaté…ç½®æ–‡ä»¶tomcat2</h2><p>ç¼–è¾‘é…ç½®æ–‡ä»¶: <code>/tomcat2/conf/server.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8205"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">port</span>=<span class="string">"8280"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">redirectPort</span>=<span class="string">"8243"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8209"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8243"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p><hr><p>åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªTomcatæœåŠ¡å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sh /service/tomcat1/bin/startup.sh</span><br><span class="line">sh /service/tomcat1/bin/startup.sh</span><br></pre></td></tr></table></figure><hr><p>è®¿é—®åœ°å€æŸ¥çœ‹Tomcatç»“æœï¼š<br>Tomcat1ï¼š<a href="http://127.0.0.1:8180/" target="_blank" rel="noopener">http://127.0.0.1:8180/</a><br><img src="http://qiniu-pic.siven.net/blog/2018-01-06-052625.png" alt></p><p>Tomcat2ï¼š<a href="http://127.0.0.1:8280/" target="_blank" rel="noopener">http://127.0.0.1:8280/</a><br><img src="http://qiniu-pic.siven.net/blog/2018-01-06-052709.png" alt></p><h1 id="Nginxè´Ÿè½½å‡è¡¡é…ç½®"><a href="#Nginxè´Ÿè½½å‡è¡¡é…ç½®" class="headerlink" title="Nginxè´Ÿè½½å‡è¡¡é…ç½®"></a>Nginxè´Ÿè½½å‡è¡¡é…ç½®</h1><h2 id="ç¼–è¾‘é…ç½®æ–‡ä»¶"><a href="#ç¼–è¾‘é…ç½®æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>ç¼–è¾‘é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><h2 id="æˆ‘çš„ç®€å•é…ç½®"><a href="#æˆ‘çš„ç®€å•é…ç½®" class="headerlink" title="æˆ‘çš„ç®€å•é…ç½®"></a>æˆ‘çš„ç®€å•é…ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">pid  logs/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    sendfile        on;</span><br><span class="line">    </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    </span><br><span class="line">    upstream mysvr &#123;  </span><br><span class="line">        #ip_hash;</span><br><span class="line">        server 127.0.0.1:8180 weight=1;</span><br><span class="line">        server 127.0.0.1:8280 weight=2;</span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  127.0.0.1;</span><br><span class="line">        index index.jsp;</span><br><span class="line"></span><br><span class="line">        charset utf-8;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass  http://mysvr;  </span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®æµ‹è¯•"><a href="#è®¿é—®æµ‹è¯•" class="headerlink" title="è®¿é—®æµ‹è¯•"></a>è®¿é—®æµ‹è¯•</h2><p>è¯·æ±‚<code>Nginx</code>è®¿é—®åœ°å€ï¼š<a href="http://127.0.0.1:80/" target="_blank" rel="noopener">http://127.0.0.1:80/</a></p><ul><li>å‚è€ƒèµ„æ–™ï¼š<br><a href="http://my.oschina.net/vernon/blog/282925?p=1" target="_blank" rel="noopener">Nginx + Tomcaté›†ç¾¤, æµ‹è¯•OK</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Nginx </tag>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOSå®‰è£…Nodejs</title>
      <link href="//posts/33b4e017.html"/>
      <url>//posts/33b4e017.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‹è½½Nodejs"><a href="#ä¸‹è½½Nodejs" class="headerlink" title="ä¸‹è½½Nodejs"></a>ä¸‹è½½Nodejs</h1><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Nodeå®˜ç½‘</a></p><p><img src="http://qiniu-pic.siven.net/blog/htryo.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://npm.taobao.org/mirrors/node/v8.0.0/node-v8.0.0-linux-x64.tar.xz</span><br></pre></td></tr></table></figure><h1 id="è§£å‹-amp-ç§»åŠ¨ç›®å½•"><a href="#è§£å‹-amp-ç§»åŠ¨ç›®å½•" class="headerlink" title="è§£å‹ &amp; ç§»åŠ¨ç›®å½•"></a>è§£å‹ &amp; ç§»åŠ¨ç›®å½•</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf node-v8.0.0-linux-x64.tar.xz</span><br><span class="line">mv node-v8.0.0-linux-x64 /usr/local/node</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">#set for nodejs</span><br><span class="line">export NODE_HOME=/usr/local/node</span><br><span class="line">export PATH=$NODE_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h1 id="æµ‹è¯•å®‰è£…"><a href="#æµ‹è¯•å®‰è£…" class="headerlink" title="æµ‹è¯•å®‰è£…"></a>æµ‹è¯•å®‰è£…</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><h1 id="æ·˜å®NPMé•œåƒ"><a href="#æ·˜å®NPMé•œåƒ" class="headerlink" title="æ·˜å®NPMé•œåƒ"></a>æ·˜å®NPMé•œåƒ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> CentOS </tag>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx SSL ç»“åˆTomcat é‡å®šå‘URLå˜æˆHTTPçš„é—®é¢˜</title>
      <link href="//posts/d925bb5d.html"/>
      <url>//posts/d925bb5d.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‚è€ƒèµ„æ–™: <a href="http://emacsist.github.io/2016/01/19/Nginx-SSL-ç»“åˆTomcat-é‡å®šå‘URLå˜æˆHTTPçš„é—®é¢˜/" target="_blank" rel="noopener">ã€ŠNginx SSL ç»“åˆTomcat é‡å®šå‘URLå˜æˆHTTPçš„é—®é¢˜ã€‹</a><br>ä»¥ä¸‹å†…å®¹å¯¹è¯¥æ–‡ç« è¿›è¡Œå®è·µçš„è¿‡ç¨‹è¿›è¡Œè®°å½•è¯´æ˜</p></blockquote><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ç”±äºè¦é…ç½®æœåŠ¡å™¨(Nginx + Tomcatï¼‰çš„SSLçš„é—®é¢˜ï¼ˆNginxåŒæ—¶ç›‘å¬<code>HTTP</code>å’Œ<code>HTTPS</code>)ï¼Œä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯<code>HTTPS</code>åè®®ï¼Œç„¶åTomcatè¿›è¡Œé‡å®šå‘çš„æ—¶å€™ï¼Œå´å˜æˆäº†<code>HTTP</code>.</p><a id="more"></a><h2 id="é€æ­¥å®è·µè¿‡ç¨‹"><a href="#é€æ­¥å®è·µè¿‡ç¨‹" class="headerlink" title="é€æ­¥å®è·µè¿‡ç¨‹"></a>é€æ­¥å®è·µè¿‡ç¨‹</h2><p>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€äº›èµ„æ–™ï¼Œæœ‰äº›æ˜¯é€šè¿‡ä¿®æ”¹Nginxé…ç½®å³å¯è§£å†³ï¼Œä¹Ÿæœ‰åªå¯¹Tomcaté…ç½®è¿›è¡Œè°ƒæ•´è§£å†³çš„â€¦ å„è¯´ä¸ä¸€ï¼Œä»¥ä¸‹å¯¹å°è¯•çš„è§£å†³è¿‡ç¨‹è¿›è¡Œè®°å½•ï¼š</p><h3 id="å®è·µä¸€ï¼šNginxæ–°å¢é…ç½®"><a href="#å®è·µä¸€ï¼šNginxæ–°å¢é…ç½®" class="headerlink" title="å®è·µä¸€ï¼šNginxæ–°å¢é…ç½®"></a>å®è·µä¸€ï¼šNginxæ–°å¢é…ç½®</h3><blockquote><p>HTTPåè®®åˆ¶è½¬ä¸ºhttps</p></blockquote><p>Nginxä»£ç†çš„é…ç½®ï¼Œè¦æ·»åŠ ä»¥ä¸‹å†…å®¹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://test-server;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">    # å¿…é¡»é…ç½®:</span><br><span class="line">    proxy_set_header X-Forwarded-Proto  $scheme;</span><br><span class="line"></span><br><span class="line">    # ä½œç”¨æ˜¯å¯¹å‘é€ç»™å®¢æˆ·ç«¯çš„URLè¿›è¡Œä¿®æ”¹, å°†httpåè®®å¼ºåˆ¶è½¬ä¸ºhttps</span><br><span class="line">    proxy_redirect   http:// https://;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•<code>proxy_redirect</code>å¼ºåˆ¶è½¬æ¢, httpï¼ˆ80ï¼‰ã€httpsï¼ˆ443ï¼‰å…±å­˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen  80;  </span><br><span class="line">    listen  443 ssl;  </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="é‡å®šå‘æµ‹è¯•"><a href="#é‡å®šå‘æµ‹è¯•" class="headerlink" title="é‡å®šå‘æµ‹è¯•"></a>é‡å®šå‘æµ‹è¯•</h4><ul><li><p>JAVA CODEï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpServletResponse resp = (HttpServletResponse)response;</span><br><span class="line">resp.sendRedirect(<span class="string">"/static/html/index.html"</span>);</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>HTTP</code>åè®®è®¿é—®<code>nginx</code>ä»£ç†åœ°å€ä¹‹å,URLè¢«é‡å®šå‘ä¸º<code>HTTPS</code>åè®®äº†ï¼Œ å¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="http://qiniu-pic.siven.net/blog/2018-01-05-095224.png" alt></p></li></ul><ul><li>å½“ç„¶ç›´æ¥ä½¿ç”¨HTTPSåè®®è®¿é—®, è‚¯å®šä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="http://qiniu-pic.siven.net/blog/2018-01-05-095340.png" alt></li></ul><h4 id="è½¬å‘æµ‹è¯•"><a href="#è½¬å‘æµ‹è¯•" class="headerlink" title="è½¬å‘æµ‹è¯•"></a>è½¬å‘æµ‹è¯•</h4><ul><li><p>JAVA CODEï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpServletResponse resp = (HttpServletResponse)response;</span><br><span class="line">req.getRequestDispatcher(<span class="string">"/static/html/index.html"</span>).forward(request, response);</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•ç»“æœä¸é‡å®šå‘ä¸€è‡´, æ— å¼‚å¸¸æƒ…å†µ;</p></li></ul><h4 id="æµ‹è¯•æ€»ç»“"><a href="#æµ‹è¯•æ€»ç»“" class="headerlink" title="æµ‹è¯•æ€»ç»“"></a>æµ‹è¯•æ€»ç»“</h4><p>å®é™…åº”ç”¨åœºæ™¯ä¸­,å¦‚æœè¦æ±‚<code>HTTP</code>ä¸<code>HTTPS</code>åè®®å…±å­˜çš„æ—¶å€™(è¯·æ±‚çš„åè®®ä¸å“åº”çš„åè®®ä¸€è‡´)å°±ä¼šå‡ºç°<code>HTTP</code>è¯·æ±‚è¢«å¼ºè½¬ä¸º<code>HTTPS</code>ï¼Œå°è¯•å°†Nginxé…ç½®<code>proxy_redirect   http:// https://;</code>æ³¨é‡Šï¼Œæœ€ç»ˆä½¿ç”¨<code>HTTPS</code>åè®®äº¦æ— æ³•æ­£å¸¸è·³è½¬;</p><h3 id="å®è·µäºŒï¼šTomcatæ–°å¢é…ç½®"><a href="#å®è·µäºŒï¼šTomcatæ–°å¢é…ç½®" class="headerlink" title="å®è·µäºŒï¼šTomcatæ–°å¢é…ç½®"></a>å®è·µäºŒï¼šTomcatæ–°å¢é…ç½®</h3><blockquote><p>ä¸ä¿®æ”¹Nginxçš„æƒ…å†µä¸‹, ä»…å¯¹Tomcaté…ç½®è¿›è¡Œè°ƒæ•´</p></blockquote><p>åœ¨<code>server.xml</code>çš„<code>Engine</code>æ¨¡å—ä¸‹é¢é…ç½®å¤šä¸€ä¸ªä»¥ä¸‹çš„<code>Valve</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span>  <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteIpValve"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">remoteIpHeader</span>=<span class="string">"X-Forwarded-For"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">protocolHeader</span>=<span class="string">"X-Forwarded-Proto"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">protocolHeaderHttpsValue</span>=<span class="string">"https"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p><h4 id="é‡å®šå‘æµ‹è¯•-1"><a href="#é‡å®šå‘æµ‹è¯•-1" class="headerlink" title="é‡å®šå‘æµ‹è¯•"></a>é‡å®šå‘æµ‹è¯•</h4><p>ä½¿ç”¨<code>HTTPS</code>åè®®è®¿é—®æ—¶,æœ€ç»ˆè¢«é‡å®šå‘åˆ°<code>HTTP</code><br><img src="http://qiniu-pic.siven.net/blog/2018-01-05-112959.png" alt></p><h4 id="è½¬å‘æµ‹è¯•-1"><a href="#è½¬å‘æµ‹è¯•-1" class="headerlink" title="è½¬å‘æµ‹è¯•"></a>è½¬å‘æµ‹è¯•</h4><p>ä½¿ç”¨<code>HTTPS</code>åè®®è®¿é—®ï¼Œè½¬å‘åŠ¨ä½œæœªå‡ºç°é—®é¢˜<br><img src="http://qiniu-pic.siven.net/blog/2018-01-05-113147.png" alt></p><h4 id="æµ‹è¯•æ€»ç»“-1"><a href="#æµ‹è¯•æ€»ç»“-1" class="headerlink" title="æµ‹è¯•æ€»ç»“"></a>æµ‹è¯•æ€»ç»“</h4><p>é‡å®šå‘çš„æ—¶å€™, <code>HTTPS</code>åè®®è¢«è½¬ä¸º<code>HTTP</code>ï¼Œæµ‹è¯•ç»“æœä¸é€šè¿‡ã€‚</p><h3 id="å®è·µä¸‰ï¼šç»ˆææ–¹æ¡ˆ"><a href="#å®è·µä¸‰ï¼šç»ˆææ–¹æ¡ˆ" class="headerlink" title="å®è·µä¸‰ï¼šç»ˆææ–¹æ¡ˆ"></a>å®è·µä¸‰ï¼šç»ˆææ–¹æ¡ˆ</h3><h4 id="Nginx-é…ç½®"><a href="#Nginx-é…ç½®" class="headerlink" title="Nginx é…ç½®"></a>Nginx é…ç½®</h4><p>å¯¹è¿‡ç¨‹ä¸€Nginxé…ç½®è¿›è¡Œè°ƒæ•´æ³¨é‡Šæˆ–åˆ é™¤<code>proxy_redirect</code>ï¼Œæœ€ç»ˆå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://test-server;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">    # å¿…é¡»é…ç½®:</span><br><span class="line">    proxy_set_header X-Forwarded-Proto  $scheme;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Tomcat-é…ç½®"><a href="#Tomcat-é…ç½®" class="headerlink" title="Tomcat é…ç½®"></a>Tomcat é…ç½®</h4><p>å‚çœ‹ï¼š<a href="#å®è·µäºŒtomcatæ–°å¢é…ç½®">Tomcaté…ç½®</a></p><h4 id="æµ‹è¯•è¿‡ç¨‹"><a href="#æµ‹è¯•è¿‡ç¨‹" class="headerlink" title="æµ‹è¯•è¿‡ç¨‹"></a>æµ‹è¯•è¿‡ç¨‹</h4><h5 id="HTTPåè®®è¯·æ±‚"><a href="#HTTPåè®®è¯·æ±‚" class="headerlink" title="HTTPåè®®è¯·æ±‚"></a>HTTPåè®®è¯·æ±‚</h5><p><img src="http://qiniu-pic.siven.net/blog/2018-01-05-115344.png" alt></p><h5 id="HTTPSåè®®è¯·æ±‚"><a href="#HTTPSåè®®è¯·æ±‚" class="headerlink" title="HTTPSåè®®è¯·æ±‚"></a>HTTPSåè®®è¯·æ±‚</h5><p><img src="http://qiniu-pic.siven.net/blog/2018-01-05-115431.png" alt></p><h4 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h4><p>æµ‹è¯•é€šè¿‡ï¼Œæ— è®ºä½¿ç”¨HTTPè®¿é—®è¿˜æ˜¯HTTPSè®¿é—®ï¼Œæœ€ç»ˆè¿”å›éƒ½æ˜¯æ ¹æ®è¯·æ±‚çš„åè®®è¿›è¡Œå“åº”ï¼Œé—®é¢˜è§£å†³ã€‚</p><h2 id="å®Œæ•´é…ç½®"><a href="#å®Œæ•´é…ç½®" class="headerlink" title="å®Œæ•´é…ç½®"></a>å®Œæ•´é…ç½®</h2><ul><li>Nginx</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream test-server &#123;  </span><br><span class="line">        server 10.15.16.6:8280 weight=1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #ssl_certificate      cert.pem;</span><br><span class="line">        #ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">        ssl_certificate      server.crt;</span><br><span class="line">        ssl_certificate_key  server.key;</span><br><span class="line"></span><br><span class="line">       # ssl_session_cache    shared:SSL:1m;</span><br><span class="line">       #ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">       # ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">       # ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://test-server;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">            proxy_set_header X-Forwarded-Proto  $scheme;</span><br><span class="line">            # proxy_redirect   http:// https://;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> Tomcat </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå®‰è£…åŠé…ç½®è¯¦è§£</title>
      <link href="//posts/3347f9ca.html"/>
      <url>//posts/3347f9ca.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>Nginx</code>æ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ä¹Ÿå¯ä»¥ç”¨æ¥åšè´Ÿè½½å‡è¡¡åŠåå‘ä»£ç†ä½¿ç”¨ï¼Œç›®å‰ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œå…·ä½“ç®€ä»‹æˆ‘å°±ä¸ä»‹ç»äº†ç™¾åº¦ä¸€ä¸‹æœ‰å¾ˆå¤šï¼Œä¸‹é¢ç›´æ¥è¿›å…¥å®‰è£…æ­¥éª¤ï¼›</p><ul><li>Nginxç›¸å…³åœ°å€<br>æºç ï¼š<a href="https://trac.nginx.org/nginx/browser" target="_blank" rel="noopener">https://trac.nginx.org/nginx/browser</a><br>å®˜ç½‘ï¼š<a href="http://www.nginx.org/" target="_blank" rel="noopener">http://www.nginx.org/</a></li></ul><a id="more"></a><h1 id="å®‰è£…NginxåŠç›¸å…³ç»„ä»¶"><a href="#å®‰è£…NginxåŠç›¸å…³ç»„ä»¶" class="headerlink" title="å®‰è£…NginxåŠç›¸å…³ç»„ä»¶"></a>å®‰è£…NginxåŠç›¸å…³ç»„ä»¶</h1><p><strong>Nginxä¾èµ–ä»¥ä¸‹æ¨¡å—</strong></p><ul><li>gzipæ¨¡å—éœ€è¦ zlib åº“</li><li>rewriteæ¨¡å—éœ€è¦ pcre åº“ </li><li>ssl åŠŸèƒ½éœ€è¦opensslåº“</li></ul><h2 id="ä¸‹è½½å®‰è£…PCRE"><a href="#ä¸‹è½½å®‰è£…PCRE" class="headerlink" title="ä¸‹è½½å®‰è£…PCRE"></a>ä¸‹è½½å®‰è£…PCRE</h2><ol><li>è·å–pcreç¼–è¯‘å®‰è£…åŒ…ï¼Œåœ¨<a href="http://www.pcre.org/" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸Šå¯ä»¥è·å–å½“å‰æœ€æ–°çš„ç‰ˆæœ¬<br>æ–‡ç« ä½¿ç”¨çš„ç‰ˆæœ¬ï¼š <a href="http://heanet.dl.sourceforge.net/project/pcre/pcre/8.38/pcre-8.38.tar.bz2" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½</a></li><li>è§£å‹ç¼©pcre-xx.tar.bz2åŒ…ã€‚</li><li>è¿›å…¥è§£å‹ç¼©ç›®å½•ï¼Œæ‰§è¡Œ./configureã€‚</li><li>make &amp; make install</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install bzip2 -y</span><br><span class="line">bzip2 -d pcre-8.38.tar.bz2</span><br><span class="line">tar -xf pcre-8.38.tar</span><br><span class="line"><span class="built_in">cd</span> pcre-8.38</span><br><span class="line">sudo ./configure --prefix=/usr/<span class="built_in">local</span>/pcre</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h2 id="ä¸‹è½½å®‰è£…zlibåº“"><a href="#ä¸‹è½½å®‰è£…zlibåº“" class="headerlink" title="ä¸‹è½½å®‰è£…zlibåº“"></a>ä¸‹è½½å®‰è£…zlibåº“</h2><ol><li>è·å–zlibç¼–è¯‘å®‰è£…åŒ…ï¼Œåœ¨<a href="http://www.zlib.net/" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸Šå¯ä»¥è·å–å½“å‰æœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>æ–‡ç« ä½¿ç”¨çš„ç‰ˆæœ¬ï¼š<a href="http://liquidtelecom.dl.sourceforge.net/project/libpng/zlib/1.2.6/zlib-1.2.6.tar.gz" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½</a></li><li>è§£å‹ç¼©zlib-1.2.6.tar.gz åŒ…ã€‚</li><li>è¿›å…¥è§£å‹ç¼©ç›®å½•ï¼Œæ‰§è¡Œ./configureã€‚</li><li>make &amp; make install</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf zlib-1.2.6.tar.gz </span><br><span class="line"><span class="built_in">cd</span> zlib-1.2.6</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zlib</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h2 id="ä¸‹è½½å®‰è£…OpenSSL"><a href="#ä¸‹è½½å®‰è£…OpenSSL" class="headerlink" title="ä¸‹è½½å®‰è£…OpenSSL"></a>ä¸‹è½½å®‰è£…OpenSSL</h2><ol><li>è·å–opensslç¼–è¯‘å®‰è£…åŒ…ï¼Œåœ¨<a href="http://www.openssl.org/source/" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸Šå¯ä»¥è·å–å½“å‰æœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>æ–‡ç« ä½¿ç”¨çš„ç‰ˆæœ¬ï¼š<a href="https://www.openssl.org/source/openssl-1.0.1t.tar.gz" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½</a></li><li>è§£å‹ç¼©openssl-xx.tar.gzåŒ…ã€‚</li><li>è¿›å…¥è§£å‹ç¼©ç›®å½•ï¼Œæ‰§è¡Œ./configã€‚</li><li>make &amp; make install</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf openssl-1.0.1t.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.0.1t</span><br><span class="line">sudo ./configure --prefix=/usr/<span class="built_in">local</span>/openssl</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h2 id="ä¸‹è½½å®‰è£…Nginx"><a href="#ä¸‹è½½å®‰è£…Nginx" class="headerlink" title="ä¸‹è½½å®‰è£…Nginx"></a>ä¸‹è½½å®‰è£…Nginx</h2><ol><li>è·å–nginxï¼Œåœ¨<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸Šå¯ä»¥è·å–å½“å‰æœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>æ–‡ç« ä½¿ç”¨çš„ç‰ˆæœ¬ï¼š<a href="http://nginx.org/download/nginx-1.9.15.tar.gz" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½</a></li><li>è§£å‹ç¼©nginx-xx.tar.gzåŒ…ã€‚</li><li>è¿›å…¥è§£å‹ç¼©ç›®å½•ï¼Œæ‰§è¡Œ./configure</li><li>make &amp; make install</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.9.15.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.9.15</span><br><span class="line">sudo ./configure --prefix=/usr/<span class="built_in">local</span>/nginx</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><blockquote><p>è‹¥å®‰è£…æ—¶æ‰¾ä¸åˆ°ä¸Šè¿°ä¾èµ–æ¨¡å—ï¼Œä½¿ç”¨â€“with-openssl=&lt; openssl_dir&gt;ã€â€“with-pcre=&lt; pcre_dir&gt;ã€â€“with-zlib=&lt; zlib_dir&gt;æŒ‡å®šä¾èµ–çš„æ¨¡å—ç›®å½• (æ¨¡å—æºç çš„å®‰è£…åŒ…ç›®å½•ï¼Œè€Œéå®‰è£…åçš„ç›®å½•)ã€‚</p></blockquote><h2 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">configure: error: You need a C++ compiler for C++ support.</span><br><span class="line">make[1]: *** [/root/tools/pcre-8.38/Makefile] Error 1</span><br><span class="line">make[1]: Leaving directory `/root/tools/nginx-1.13.12&apos;</span><br><span class="line">make: *** [install] Error 2</span><br></pre></td></tr></table></figure><h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><p>å®‰è£…gcc, gcc-c++ lib å³å¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++</span><br></pre></td></tr></table></figure></p><h1 id="å¯åŠ¨Nginx"><a href="#å¯åŠ¨Nginx" class="headerlink" title="å¯åŠ¨Nginx"></a>å¯åŠ¨Nginx</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>å¯åŠ¨<code>nginx</code>ä¹‹åï¼Œæµè§ˆå™¨ä¸­è¾“å…¥<code>http://localhost</code>å¯ä»¥éªŒè¯æ˜¯å¦å®‰è£…å¯åŠ¨æˆåŠŸã€‚</p><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢Nginx</span></span><br><span class="line">sudo /usr/<span class="built_in">local</span>/nginx/sbin/nginx -s </span><br><span class="line"><span class="comment"># å¯åŠ¨Nginx</span></span><br><span class="line">sudo /usr/<span class="built_in">local</span>/nginx/sbin/nginx</span><br><span class="line"><span class="comment"># åŠ è½½Nginxé…ç½®</span></span><br><span class="line">sudo /usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><h1 id="Nginxé…ç½®æ–‡ä»¶è¯¦ç»†è¯´æ˜"><a href="#Nginxé…ç½®æ–‡ä»¶è¯¦ç»†è¯´æ˜" class="headerlink" title="Nginxé…ç½®æ–‡ä»¶è¯¦ç»†è¯´æ˜"></a>Nginxé…ç½®æ–‡ä»¶è¯¦ç»†è¯´æ˜</h1><p><strong>ç¼–è¾‘é…ç½®æ–‡ä»¶</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p><p>åœ¨æ­¤è®°å½•ä¸‹NginxæœåŠ¡å™¨nginx.confçš„é…ç½®æ–‡ä»¶è¯´æ˜, éƒ¨åˆ†æ³¨é‡Šæ”¶é›†ä¸ç½‘ç»œï¼Œ<a href="http://www.cnblogs.com/xiaogangqq123/archive/2011/03/02/1969006.html" target="_blank" rel="noopener">Nginxé…ç½®æ–‡ä»¶è¯¦ç»†è¯´æ˜</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">#è¿è¡Œç”¨æˆ·</span><br><span class="line">user www-data;    </span><br><span class="line">#å¯åŠ¨è¿›ç¨‹,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#å…¨å±€é”™è¯¯æ—¥å¿—åŠPIDæ–‡ä»¶</span><br><span class="line">error_log  /var/log/nginx/error.log;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">#å·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™</span><br><span class="line">events &#123;</span><br><span class="line">    use   epoll;             #epollæ˜¯å¤šè·¯å¤ç”¨IO(I/O Multiplexing)ä¸­çš„ä¸€ç§æ–¹å¼,ä½†æ˜¯ä»…ç”¨äºlinux2.6ä»¥ä¸Šå†…æ ¸,å¯ä»¥å¤§å¤§æé«˜nginxçš„æ€§èƒ½</span><br><span class="line">    worker_connections  1024;#å•ä¸ªåå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æ¥æ•°</span><br><span class="line">    # multi_accept on; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒ</span><br><span class="line">http &#123;</span><br><span class="line">    #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    #è®¾å®šæ—¥å¿—æ ¼å¼</span><br><span class="line">    access_log    /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">    #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œ</span><br><span class="line">    #å¿…é¡»è®¾ä¸º on,å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime.</span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    tcp_nodelay        on;</span><br><span class="line">    </span><br><span class="line">    #å¼€å¯gzipå‹ç¼©</span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</span><br><span class="line"></span><br><span class="line">    #è®¾å®šè¯·æ±‚ç¼“å†²</span><br><span class="line">    client_header_buffer_size    1k;</span><br><span class="line">    large_client_header_buffers  4 4k;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">    include /etc/nginx/sites-enabled/*;</span><br><span class="line"></span><br><span class="line">    #è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line">    upstream mysvr &#123;</span><br><span class="line">        #weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span><br><span class="line">        #æœ¬æœºä¸Šçš„Squidå¼€å¯3128ç«¯å£</span><br><span class="line">        server 192.168.8.1:3128 weight=5;</span><br><span class="line">        server 192.168.8.2:80  weight=1;</span><br><span class="line">        server 192.168.8.3:80  weight=6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        #ä¾¦å¬80ç«¯å£</span><br><span class="line">        listen       80;</span><br><span class="line">        #å®šä¹‰ä½¿ç”¨www.xx.comè®¿é—®</span><br><span class="line">        server_name  www.xx.com;</span><br><span class="line"></span><br><span class="line">        #è®¾å®šæœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—</span><br><span class="line">        access_log  logs/www.xx.com.access.log  main;</span><br><span class="line"></span><br><span class="line">        #é»˜è®¤è¯·æ±‚</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /root;      #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span><br><span class="line">            index index.php index.html index.htm;   #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line"></span><br><span class="line">            fastcgi_pass  www.xx.com;</span><br><span class="line">            fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name; </span><br><span class="line">            include /etc/nginx/fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # å®šä¹‰é”™è¯¯æç¤ºé¡µé¢</span><br><span class="line">        error_page   500 502 503 504 /50x.html;  </span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">            root   /root;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†</span><br><span class="line">        location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123;</span><br><span class="line">            root /var/www/virtual/htdocs;</span><br><span class="line">            #è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹ï¼Œå¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚</span><br><span class="line">            expires 30d;</span><br><span class="line">        &#125;</span><br><span class="line">        #PHP è„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ° FastCGIå¤„ç†. ä½¿ç”¨FastCGIé»˜è®¤é…ç½®.</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">            root /root;</span><br><span class="line">            fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">            fastcgi_index index.php;</span><br><span class="line">            fastcgi_param SCRIPT_FILENAME /home/www/www$fastcgi_script_name;</span><br><span class="line">            include fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">        #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€</span><br><span class="line">        location /NginxStatus &#123;</span><br><span class="line">            stub_status            on;</span><br><span class="line">            access_log              on;</span><br><span class="line">            auth_basic              &quot;NginxStatus&quot;;</span><br><span class="line">            auth_basic_user_file  conf/htpasswd;</span><br><span class="line">        &#125;</span><br><span class="line">        #ç¦æ­¢è®¿é—® .htxxx æ–‡ä»¶</span><br><span class="line">        location ~ /\.ht &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šæ˜¯ä¸€äº›åŸºæœ¬çš„é…ç½®ï¼Œä½¿ç”¨Nginxæœ€å¤§çš„å¥½å¤„å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œå¦‚æœè¦ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„è¯,å¯ä»¥ä¿®æ”¹é…ç½®httpèŠ‚ç‚¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒ</span><br><span class="line">http &#123;</span><br><span class="line">     #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    #è®¾å®šæ—¥å¿—æ ¼å¼</span><br><span class="line">    access_log    /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">    #çœç•¥ä¸Šæ–‡æœ‰çš„ä¸€äº›é…ç½®èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">    #ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line">    #è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line">    upstream mysvr &#123;</span><br><span class="line">        #weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span><br><span class="line">        server 192.168.8.1x:3128 weight=5;#æœ¬æœºä¸Šçš„Squidå¼€å¯3128ç«¯å£</span><br><span class="line">        server 192.168.8.2x:80  weight=1;</span><br><span class="line">        server 192.168.8.3x:80  weight=6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mysvr2 &#123;</span><br><span class="line">        #weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span><br><span class="line">        server 192.168.8.x:80  weight=1;</span><br><span class="line">        server 192.168.8.x:80  weight=6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #ç¬¬ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨</span><br><span class="line">    server &#123;</span><br><span class="line">        #ä¾¦å¬192.168.8.xçš„80ç«¯å£</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  192.168.8.x;</span><br><span class="line"></span><br><span class="line">        #å¯¹aspxåç¼€çš„è¿›è¡Œè´Ÿè½½å‡è¡¡è¯·æ±‚</span><br><span class="line">        location ~ .*\.aspx$ &#123;</span><br><span class="line"></span><br><span class="line">            root   /root;      #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span><br><span class="line">            index index.php index.html index.htm;   #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line"></span><br><span class="line">            proxy_pass  http://mysvr ;#è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">            #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤.</span><br><span class="line"></span><br><span class="line">            proxy_redirect off;</span><br><span class="line"></span><br><span class="line">            #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            client_max_body_size 10m;    #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">            client_body_buffer_size 128k;  #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ</span><br><span class="line">            proxy_connect_timeout 90;  #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span><br><span class="line">            proxy_send_timeout 90;        #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span><br><span class="line">            proxy_read_timeout 90;         #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span><br><span class="line">            proxy_buffer_size 4k;             #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span><br><span class="line">            proxy_buffers 4 32k;               #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®</span><br><span class="line">            proxy_busy_buffers_size 64k;    #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span><br><span class="line">            proxy_temp_file_write_size 64k;  #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å‚è€ƒèµ„æ–™ï¼š<br><a href="http://www.cnblogs.com/skynet/p/4146083.html" target="_blank" rel="noopener">Nginxå®‰è£…ä¸ä½¿ç”¨</a><br><a href="http://www.cnblogs.com/zhongshengzhen/p/nginx.html" target="_blank" rel="noopener">CentOS6.5å®‰è£…nginxåŠè´Ÿè½½å‡è¡¡é…ç½®</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOSé…ç½®iptablesé˜²ç«å¢™</title>
      <link href="//posts/fc434b3c.html"/>
      <url>//posts/fc434b3c.html</url>
      
        <content type="html"><![CDATA[<p>CentOS7é»˜è®¤çš„é˜²ç«å¢™ä¸æ˜¯iptables,è€Œæ˜¯firewalle.</p><h1 id="ç¦ç”¨-åœæ­¢è‡ªå¸¦çš„firewalldæœåŠ¡"><a href="#ç¦ç”¨-åœæ­¢è‡ªå¸¦çš„firewalldæœåŠ¡" class="headerlink" title="ç¦ç”¨/åœæ­¢è‡ªå¸¦çš„firewalldæœåŠ¡"></a>ç¦ç”¨/åœæ­¢è‡ªå¸¦çš„firewalldæœåŠ¡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#åœæ­¢firewalldæœåŠ¡  </span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…iptable-iptable-service"><a href="#å®‰è£…iptable-iptable-service" class="headerlink" title="å®‰è£…iptable iptable-service"></a>å®‰è£…iptable iptable-service</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº†iptables  </span><br><span class="line">service iptables status  </span><br><span class="line">#å®‰è£…iptables  </span><br><span class="line">yum install -y iptables  </span><br><span class="line">#å‡çº§iptables  </span><br><span class="line">yum update iptables   </span><br><span class="line">#å®‰è£…iptables-services  </span><br><span class="line">yum install iptables-services</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="è®¾ç½®ç°æœ‰è§„åˆ™"><a href="#è®¾ç½®ç°æœ‰è§„åˆ™" class="headerlink" title="è®¾ç½®ç°æœ‰è§„åˆ™"></a>è®¾ç½®ç°æœ‰è§„åˆ™</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹iptablesç°æœ‰è§„åˆ™</span><br><span class="line">iptables -L -n</span><br><span class="line">#å…ˆå…è®¸æ‰€æœ‰,ä¸ç„¶æœ‰å¯èƒ½ä¼šæ¯å…·</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">#æ¸…ç©ºæ‰€æœ‰é»˜è®¤è§„åˆ™</span><br><span class="line">iptables -F</span><br><span class="line">#æ¸…ç©ºæ‰€æœ‰è‡ªå®šä¹‰è§„åˆ™</span><br><span class="line">iptables -X</span><br><span class="line">#æ‰€æœ‰è®¡æ•°å™¨å½’0</span><br><span class="line">iptables -Z</span><br><span class="line">#å…è®¸æ¥è‡ªäºloæ¥å£çš„æ•°æ®åŒ…(æœ¬åœ°è®¿é—®)</span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">#å¼€æ”¾22ç«¯å£</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">#å¼€æ”¾21ç«¯å£(FTP)</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -j ACCEPT</span><br><span class="line">#å¼€æ”¾80ç«¯å£(HTTP)</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">#å¼€æ”¾443ç«¯å£(HTTPS)</span><br><span class="line">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class="line">#å…è®¸ping</span><br><span class="line">iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT</span><br><span class="line">#å…è®¸æ¥å—æœ¬æœºè¯·æ±‚ä¹‹åçš„è¿”å›æ•°æ® RELATED,æ˜¯ä¸ºFTPè®¾ç½®çš„</span><br><span class="line">iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">#å…¶ä»–å…¥ç«™ä¸€å¾‹ä¸¢å¼ƒ</span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">#æ‰€æœ‰å‡ºç«™ä¸€å¾‹ç»¿ç¯</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">#æ‰€æœ‰è½¬å‘ä¸€å¾‹ä¸¢å¼ƒ</span><br><span class="line">iptables -P FORWARD DROP</span><br></pre></td></tr></table></figure><h1 id="å…¶ä»–è§„åˆ™è®¾å®š"><a href="#å…¶ä»–è§„åˆ™è®¾å®š" class="headerlink" title="å…¶ä»–è§„åˆ™è®¾å®š"></a>å…¶ä»–è§„åˆ™è®¾å®š</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#å¦‚æœè¦æ·»åŠ å†…ç½‘ipä¿¡ä»»ï¼ˆæ¥å—å…¶æ‰€æœ‰TCPè¯·æ±‚ï¼‰  </span><br><span class="line">iptables -A INPUT -p tcp -s 45.96.174.68 -j ACCEPT  </span><br><span class="line">#è¿‡æ»¤æ‰€æœ‰éä»¥ä¸Šè§„åˆ™çš„è¯·æ±‚  </span><br><span class="line">iptables -P INPUT DROP  </span><br><span class="line"></span><br><span class="line">#è¦å°åœä¸€ä¸ªIPï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š  </span><br><span class="line">iptables -I INPUT -s ***.***.***.*** -j DROP  </span><br><span class="line">#è¦è§£å°ä¸€ä¸ªIPï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤:  </span><br><span class="line">iptables -D INPUT -s ***.***.***.*** -j DROP</span><br></pre></td></tr></table></figure><h1 id="ä¿å­˜è§„åˆ™è®¾å®š"><a href="#ä¿å­˜è§„åˆ™è®¾å®š" class="headerlink" title="ä¿å­˜è§„åˆ™è®¾å®š"></a>ä¿å­˜è§„åˆ™è®¾å®š</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ä¿å­˜ä¸Šè¿°è§„åˆ™  </span><br><span class="line">service iptables save</span><br></pre></td></tr></table></figure><h1 id="å¼€å¯iptablesæœåŠ¡"><a href="#å¼€å¯iptablesæœåŠ¡" class="headerlink" title="å¼€å¯iptablesæœåŠ¡"></a>å¼€å¯iptablesæœåŠ¡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#æ³¨å†ŒiptablesæœåŠ¡  </span><br><span class="line">#ç›¸å½“äºä»¥å‰çš„chkconfig iptables on  </span><br><span class="line">systemctl enable iptables.service  </span><br><span class="line">#å¼€å¯æœåŠ¡  </span><br><span class="line">systemctl start iptables.service  </span><br><span class="line">#æŸ¥çœ‹çŠ¶æ€  </span><br><span class="line">systemctl status iptables.service</span><br></pre></td></tr></table></figure><h1 id="è§£å†³vsftpdåœ¨iptableså¼€å¯å-æ— æ³•ä½¿ç”¨è¢«åŠ¨æ¨¡å¼çš„é—®é¢˜"><a href="#è§£å†³vsftpdåœ¨iptableså¼€å¯å-æ— æ³•ä½¿ç”¨è¢«åŠ¨æ¨¡å¼çš„é—®é¢˜" class="headerlink" title="è§£å†³vsftpdåœ¨iptableså¼€å¯å,æ— æ³•ä½¿ç”¨è¢«åŠ¨æ¨¡å¼çš„é—®é¢˜"></a>è§£å†³vsftpdåœ¨iptableså¼€å¯å,æ— æ³•ä½¿ç”¨è¢«åŠ¨æ¨¡å¼çš„é—®é¢˜</h1><h2 id="é¦–å…ˆåœ¨-etc-sysconfig-iptables-configä¸­ä¿®æ”¹æˆ–è€…æ·»åŠ ä»¥ä¸‹å†…å®¹"><a href="#é¦–å…ˆåœ¨-etc-sysconfig-iptables-configä¸­ä¿®æ”¹æˆ–è€…æ·»åŠ ä»¥ä¸‹å†…å®¹" class="headerlink" title="é¦–å…ˆåœ¨/etc/sysconfig/iptables-configä¸­ä¿®æ”¹æˆ–è€…æ·»åŠ ä»¥ä¸‹å†…å®¹"></a>é¦–å…ˆåœ¨/etc/sysconfig/iptables-configä¸­ä¿®æ”¹æˆ–è€…æ·»åŠ ä»¥ä¸‹å†…å®¹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#æ·»åŠ ä»¥ä¸‹å†…å®¹,æ³¨æ„é¡ºåºä¸èƒ½è°ƒæ¢  </span><br><span class="line">IPTABLES_MODULES=&quot;ip_conntrack_ftp&quot;  </span><br><span class="line">IPTABLES_MODULES=&quot;ip_nat_ftp&quot;</span><br></pre></td></tr></table></figure><h2 id="é‡æ–°è®¾ç½®iptablesè®¾ç½®"><a href="#é‡æ–°è®¾ç½®iptablesè®¾ç½®" class="headerlink" title="é‡æ–°è®¾ç½®iptablesè®¾ç½®"></a>é‡æ–°è®¾ç½®iptablesè®¾ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure><h1 id="ä»¥ä¸‹ä¸ºå®Œæ•´è®¾ç½®è„šæœ¬"><a href="#ä»¥ä¸‹ä¸ºå®Œæ•´è®¾ç½®è„šæœ¬" class="headerlink" title="ä»¥ä¸‹ä¸ºå®Œæ•´è®¾ç½®è„šæœ¬"></a>ä»¥ä¸‹ä¸ºå®Œæ•´è®¾ç½®è„šæœ¬</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT</span><br><span class="line">iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -P FORWARD DROP</span><br><span class="line">service iptables save</span><br><span class="line">systemctl restart iptables.service</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> CentOS </tag>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ä½“ç±»ï¼ˆVOï¼ŒDOï¼ŒDTOï¼ŒPOï¼‰çš„åˆ’åˆ†</title>
      <link href="//posts/b6973370.html"/>
      <url>//posts/b6973370.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç»å¸¸ä¼šæ¥è§¦åˆ°<code>VO</code>ã€<code>DO</code>ã€<code>DTO</code>å’Œ<code>PO</code>çš„æ¦‚å¿µï¼Œæœ¬æ–‡ä»é¢†åŸŸå»ºæ¨¡ä¸­çš„å®ä½“åˆ’åˆ†å’Œé¡¹ç›®ä¸­çš„å®é™…åº”ç”¨æƒ…å†µä¸¤ä¸ªè§’åº¦ï¼Œå¯¹è¿™å‡ ä¸ªæ¦‚å¿µè¿›è¡Œç®€æã€‚<br><strong>å¾—å‡ºçš„ä¸»è¦ç»“è®ºæ˜¯ï¼š</strong></p><ul><li><code>VO</code>å¯¹åº”äºé¡µé¢ä¸Šéœ€è¦æ˜¾ç¤ºçš„æ•°æ®ï¼ˆè¡¨å•ï¼‰</li><li><code>DO</code>å¯¹åº”äºæ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®ï¼ˆæ•°æ®è¡¨ï¼‰</li><li><code>DTO</code>å¯¹åº”äºé™¤äºŒè€…ä¹‹å¤–éœ€è¦è¿›è¡Œä¼ é€’çš„æ•°æ®</li><li><code>PO</code>å¯¹åº”æŒä¹…å±‚çš„æ˜ å°„å…³ç³»</li></ul><a id="more"></a><h1 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h1><p>ç™¾åº¦ç™¾ç§‘ä¸­å¯¹äºå®ä½“ç±»çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>å®ä½“ç±»çš„ä¸»è¦èŒè´£æ˜¯å­˜å‚¨å’Œç®¡ç†ç³»ç»Ÿå†…éƒ¨çš„ä¿¡æ¯ï¼Œå®ƒä¹Ÿå¯ä»¥æœ‰è¡Œä¸ºï¼Œç”šè‡³å¾ˆå¤æ‚çš„è¡Œä¸ºï¼Œä½†è¿™äº›è¡Œä¸ºå¿…é¡»ä¸å®ƒæ‰€ä»£è¡¨çš„å®ä½“å¯¹è±¡å¯†åˆ‡ç›¸å…³ã€‚</p></blockquote><p>æ ¹æ®ä»¥ä¸Šå®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œå®ä½“ç±»æœ‰ä¸¤æ–¹é¢å†…å®¹ï¼Œå­˜å‚¨æ•°æ®å’Œæ‰§è¡Œæ•°æ®æœ¬èº«ç›¸å…³çš„æ“ä½œã€‚è¿™ä¸¤æ–¹é¢å†…å®¹å¯¹åº”åˆ°å®ç°ä¸Šï¼Œæœ€ç®€å•çš„å®ä½“ç±»æ˜¯<code>POJO</code>ç±»ï¼Œå«æœ‰å±æ€§åŠå±æ€§å¯¹åº”çš„<code>set</code>å’Œ<code>get</code>æ–¹æ³•ï¼Œå®ä½“ç±»å¸¸è§çš„æ–¹æ³•è¿˜æœ‰ç”¨äºè¾“å‡ºè‡ªèº«æ•°æ®çš„<code>toString</code>æ–¹æ³•ã€‚</p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-25-074258.jpg" alt></p><h1 id="é¢†åŸŸæ¨¡å‹ä¸­çš„å®ä½“ç±»"><a href="#é¢†åŸŸæ¨¡å‹ä¸­çš„å®ä½“ç±»" class="headerlink" title="é¢†åŸŸæ¨¡å‹ä¸­çš„å®ä½“ç±»"></a>é¢†åŸŸæ¨¡å‹ä¸­çš„å®ä½“ç±»</h1><p>é¢†åŸŸæ¨¡å‹ä¸­çš„å®ä½“ç±»åˆ†ä¸ºå››ç§ç±»å‹ï¼š<code>VO</code>ã€<code>DTO</code>ã€<code>DO</code>ã€<code>PO</code>ï¼Œå„ç§å®ä½“ç±»ç”¨äºä¸åŒä¸šåŠ¡å±‚æ¬¡é—´çš„äº¤äº’ï¼Œå¹¶ä¼šåœ¨å±‚æ¬¡å†…å®ç°å®ä½“ç±»ä¹‹é—´çš„è½¬åŒ–ã€‚<br>ä¸šåŠ¡åˆ†å±‚ä¸ºï¼šè§†å›¾å±‚ï¼ˆ<code>VIEW</code>+<code>ACTION</code>ï¼‰ï¼ŒæœåŠ¡å±‚ï¼ˆ<code>SERVICE</code>ï¼‰ï¼ŒæŒä¹…å±‚ï¼ˆ<code>DAO</code>ï¼‰<br>ç›¸åº”å„å±‚é—´å®ä½“çš„ä¼ é€’å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-25-074317.jpg" alt></p><p>é¡¹ç›®ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰ä¸¥æ ¼éµå¾ªè¿™ç§ä¼ é€’å…³ç³»ï¼Œä½†è¿™ç§å’Œä¸šåŠ¡å±‚æ¬¡çš„å…³è”å¯¹æˆ‘ä»¬ç†è§£å„å®ä½“ç±»çš„ä½œç”¨æ˜¯æœ‰å¸®åŠ©çš„ã€‚ï¼ˆæˆ‘ä»¬æ²¡æœ‰æ¥è§¦åˆ°POçš„åŸå› ï¼Œæˆ‘ç†è§£ä¸ºORMå¯¹POè¿›è¡Œäº†å°è£…ï¼‰<br>ä»¥ä¸‹æ˜¯èµ„æ–™çš„åŸæ–‡ï¼Œä¸Šå›¾æ˜¯åŸºäºæ­¤ç»˜åˆ¶çš„ï¼š</p><p><strong>æ¦‚å¿µï¼š</strong></p><ul><li><p><code>VO</code>ï¼ˆView Objectï¼‰ï¼šè§†å›¾å¯¹è±¡ï¼Œç”¨äºå±•ç¤ºå±‚ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠæŸä¸ªæŒ‡å®šé¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰çš„æ‰€æœ‰æ•°æ®å°è£…èµ·æ¥ã€‚</p></li><li><p><code>DTO</code>ï¼ˆData Transfer Objectï¼‰ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œè¿™ä¸ªæ¦‚å¿µæ¥æºäºJ2EEçš„è®¾è®¡æ¨¡å¼ï¼ŒåŸæ¥çš„ç›®çš„æ˜¯ä¸ºäº†EJBçš„åˆ†å¸ƒå¼åº”ç”¨æä¾›ç²—ç²’åº¦çš„æ•°æ®å®ä½“ï¼Œä»¥å‡å°‘åˆ†å¸ƒå¼è°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜åˆ†å¸ƒå¼è°ƒç”¨çš„æ€§èƒ½å’Œé™ä½ç½‘ç»œè´Ÿè½½ï¼Œä½†åœ¨è¿™é‡Œï¼Œæˆ‘æ³›æŒ‡ç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚</p></li><li><p><code>DO</code>ï¼ˆDomain Objectï¼‰ï¼šé¢†åŸŸå¯¹è±¡ï¼Œå°±æ˜¯ä»ç°å®ä¸–ç•Œä¸­æŠ½è±¡å‡ºæ¥çš„æœ‰å½¢æˆ–æ— å½¢çš„ä¸šåŠ¡å®ä½“ã€‚</p></li><li><p><code>PO</code>ï¼ˆPersistent Objectï¼‰ï¼šæŒä¹…åŒ–å¯¹è±¡ï¼Œå®ƒè·ŸæŒä¹…å±‚ï¼ˆé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼‰çš„æ•°æ®ç»“æ„å½¢æˆä¸€ä¸€å¯¹åº”çš„æ˜ å°„å…³ç³»ï¼Œå¦‚æœæŒä¹…å±‚æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œé‚£ä¹ˆï¼Œæ•°æ®è¡¨ä¸­çš„æ¯ä¸ªå­—æ®µï¼ˆæˆ–è‹¥å¹²ä¸ªï¼‰å°±å¯¹åº”POçš„ä¸€ä¸ªï¼ˆæˆ–è‹¥å¹²ä¸ªï¼‰å±æ€§ã€‚</p></li></ul><p><strong>æ¨¡å‹ï¼š</strong><br>ä¸‹é¢ä»¥ä¸€ä¸ªæ—¶åºå›¾å»ºç«‹ç®€å•æ¨¡å‹æ¥æè¿°ä¸Šè¿°å¯¹è±¡åœ¨ä¸‰å±‚æ¶æ„åº”ç”¨ä¸­çš„ä½ç½®ï¼š</p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-25-075248.jpg" alt></p><ul><li>ç”¨æˆ·å‘å‡ºè¯·æ±‚ï¼ˆå¯èƒ½æ˜¯å¡«å†™è¡¨å•ï¼‰ï¼Œè¡¨å•çš„æ•°æ®åœ¨å±•ç¤ºå±‚è¢«åŒ¹é…ä¸ºVOã€‚</li><li>å±•ç¤ºå±‚æŠŠVOè½¬æ¢ä¸ºæœåŠ¡å±‚å¯¹åº”æ–¹æ³•æ‰€è¦æ±‚çš„DTOï¼Œä¼ é€ç»™æœåŠ¡å±‚ã€‚</li><li>æœåŠ¡å±‚é¦–å…ˆæ ¹æ®DTOçš„æ•°æ®æ„é€ ï¼ˆæˆ–é‡å»ºï¼‰ä¸€ä¸ªDOï¼Œè°ƒç”¨DOçš„ä¸šåŠ¡æ–¹æ³•å®Œæˆå…·ä½“ä¸šåŠ¡ã€‚</li><li>æœåŠ¡å±‚æŠŠDOè½¬æ¢ä¸ºæŒä¹…å±‚å¯¹åº”çš„POï¼ˆå¯ä»¥ä½¿ç”¨ORMå·¥å…·ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ï¼‰ï¼Œè°ƒç”¨æŒä¹…å±‚çš„- æŒä¹…åŒ–æ–¹æ³•ï¼ŒæŠŠPOä¼ é€’ç»™å®ƒï¼Œå®ŒæˆæŒä¹…åŒ–æ“ä½œã€‚</li><li>å¯¹äºä¸€ä¸ªé€†å‘æ“ä½œï¼Œå¦‚è¯»å–æ•°æ®ï¼Œä¹Ÿæ˜¯ç”¨ç±»ä¼¼çš„æ–¹å¼è½¬æ¢å’Œä¼ é€’ï¼Œç•¥ã€‚</li></ul><h1 id="é¡¹ç›®ä¸­çš„å®ä½“ç±»"><a href="#é¡¹ç›®ä¸­çš„å®ä½“ç±»" class="headerlink" title="é¡¹ç›®ä¸­çš„å®ä½“ç±»"></a>é¡¹ç›®ä¸­çš„å®ä½“ç±»</h1><p>é¡¹ç›®ä¸­å¸¸è§çš„å®ä½“ç±»æœ‰<code>VO</code>ï¼Œ<code>DO</code>å’Œ<code>DTO</code>ï¼Œå‘½åè§„åˆ™ä¹Ÿå¸¸æ˜¯ä»¥ç›¸åº”å­—ç¬¦ä¸²ç»“å°¾ï¼Œå¦‚<code>*VO.Java</code>ã€‚ä½†æ˜¯DTOä¸æ€»æ˜¯éµå¾ªè¿™ä¸ªè§„åˆ™ï¼Œè€Œé€šå¸¸ä¸ä»–çš„ç”¨é€”æœ‰å…³ï¼Œå¦‚å†™æˆ<code>*Query.java</code>ï¼Œè¡¨ç¤ºå­˜å‚¨äº†ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶ã€‚é¡¹ç›®ä¸­å®ä½“ç±»å‡ºç°çš„ä¸šåŠ¡å±‚æ¬¡ä¹Ÿæ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨è§†å›¾å±‚å°±ç»„è£…ä¸€ä¸ª<code>DO</code>ï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ª<code>VO</code>ä»æŒä¹…å±‚ä¼ å‡ºæ¥ï¼Œæ‰€ä»¥ä¸ä¸šåŠ¡åˆ†å±‚ç›¸å…³è”çš„åˆ’åˆ†æ–¹æ³•æ˜¾å¾—æœ‰äº›å†—ä½™ã€‚ä»é¡¹ç›®ä»£ç ä¸­æŠ½è±¡å‡ºçš„ç†è§£æ˜¯ï¼šVOå¯¹åº”äºé¡µé¢ä¸Šéœ€è¦æ˜¾ç¤ºçš„æ•°æ®ï¼ŒDOå¯¹åº”äºæ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®ï¼ŒDTOå¯¹åº”äºé™¤äºŒè€…ä¹‹å¤–éœ€è¦è¿›è¡Œä¼ é€’çš„æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç ç”Ÿæˆåˆ©å™¨ï¼šIDEA å¼ºå¤§çš„ Live Templates</title>
      <link href="//posts/7d50b50c.html"/>
      <url>//posts/7d50b50c.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Java å¼€å‘è¿‡ç¨‹ç»å¸¸éœ€è¦ç¼–å†™æœ‰å›ºå®šæ ¼å¼çš„ä»£ç ï¼Œä¾‹å¦‚è¯´å£°æ˜ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œloggeræˆ–è€…beanç­‰ç­‰ã€‚å¯¹äºè¿™ç§å°èŒƒå›´çš„ä»£ç ç”Ÿæˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ IDEA æä¾›çš„ Live TemplatesåŠŸèƒ½ã€‚åˆšå¼€å§‹è§‰å¾—å®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„Code Snippetï¼Œåæ¥å‘ç°å®ƒæ”¯æŒå˜é‡å‡½æ•°é…ç½®ï¼Œå¯ä»¥æ”¯æŒå¾ˆå¤æ‚çš„ä»£ç ç”Ÿæˆã€‚ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸€ä¸‹Live Templatesçš„ç”¨æ³•ã€‚</p><h1 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h1><p>IDEA è‡ªå¸¦å¾ˆå¤šå¸¸ç”¨çš„åŠ¨æ€æ¨¡æ¿ï¼Œåœ¨ Java ä»£ç ä¸­è¾“å…¥<code>fori</code>ï¼Œå›è½¦å°±ä¼šå‡ºç°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; ; i++) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-20-live01.gif" alt="fori"></p><p>æŒ‰<code>Tab</code>å¯ä»¥åœ¨å„ä¸ªç©ºç™½å¤„è·³è½¬ï¼Œæ‰‹åŠ¨å¡«å€¼ã€‚</p><a id="more"></a><h1 id="è‡ªå®šä¹‰-Template"><a href="#è‡ªå®šä¹‰-Template" class="headerlink" title="è‡ªå®šä¹‰ Template"></a>è‡ªå®šä¹‰ Template</h1><p>å®˜æ–¹è‡ªå¸¦æ¨¡æ¿æ¯•ç«Ÿä¸èƒ½æ»¡è¶³æˆ‘ä»¬ä¸ªäººç¼–ç é£æ ¼çš„éœ€è¦ï¼ŒLive Templatesæä¾›äº†å˜é‡å‡½æ•°çš„æ–¹å¼ä¾›æˆ‘ä»¬è‡ªå®šä¹‰ã€‚</p><h2 id="ç®€å•ç”¨æ³•"><a href="#ç®€å•ç”¨æ³•" class="headerlink" title="ç®€å•ç”¨æ³•"></a>ç®€å•ç”¨æ³•</h2><p>æ–°å¢è‡ªå®šä¹‰æ¨¡æ¿ï¼Œé¦–å…ˆéœ€è¦å¡«å†™è§¦å‘å•è¯ï¼ˆå³ Abbreviationï¼‰ï¼Œæè¿°æ˜¯å¯é€‰çš„ï¼Œç„¶åå®šä¹‰æ¨¡æ¿çš„ä¸Šä¸‹æ–‡ï¼Œç‚¹å‡»defineé€‰æ‹©Javaï¼Œè¿™æ ·åœ¨ç¼–è¾‘ Java çš„æ—¶å€™å°±ä¼šè§¦å‘å½“å‰æ¨¡æ¿ï¼Œå®šä¹‰å®Œä¸Šä¸‹æ–‡ä¹‹åï¼Œå°±å¯ä»¥å¡«å†™æ¨¡æ¿äº†ã€‚<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-20-live02.gif" alt="new template"></p><p>ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªæˆ‘å¸¸ç”¨çš„ç®€å•æ¨¡æ¿<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">==========</span><br><span class="line">&lt;out&gt;</span><br><span class="line">----------</span><br><span class="line">System.out.println($END$)</span><br><span class="line">==========</span><br><span class="line">&lt;pfs&gt;</span><br><span class="line">----------</span><br><span class="line">private final static String $varName$  = &quot;$var$&quot;;`</span><br><span class="line">==========</span><br><span class="line">&lt;privateField&gt;</span><br><span class="line">----------</span><br><span class="line">/**</span><br><span class="line"> * $COMMENT$</span><br><span class="line"> */</span><br><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">private $TYPE$ $NAME$;</span><br><span class="line">==========</span><br><span class="line">&lt;main&gt;</span><br><span class="line">----------</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">     $END$</span><br><span class="line">&#125;</span><br><span class="line">==========</span><br></pre></td></tr></table></figure></p><p>æ¨¡æ¿æ”¯æŒå˜é‡çš„å®šä¹‰ï¼Œä½¿ç”¨<code>$$</code>åŒ…å›´çš„å­—ç¬¦è¡¨ç¤ºä¸€ä¸ªå˜é‡ã€‚<code>$END$</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é¢„å®šä¹‰å˜é‡ï¼Œè¡¨ç¤ºå…‰æ ‡æœ€åè·³è½¬çš„ä½ç½®ã€‚æ¯ä¸ªå˜é‡çš„ä½ç½®éƒ½å¯ä»¥è·³è½¬è¿‡å»ã€‚</p><h2 id="é«˜çº§ç”¨æ³•"><a href="#é«˜çº§ç”¨æ³•" class="headerlink" title="é«˜çº§ç”¨æ³•"></a>é«˜çº§ç”¨æ³•</h2><p>å¦‚æœä½ ç”¨è¿‡ vim çš„<code>Code Sinppet</code>æ’ä»¶ï¼Œä½ ä¼šå‘ç°æ¨¡æ¿é‡Œé¢æ˜¯å¯ä»¥æ‰§è¡Œå‡½æ•°çš„ï¼Œå¼ºå¤§çš„<code>Live Templates</code>å½“ç„¶ä¹Ÿæ”¯æŒï¼Œè€Œä¸” IDEA èƒ½å¤Ÿæ„ŸçŸ¥ä»£ç çš„è¯­ä¹‰ï¼Œä¾‹å¦‚è¯´å½“å‰ç¼–è¾‘çš„å‡½æ•°çš„å‚æ•°ã€‚ä½†è¿™ä¸€ç‚¹å°±èƒ½å¤Ÿè®©æˆ‘ä»¬ç©å‡ºèŠ±æ¥ã€‚æˆ‘ä»¬ä»æ˜“åˆ°éš¾æ¥ç ”ç©¶æ¨¡æ¿å‡½æ•°çš„åŠŸèƒ½ã€‚<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-20-live04.gif" alt="variables function"></p><p>å‰é¢æˆ‘ä»¬æåˆ°çš„å˜é‡å¯ä»¥ç»‘å®šå‡½æ•°ï¼Œé…ç½®æ–¹å¼å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><h2 id="å¿«é€Ÿå£°æ˜å˜é‡"><a href="#å¿«é€Ÿå£°æ˜å˜é‡" class="headerlink" title="å¿«é€Ÿå£°æ˜å˜é‡"></a>å¿«é€Ÿå£°æ˜å˜é‡</h2><p>å£°æ˜å˜é‡æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œï¼Œç‰¹åˆ«æ˜¯éœ€è¦å£°æ˜å˜é‡éœ€è¦åŠ æ³¨è§£ï¼Œæ³¨é‡Šçš„æ—¶å€™ï¼Œè¿™äº›ä»£ç å†™èµ·æ¥å°±å¾ˆæ¯ç‡¥ã€‚ä¸‹é¢æ˜¯æˆ‘å®šä¹‰çš„æ¨¡æ¿ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;osgiRef&gt;</span><br><span class="line">----------</span><br><span class="line">/**</span><br><span class="line"> * $END$</span><br><span class="line"> */</span><br><span class="line">@OsgiReference</span><br><span class="line">@Setter</span><br><span class="line">private $TYPE$ $NAME$;</span><br></pre></td></tr></table></figure></p><p>ä¹ä¸€çœ‹è¿™ä¸ªæ¨¡æ¿è·Ÿæˆ‘ä¸Šé¢å®šä¹‰çš„<code>privateField</code>å·®ä¸å¤šï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äºæˆ‘ç»™è¿™äº›å˜é‡ç»‘å®šäº†å‡½æ•°ã€‚</p><ol><li><code>clipboard()</code>ï¼šè¿”å›å½“å‰ç²˜è´´æ¿çš„å­—ç¬¦ä¸²</li><li><code>decapitalize()</code>ï¼šå°†è¾“å…¥çš„å­—ç¬¦ä¸²é¦–å­—æ¯å˜ä¸ºå°å†™<br>ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹ï¼Œæˆ‘ä»¬å…ˆæ‹·è´å½“å‰ç±»åï¼Œç„¶åè¾“å…¥<code>osgiRef</code></li></ol><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-20-live03.gif" alt="osgiRef"></p><h2 id="å¿«é€Ÿå£°æ˜-Logger"><a href="#å¿«é€Ÿå£°æ˜-Logger" class="headerlink" title="å¿«é€Ÿå£°æ˜ Logger"></a>å¿«é€Ÿå£°æ˜ Logger</h2><p>å£°æ˜ logger ä¹Ÿæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œï¼Œä¸Šé¢æˆ‘ä»¬æ˜¯åˆ©ç”¨äº†ç²˜è´´å‡½æ•°æ¥å¿«é€Ÿå£°æ˜å˜é‡ï¼Œç°åœ¨æˆ‘ä»¬æ¥åˆ©ç”¨å¦ä¸€ä¸ªå‡½æ•°<code>className()</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è¿”å›å½“å‰ç±»åã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;logger&gt;</span><br><span class="line">----------</span><br><span class="line">/** logger */</span><br><span class="line">private static final Logger LOGGER = LoggerFactory.getLogger($CLASS$.class);</span><br></pre></td></tr></table></figure><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-20-live05.gif" alt="logger"></p><h2 id="æœ€å¼ºå¤§çš„-groovyScript"><a href="#æœ€å¼ºå¤§çš„-groovyScript" class="headerlink" title="æœ€å¼ºå¤§çš„ groovyScript()"></a>æœ€å¼ºå¤§çš„ groovyScript()</h2><p>å¦‚æœè¯´ä¸Šé¢ç”¨åˆ°çš„å‡½æ•°æä¾›çš„èƒ½åŠ›æœ‰é™ï¼Œä¸å¤Ÿçµæ´»ï¼Œé‚£ä¹ˆgroovyScript()æä¾›äº†ä¸€åˆ‡ä½ æƒ³è¦çš„èƒ½åŠ›ï¼Œå®ƒæ”¯æŒæ‰§è¡Œ Groovy è„šæœ¬å¤„ç†è¾“å…¥ï¼Œç„¶åè¾“å‡ºå¤„ç†åçš„å­—ç¬¦ä¸²ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(&quot;code&quot;, ...)</span><br><span class="line"></span><br><span class="line">|  code   |   ä¸€æ®µGroovyä»£ç æˆ–è€…Groovyè„šæœ¬ä»£ç ç»å¯¹è·¯å¾„    |</span><br><span class="line">|  ...    |   å¯é€‰å…¥å‚ï¼Œè¿™äº›å‚æ•°ä¼šç»‘å®šåˆ°`_1, _2, _3, ..._n`, åœ¨ Groovy ä»£ç ä¸­ä½¿ç”¨ã€‚|</span><br></pre></td></tr></table></figure></p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„å®é™…åº”ç”¨ã€‚</p><h2 id="å¿«é€Ÿ-bean-é…ç½®"><a href="#å¿«é€Ÿ-bean-é…ç½®" class="headerlink" title="å¿«é€Ÿ bean é…ç½®"></a>å¿«é€Ÿ bean é…ç½®</h2><p>æ–°å¢ä¸€ä¸ªæœåŠ¡éƒ½è¦åœ¨ Spring ä¸­æ³¨å†Œä¸€ä¸ª beanï¼Œä¸€èˆ¬è¿™ä¸ªé…ç½®æ— éå°±æ˜¯å°†æŒ‡æ˜<code>id</code>å’Œ<code>class</code>ï¼Œç”±äºæˆ‘ä»¬æ˜¯åœ¨ xml ä¸­é…ç½®ï¼Œæ‰€ä»¥ä¸èƒ½åˆ©ç”¨className()å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>clipboard()</code>å‡½æ•°è·å–åˆ°ç±»çš„å…¨å¼•ç”¨ï¼Œåœ¨ IDEA ä¸­æˆ‘ä»¬ç›´æ¥å³é”®ç±»åï¼Œç‚¹å‡»<code>Copy Reference</code>å°±è¡Œã€‚ç„¶åæ‰§è¡Œ groovy è„šæœ¬è·å–ç±»åã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean&gt;</span><br><span class="line">----------</span><br><span class="line">&lt;bean id=&quot;$id$&quot; class=&quot;$REF$&quot; /&gt;</span><br></pre></td></tr></table></figure></p><p><code>id</code>ç»‘å®š<code>decapitalize(groovyScript(&quot;_1.tokenize(&#39;.&#39;)[-1]&quot;, clipboard()))</code>ï¼Œé¦–å…ˆå–<code>clipboard()</code>çš„å€¼å¾—åˆ°ç±»çš„å…¨å¼•ç”¨ï¼Œç„¶åæ‰§è¡Œ groovy ä»£ç <code>_1.tokenize(&#39;.&#39;)[-1]</code>ï¼ˆæŒ‰<code>.</code>åˆ†å‰²ä¸ºå­—ç¬¦ä¸²æ•°ç»„ï¼Œç„¶åå–æœ€åä¸€ä¸ªå³å¯å¾—åˆ°ç±»åï¼Œç„¶åç”¨<code>decapitalize()</code>å°†é¦–å­—æ¯å°å†™å³å¯å¾—åˆ°<code>id</code>ï¼Œ<code>REF</code>ç»‘å®š<code>clipboard()</code>å³å¯</p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-20-live06.gif" alt="bean"></p><h2 id="å¿«é€Ÿæ‰“å°å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯"><a href="#å¿«é€Ÿæ‰“å°å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯" class="headerlink" title="å¿«é€Ÿæ‰“å°å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯"></a>å¿«é€Ÿæ‰“å°å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯</h2><p>æ‰“å°é”™è¯¯æ—¥å¿—çš„æ—¶å€™éœ€è¦æ‰“å°å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ï¼Œä¾‹å¦‚è¯´å…¥å‚ï¼Œæœ‰æ—¶å€™å…¥å‚å¾ˆå¤šçš„æ—¶å€™ï¼Œå†™èµ·æ¥å¾ˆç—›è‹¦ï¼Œå¥½åœ¨æœ‰æ¨¡æ¿å‡½æ•°<code>methodParameters()</code>ï¼Œè¿”å›å½“å‰å‡½æ•°å‚æ•°çš„åˆ—è¡¨ï¼Œå½“ç„¶è¿™ä¸ªåˆ—è¡¨æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦ç»“åˆ<code>groovyScript</code>å¯¹å®ƒè¿›è¡Œè½¬åŒ–ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;printContext&gt;</span><br><span class="line">---------------</span><br><span class="line">LogUtil.$TYPE$(LOGGER, &quot;$MSG$ &quot; + $params$);</span><br></pre></td></tr></table></figure></p><p>å°†<code>params</code>ç»‘å®šåˆ°<code>groovyScript(&quot;&#39;\&quot;&#39; + _1.collect { it + &#39; = [\&quot; + &#39; + it + &#39; + \&quot;]&#39;}.join(&#39;, &#39;) + &#39;\&quot;&#39;&quot;, methodParameters())</code>ï¼Œå°±èƒ½å¤Ÿè‡ªåŠ¨å°†å½“å‰å‡½æ•°çš„å‚æ•°æ ¼å¼åŒ–åè¾“å‡ºã€‚</p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-12-20-live07.gif" alt="printContext"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸Šé¢æˆ‘ä»¬ç®€å•ä»‹ç»äº†å¸¸ç”¨çš„æ¨¡æ¿å‡½æ•°ï¼Œå…¶å® IDEA è¿˜æœ‰å¾ˆå¤šå…¶å®ƒæ¨¡æ¿å‡½æ•°ï¼Œå…·ä½“å‚è€ƒ<a href="https://www.jetbrains.com/help/idea/2016.3/creating-and-editing-template-variables.html" target="_blank" rel="noopener">Creating and Editing Template Variables</a>ã€‚IDEA æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å·¥å…·ï¼Œå–„ç”¨å·¥å…·èƒ½å¤Ÿæå¤§çš„æé«˜å·¥ä½œæ•ˆç‡ï¼Œå°†ç²¾åŠ›æŠ•å…¥åˆ°å…³é”®çš„äº‹æƒ…ä¸Šï¼Œè€Œä¸æ˜¯å°†æ—¶é—´æµªè´¹åœ¨ç¼–å†™é‡å¤ä»£ç ä¸Šé¢ã€‚ä¸€äº›æ›´é«˜çº§çš„ç”¨æ³•è¿˜æœ‰å¾…å¤§å®¶å»å‘æ˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis Info å‚æ•°è¯¦è§£</title>
      <link href="//posts/2f4e5423.html"/>
      <url>//posts/2f4e5423.html</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸€ç§æ˜“äºè§£é‡Šï¼ˆparseï¼‰ä¸”æ˜“äºé˜…è¯»çš„æ ¼å¼ï¼Œè¿”å›å…³äº Redis æœåŠ¡å™¨çš„å„ç§ä¿¡æ¯å’Œç»Ÿè®¡æ•°å€¼ã€‚<br>é€šè¿‡ç»™å®šå¯é€‰çš„å‚æ•° section ï¼Œå¯ä»¥è®©å‘½ä»¤åªè¿”å›æŸä¸€éƒ¨åˆ†çš„ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 7000</span><br><span class="line">info</span><br></pre></td></tr></table></figure><ul><li>server : ä¸€èˆ¬ Redis æœåŠ¡å™¨ä¿¡æ¯ï¼ŒåŒ…å«ä»¥ä¸‹åŸŸï¼š<ul><li>redis_version : Redis æœåŠ¡å™¨ç‰ˆæœ¬</li><li>redis_git_sha1 : Git SHA1</li><li>redis_git_dirty : Git dirty flag</li><li>os : Redis æœåŠ¡å™¨çš„å®¿ä¸»æ“ä½œç³»ç»Ÿ</li><li>arch_bits : æ¶æ„ï¼ˆ32 æˆ– 64 ä½ï¼‰</li><li>multiplexing_api : Redis æ‰€ä½¿ç”¨çš„äº‹ä»¶å¤„ç†æœºåˆ¶</li><li>gcc_version : ç¼–è¯‘ Redis æ—¶æ‰€ä½¿ç”¨çš„ GCC ç‰ˆæœ¬</li><li>process_id : æœåŠ¡å™¨è¿›ç¨‹çš„ PID</li><li>run_id : Redis æœåŠ¡å™¨çš„éšæœºæ ‡è¯†ç¬¦ï¼ˆç”¨äº Sentinel  - å’Œé›†ç¾¤ï¼‰</li><li>tcp_port : TCP/IP ç›‘å¬ç«¯å£</li><li>uptime_in_seconds : è‡ª Redis æœåŠ¡å™¨å¯åŠ¨ä»¥æ¥ï¼Œç» - è¿‡çš„ç§’æ•°</li><li>uptime_in_days : è‡ª Redis æœåŠ¡å™¨å¯åŠ¨ä»¥æ¥ï¼Œç»è¿‡çš„  - å¤©æ•°</li><li>lru_clock : ä»¥åˆ†é’Ÿä¸ºå•ä½è¿›è¡Œè‡ªå¢çš„æ—¶é’Ÿï¼Œç”¨äº LRU ç®¡ç†</li></ul></li></ul><a id="more"></a><ul><li><p>clients : å·²è¿æ¥å®¢æˆ·ç«¯ä¿¡æ¯ï¼ŒåŒ…å«ä»¥ä¸‹åŸŸï¼š</p><ul><li>connected_clients : å·²è¿æ¥å®¢æˆ·ç«¯çš„æ•°é‡ï¼ˆä¸åŒ…æ‹¬ é€šè¿‡- ä»å±æœåŠ¡å™¨è¿æ¥çš„å®¢æˆ·ç«¯ï¼‰</li><li>client_longest_output_list : å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯ å½“- ä¸­ï¼Œæœ€é•¿çš„è¾“å‡ºåˆ—è¡¨</li><li>client_longest_input_buf : å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯å½“  - ä¸­ï¼Œæœ€å¤§è¾“å…¥ç¼“å­˜</li><li>blocked_clients : æ­£åœ¨ç­‰å¾…é˜»å¡å‘½ä»¤ï¼ˆBLPOPã€- BRPOPã€BRPOPLPUSHï¼‰çš„å®¢æˆ·ç«¯çš„æ•°é‡</li></ul></li><li><p>memory : å†…å­˜ä¿¡æ¯ï¼ŒåŒ…å«ä»¥ä¸‹åŸŸï¼š</p><ul><li>used_memory : ç”± Redis åˆ†é…å™¨åˆ†é…çš„å†…å­˜æ€»é‡ï¼Œä»¥å­— - èŠ‚ï¼ˆbyteï¼‰ä¸ºå•ä½</li><li>used_memory_human : ä»¥äººç±»å¯è¯»çš„æ ¼å¼è¿”å› Redis    - åˆ†é…çš„å†…å­˜æ€»é‡</li><li>used_memory_rss : ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼Œè¿”å› Redis å·²   - åˆ†é…çš„å†…å­˜æ€»é‡ï¼ˆä¿—ç§°å¸¸é©»é›†å¤§å°ï¼‰ã€‚è¿™ä¸ªå€¼å’Œ top ã€    - ps ç­‰å‘½ä»¤çš„è¾“å‡ºä¸€è‡´ã€‚</li><li>used_memory_peak : Redis çš„å†…å­˜æ¶ˆè€—å³°å€¼ï¼ˆä»¥å­—èŠ‚ä¸º   - å•ä½ï¼‰</li><li>used_memory_peak_human : ä»¥äººç±»å¯è¯»çš„æ ¼å¼è¿”å›     - Redis çš„å†…å­˜æ¶ˆè€—å³°å€¼</li><li>used_memory_lua : Lua å¼•æ“æ‰€ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼ˆä»¥å­— - èŠ‚ä¸ºå•ä½ï¼‰</li><li>mem_fragmentation_ratio : used_memory_rss å’Œ     - used_memory ä¹‹é—´çš„æ¯”ç‡</li><li>mem_allocator : åœ¨ç¼–è¯‘æ—¶æŒ‡å®šçš„ï¼Œ Redis æ‰€ä½¿ç”¨çš„å†…å­˜åˆ†é…å™¨ã€‚å¯ä»¥æ˜¯ libc ã€ jemalloc æˆ–è€… tcmalloc ã€‚</li></ul></li></ul><blockquote><p>åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ used_memory_rss çš„å€¼åº”è¯¥åªæ¯” used_memory ç¨å¾®é«˜ä¸€ç‚¹å„¿ã€‚<br>å½“ rss &gt; used ï¼Œä¸”ä¸¤è€…çš„å€¼ç›¸å·®è¾ƒå¤§æ—¶ï¼Œè¡¨ç¤ºå­˜åœ¨ï¼ˆå†…éƒ¨æˆ–å¤–éƒ¨çš„ï¼‰å†…å­˜ç¢ç‰‡ã€‚<br>å†…å­˜ç¢ç‰‡çš„æ¯”ç‡å¯ä»¥é€šè¿‡ mem_fragmentation_ratio çš„å€¼çœ‹å‡ºã€‚<br>å½“ used &gt; rss æ—¶ï¼Œè¡¨ç¤º Redis çš„éƒ¨åˆ†å†…å­˜è¢«æ“ä½œç³»ç»Ÿæ¢å‡ºåˆ°äº¤æ¢ç©ºé—´äº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ“ä½œå¯èƒ½ä¼šäº§ç”Ÿæ˜æ˜¾çš„å»¶è¿Ÿã€‚<br>Because Redis does not have control over how its allocations are mapped to memory pages, high used_memory_rss is often the result of a spike in memory usage.<br>å½“ Redis é‡Šæ”¾å†…å­˜æ—¶ï¼Œåˆ†é…å™¨å¯èƒ½ä¼šï¼Œä¹Ÿå¯èƒ½ä¸ä¼šï¼Œå°†å†…å­˜è¿”è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚<br>å¦‚æœ Redis é‡Šæ”¾äº†å†…å­˜ï¼Œå´æ²¡æœ‰å°†å†…å­˜è¿”è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆ used_memory çš„å€¼å¯èƒ½å’Œæ“ä½œç³»ç»Ÿæ˜¾ç¤ºçš„ Redis å†…å­˜å ç”¨å¹¶ä¸ä¸€è‡´ã€‚<br>æŸ¥çœ‹ used_memory_peak çš„å€¼å¯ä»¥éªŒè¯è¿™ç§æƒ…å†µæ˜¯å¦å‘ç”Ÿã€‚</p></blockquote><ul><li>persistence : RDB å’Œ AOF çš„ç›¸å…³ä¿¡æ¯</li><li>stats : ä¸€èˆ¬ç»Ÿè®¡ä¿¡æ¯</li><li>replication : ä¸»/ä»å¤åˆ¶ä¿¡æ¯</li><li>cpu : CPU è®¡ç®—é‡ç»Ÿè®¡ä¿¡æ¯</li><li>commandstats : Redis å‘½ä»¤ç»Ÿè®¡ä¿¡æ¯</li><li>cluster : Redis é›†ç¾¤ä¿¡æ¯</li><li>keyspace : æ•°æ®åº“ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯</li></ul><p>é™¤ä¸Šé¢ç»™å‡ºçš„è¿™äº›å€¼ä»¥å¤–ï¼Œå‚æ•°è¿˜å¯ä»¥æ˜¯ä¸‹é¢è¿™ä¸¤ä¸ªï¼š</p><ul><li>all : è¿”å›æ‰€æœ‰ä¿¡æ¯</li><li>default : è¿”å›é»˜è®¤é€‰æ‹©çš„ä¿¡æ¯</li></ul><p>å½“ä¸å¸¦å‚æ•°ç›´æ¥è°ƒç”¨ <a href="http://redis.readthedocs.io/en/latest/server/info.html#info" target="_blank" rel="noopener">INFO</a> å‘½ä»¤æ—¶ï¼Œä½¿ç”¨ default ä½œä¸ºé»˜è®¤å‚æ•°ã€‚<br>ä¸åŒç‰ˆæœ¬çš„ Redis å¯èƒ½å¯¹è¿”å›çš„ä¸€äº›åŸŸè¿›è¡Œäº†å¢åŠ æˆ–åˆ å‡ã€‚<br>å› æ­¤ï¼Œä¸€ä¸ªå¥å£®çš„å®¢æˆ·ç«¯ç¨‹åºåœ¨å¯¹ <a href="http://redis.readthedocs.io/en/latest/server/info.html#info" target="_blank" rel="noopener">INFO</a> å‘½ä»¤çš„è¾“å‡ºè¿›è¡Œåˆ†ææ—¶ï¼Œåº”è¯¥èƒ½å¤Ÿè·³è¿‡ä¸è®¤è¯†çš„åŸŸï¼Œå¹¶ä¸”å¦¥å–„åœ°å¤„ç†ä¸¢å¤±ä¸è§çš„åŸŸã€‚<br><strong>å¯ç”¨ç‰ˆæœ¬ï¼š</strong><br>1.0.0<br><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong><br>O(1)<br><strong>è¿”å›å€¼ï¼š</strong><br>å…·ä½“è¯·å‚è§ä¸‹é¢çš„æµ‹è¯•ä»£ç ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; INFO</span><br><span class="line"># Server</span><br><span class="line">redis_version:2.5.9</span><br><span class="line">redis_git_sha1:473f3090</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">os:Linux 3.3.7-1-ARCH i686</span><br><span class="line">arch_bits:32</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">gcc_version:4.7.0</span><br><span class="line">process_id:8104</span><br><span class="line">run_id:bc9e20c6f0aac67d0d396ab950940ae4d1479ad1</span><br><span class="line">tcp_port:6379</span><br><span class="line">uptime_in_seconds:7</span><br><span class="line">uptime_in_days:0</span><br><span class="line">lru_clock:1680564</span><br><span class="line"></span><br><span class="line"># Clients</span><br><span class="line">connected_clients:1</span><br><span class="line">client_longest_output_list:0</span><br><span class="line">client_biggest_input_buf:0</span><br><span class="line">blocked_clients:0</span><br><span class="line"></span><br><span class="line"># Memory</span><br><span class="line">used_memory:439304</span><br><span class="line">used_memory_human:429.01K</span><br><span class="line">used_memory_rss:13897728</span><br><span class="line">used_memory_peak:401776</span><br><span class="line">used_memory_peak_human:392.36K</span><br><span class="line">used_memory_lua:20480</span><br><span class="line">mem_fragmentation_ratio:31.64</span><br><span class="line">mem_allocator:jemalloc-3.0.0</span><br><span class="line"></span><br><span class="line"># Persistence</span><br><span class="line">loading:0</span><br><span class="line">rdb_changes_since_last_save:0</span><br><span class="line">rdb_bgsave_in_progress:0</span><br><span class="line">rdb_last_save_time:1338011402</span><br><span class="line">rdb_last_bgsave_status:ok</span><br><span class="line">rdb_last_bgsave_time_sec:-1</span><br><span class="line">rdb_current_bgsave_time_sec:-1</span><br><span class="line">aof_enabled:0</span><br><span class="line">aof_rewrite_in_progress:0</span><br><span class="line">aof_rewrite_scheduled:0</span><br><span class="line">aof_last_rewrite_time_sec:-1</span><br><span class="line">aof_current_rewrite_time_sec:-1</span><br><span class="line"></span><br><span class="line"># Stats</span><br><span class="line">total_connections_received:1</span><br><span class="line">total_commands_processed:0</span><br><span class="line">instantaneous_ops_per_sec:0</span><br><span class="line">rejected_connections:0</span><br><span class="line">expired_keys:0</span><br><span class="line">evicted_keys:0</span><br><span class="line">keyspace_hits:0</span><br><span class="line">keyspace_misses:0</span><br><span class="line">pubsub_channels:0</span><br><span class="line">pubsub_patterns:0</span><br><span class="line">latest_fork_usec:0</span><br><span class="line"></span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line"></span><br><span class="line"># CPU</span><br><span class="line">used_cpu_sys:0.03</span><br><span class="line">used_cpu_user:0.01</span><br><span class="line">used_cpu_sys_children:0.00</span><br><span class="line">used_cpu_user_children:0.00</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis Sentinelé›†ç¾¤æ–¹æ¡ˆ--å•æœºç‰ˆ</title>
      <link href="//posts/88fa579a.html"/>
      <url>//posts/88fa579a.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç®€å•ä»‹ç»ä¸‹Redis-sentinelï¼š<br>Redis-sentinelæ˜¯Rediså®ä¾‹çš„ç›‘æ§ç®¡ç†ã€é€šçŸ¥å’Œå®ä¾‹å¤±æ•ˆå¤‡æ´æœåŠ¡ï¼Œæ˜¯Redisé›†ç¾¤çš„ç®¡ç†å·¥å…·ã€‚åœ¨ä¸€èˆ¬çš„åˆ†å¸ƒå¼ä¸­å¿ƒèŠ‚ç‚¹æ•°æ®åº“ä¸­ï¼ŒRedis-sentinelçš„ä½œç”¨æ˜¯ä¸­å¿ƒèŠ‚ç‚¹çš„å·¥ä½œï¼Œç›‘æ§å„ä¸ªå…¶ä»–èŠ‚ç‚¹çš„å·¥ä½œæƒ…å†µå¹¶ä¸”è¿›è¡Œæ•…éšœæ¢å¤ï¼Œæ¥æé«˜é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚<br>Sentinelæ˜¯ä¸€ä¸ªç‹¬ç«‹äºRedisä¹‹å¤–çš„è¿›ç¨‹ï¼Œä¸å¯¹å¤–æä¾›key/valueæœåŠ¡ï¼Œå­˜åœ¨redisçš„å®‰è£…ç›®å½•ä¸‹Redis-sentinelã€‚ä¸»è¦ç”¨æ¥ç›‘æ§redis-serverè¿›ç¨‹ï¼Œè¿›è¡Œmaster/slaveç®¡ç†ï¼Œå¦‚æœRedisæ²¡æœ‰è¿è¡Œåœ¨master/slaveæ¨¡å¼ä¸‹ï¼Œåˆ™ä¸éœ€è¦è®¾ç½®sentinelã€‚</p></blockquote><p>ä¸‹é¢ä¾‹å­ä¸­ç”¨äº†3ä¸ªredis-serverå’Œ3ä¸ªredis-sentinelæ¥è¿›è¡Œå®‰è£…æ¼”ç¤ºï¼Œå®é™…ä¸Šredis-sentinelçš„ä¸ªæ•°ä¸ä¸€å®šè¦å’Œredis-severå¯¹åº”ï¼Œ1~n ä¸ªéƒ½å¯ä»¥ï¼Œå»ºè®®redis-serverä¸ºå¶æ•°ä¸ªã€‚</p><a id="more"></a><h2 id="éƒ¨ç½²è§„åˆ’"><a href="#éƒ¨ç½²è§„åˆ’" class="headerlink" title="éƒ¨ç½²è§„åˆ’"></a>éƒ¨ç½²è§„åˆ’</h2><p><strong>æ³¨ï¼š</strong> ä»¥ä¸‹å„ä¸ªèŠ‚ç‚¹éƒ½åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸­è¿›è¡Œæ¼”ç»ƒ<br>master:<code>7000</code><br>slave1: <code>7001</code><br>slave2: <code>7002</code><br>master-sentinel: <code>8000</code><br>slave1-sentinel: <code>8001</code><br>slave2-sentinel: <code>8002</code></p><h2 id="ä¸‹è½½å®‰è£…redis"><a href="#ä¸‹è½½å®‰è£…redis" class="headerlink" title="ä¸‹è½½å®‰è£…redis"></a>ä¸‹è½½å®‰è£…redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span></span><br><span class="line">wget http://download.redis.io/releases/redis-2.8.3.tar.gz</span><br><span class="line">tar â€“zxvf redis-2.8.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-2.8.3</span><br><span class="line">make</span><br><span class="line">make install(æ­¤å¤„å¯ç”¨PREFIXå‚æ•°å°†rediså®‰è£…åˆ°å…¶ä»–ç›®å½•)</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h2><h3 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">mkdir redis_cluster</span><br><span class="line">mkdir redis_cluster/master_7000</span><br><span class="line">mkdir redis_cluster/slave_7001</span><br><span class="line">mkdir redis_cluster/slave_7002</span><br></pre></td></tr></table></figure><h3 id="å¤åˆ¶é…ç½®æ–‡ä»¶"><a href="#å¤åˆ¶é…ç½®æ–‡ä»¶" class="headerlink" title="å¤åˆ¶é…ç½®æ–‡ä»¶"></a>å¤åˆ¶é…ç½®æ–‡ä»¶</h3><p>ä»å®‰è£…åŒ…ä¸­å¤åˆ¶<code>redis.conf</code>,<code>sentinel.conf</code>é…ç½®æ–‡ä»¶åˆ°æ–°å»ºçš„å„ä¸ªèŠ‚ç‚¹ç›®å½•, å¦‚ä¸‹: </p><h4 id="å¤åˆ¶æ–‡ä»¶åˆ°masterç›®å½•"><a href="#å¤åˆ¶æ–‡ä»¶åˆ°masterç›®å½•" class="headerlink" title="å¤åˆ¶æ–‡ä»¶åˆ°masterç›®å½•"></a>å¤åˆ¶æ–‡ä»¶åˆ°<code>master</code>ç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp ~/redis-2.8.3/redis.conf ./redis_cluster/master_7000/</span><br><span class="line">cp ~/redis-2.8.3/sentinel.conf ./redis_cluster/master_7000/sentinel.conf</span><br></pre></td></tr></table></figure><h4 id="å¤åˆ¶æ–‡ä»¶åˆ°slave1ç›®å½•"><a href="#å¤åˆ¶æ–‡ä»¶åˆ°slave1ç›®å½•" class="headerlink" title="å¤åˆ¶æ–‡ä»¶åˆ°slave1ç›®å½•"></a>å¤åˆ¶æ–‡ä»¶åˆ°<code>slave1</code>ç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp ~/redis-2.8.3/redis.conf ./redis_cluster/slave_7001/</span><br><span class="line">cp ~/redis-2.8.3/sentinel.conf ./redis_cluster/slave_7001/sentinel.conf</span><br></pre></td></tr></table></figure><h4 id="å¤åˆ¶æ–‡ä»¶åˆ°slave2ç›®å½•"><a href="#å¤åˆ¶æ–‡ä»¶åˆ°slave2ç›®å½•" class="headerlink" title="å¤åˆ¶æ–‡ä»¶åˆ°slave2ç›®å½•"></a>å¤åˆ¶æ–‡ä»¶åˆ°<code>slave2</code>ç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp ~/redis-2.8.3/redis.conf ./redis_cluster/slave_7002/</span><br><span class="line">cp ~/redis-2.8.3/sentinel.conf ./redis_cluster/slave_7002/sentinel.conf</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><h4 id="é…ç½®MasterèŠ‚ç‚¹"><a href="#é…ç½®MasterèŠ‚ç‚¹" class="headerlink" title="é…ç½®MasterèŠ‚ç‚¹"></a>é…ç½®MasterèŠ‚ç‚¹</h4><h5 id="redis-conf"><a href="#redis-conf" class="headerlink" title="redis.conf"></a>redis.conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis_7000.pid</span><br><span class="line">port 7000</span><br><span class="line">requirepass servyou   #ä»æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨åŒæ­¥æ—¶çš„è®¤è¯å¯†ç ï¼Œå¦‚æœmasterè®¾ç½®äº†ï¼Œslaveå¯†ç å¿…é¡»è®¾ç½®ï¼Œåä¹‹masteræ²¡è®¾ç½®ï¼Œåˆ™slaveä¹Ÿæ— éœ€è®¾ç½®</span><br><span class="line">masterauth  servyou  #è®¾ç½®Redisè¿æ¥å¯†ç ,å¦‚æœé…ç½®äº†è¿æ¥å¯†ç ,å®¢æˆ·ç«¯åœ¨è¿æ¥Redisæ—¶éœ€è¦é€šè¿‡AUTH &lt;password&gt;å‘½ä»¤æä¾›å¯†ç </span><br><span class="line">appendonly no</span><br><span class="line">slave-read-only yes</span><br></pre></td></tr></table></figure><h5 id="sentinel-conf"><a href="#sentinel-conf" class="headerlink" title="sentinel.conf"></a>sentinel.conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">logfile &quot;/usr/local/redis_cluster/master_7000/log/sentinel_log.log&quot;</span><br><span class="line">#æŒ‡å®šsentinelä½¿ç”¨çš„ç«¯å£ï¼Œä¸èƒ½ä¸redis-serverè¿è¡Œå®ä¾‹çš„ç«¯å£å†²çª</span><br><span class="line">port 8000 </span><br><span class="line">#æŒ‡å®šå·¥ä½œç›®å½•</span><br><span class="line">dir /tmp </span><br><span class="line">####sentineléœ€è¦ç›‘æ§çš„masterä¿¡æ¯ï¼š&lt;mastername&gt; &lt;masterIP&gt; &lt;masterPort&gt; &lt;quorum&gt;.</span><br><span class="line">####&lt;quorum&gt;åº”è¯¥å°äºé›†ç¾¤ä¸­slaveçš„ä¸ªæ•°,åªæœ‰å½“è‡³å°‘&lt;quorum&gt;ä¸ªsentinelå®ä¾‹æäº¤&quot;masterå¤±æ•ˆ&quot; æ‰ä¼šè®¤ä¸ºmasterä¸ºODWON(&quot;å®¢è§‚&quot;å¤±æ•ˆ) .</span><br><span class="line">s</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 7000  2  </span><br><span class="line">#è®¾ç½®è®¿é—®mymasterçš„å¯†ç </span><br><span class="line">sentinel auth-pass mymaster servyou </span><br><span class="line">#è¡¨ç¤ºå¦‚æœ3så†…mymasteræ²¡å“åº”ï¼Œå°±è®¤ä¸ºSDOWN</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000 </span><br><span class="line">#è¡¨ç¤ºå¦‚æœ15ç§’å,mysaterä»æ²¡æ´»è¿‡æ¥ï¼Œåˆ™å¯åŠ¨failoverï¼Œä»å‰©ä¸‹çš„slaveä¸­é€‰ä¸€ä¸ªå‡çº§ä¸ºmaster</span><br><span class="line">sentinel failover-timeout mymaster  15000 </span><br><span class="line">#è¡¨ç¤ºå¦‚æœmasteré‡æ–°é€‰å‡ºæ¥åï¼Œå…¶å®ƒslaveèŠ‚ç‚¹èƒ½åŒæ—¶å¹¶è¡Œä»æ–°masteråŒæ­¥ç¼“å­˜çš„å°æ•°æœ‰å¤šå°‘ä¸ªï¼Œæ˜¾ç„¶è¯¥å€¼è¶Šå¤§ï¼Œæ‰€æœ‰slaveèŠ‚ç‚¹å®ŒæˆåŒæ­¥åˆ‡æ¢çš„æ•´ä½“é€Ÿåº¦è¶Šå¿«ï¼Œä½†å¦‚æœæ­¤æ—¶æ­£å¥½æœ‰äººåœ¨è®¿é—®è¿™äº›slaveï¼Œå¯èƒ½é€ æˆè¯»å–å¤±è´¥ï¼Œå½±å“é¢ä¼šæ›´å¹¿ã€‚æœ€ä¿å®šçš„è®¾ç½®ä¸º1ï¼ŒåªåŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰ä¸€å°å¹²è¿™ä»¶äº‹ï¼Œè¿™æ ·å…¶å®ƒslaveè¿˜èƒ½ç»§ç»­æœåŠ¡ï¼Œä½†æ˜¯æ‰€æœ‰slaveå…¨éƒ¨å®Œæˆç¼“å­˜æ›´æ–°åŒæ­¥çš„è¿›ç¨‹å°†å˜æ…¢ã€‚</span><br><span class="line">sentinel parallel-syncs mymaster  1</span><br></pre></td></tr></table></figure><h4 id="é…ç½®Slave1èŠ‚ç‚¹"><a href="#é…ç½®Slave1èŠ‚ç‚¹" class="headerlink" title="é…ç½®Slave1èŠ‚ç‚¹"></a>é…ç½®Slave1èŠ‚ç‚¹</h4><h5 id="redis-conf-1"><a href="#redis-conf-1" class="headerlink" title="redis.conf"></a>redis.conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis_7001.pid</span><br><span class="line">port 7001</span><br><span class="line">requirepass servyou</span><br><span class="line">masterauth servyou</span><br><span class="line">appendonly no</span><br><span class="line">slave-read-only yes</span><br><span class="line">slave of 127.0.0.1 7000</span><br></pre></td></tr></table></figure><h5 id="sentinel-conf-1"><a href="#sentinel-conf-1" class="headerlink" title="sentinel.conf"></a>sentinel.conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">logfile &quot;/usr/local/redis_cluster/slave_7001/log/sentinel_log.log&quot;</span><br><span class="line">port 8001</span><br><span class="line">dir /tmp</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 7000 2</span><br><span class="line">sentinel auth-pass mymaster servyou</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line">sentinel parallel-syncs mymaster  1</span><br><span class="line">sentinel failover-timeout mymaster  15000</span><br></pre></td></tr></table></figure><h4 id="é…ç½®Slave2èŠ‚ç‚¹"><a href="#é…ç½®Slave2èŠ‚ç‚¹" class="headerlink" title="é…ç½®Slave2èŠ‚ç‚¹"></a>é…ç½®Slave2èŠ‚ç‚¹</h4><p>é…ç½®ä¸<code>Slave1</code>å‡ ä¹ä¸€è‡´</p><h5 id="redis-conf-2"><a href="#redis-conf-2" class="headerlink" title="redis.conf"></a>redis.conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis_7002.pid</span><br><span class="line">port 7002</span><br><span class="line">requirepass servyou</span><br><span class="line">masterauth servyou</span><br><span class="line">appendonly no</span><br><span class="line">slave-read-only yes</span><br><span class="line">slave of 127.0.0.1 7000</span><br></pre></td></tr></table></figure><h5 id="sentinel-conf-2"><a href="#sentinel-conf-2" class="headerlink" title="sentinel.conf"></a>sentinel.conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">logfile &quot;/usr/local/redis_cluster/slave_7002/log/sentinel_log.log&quot;</span><br><span class="line">port 8002</span><br><span class="line">dir /tmp</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 7000 2</span><br><span class="line">sentinel auth-pass mymaster servyou</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line">sentinel parallel-syncs mymaster  1</span><br><span class="line">sentinel failover-timeout mymaster  15000</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h2><p>æ³¨æ„ï¼šé¦–æ¬¡æ„å»ºsentinelç¯å¢ƒæ—¶ï¼Œå¿…é¡»é¦–å…ˆå¯åŠ¨masterã€‚</p><h3 id="å¯åŠ¨masterå’Œmaster-sentinel"><a href="#å¯åŠ¨masterå’Œmaster-sentinel" class="headerlink" title="å¯åŠ¨masterå’Œmaster-sentinel"></a>å¯åŠ¨masterå’Œmaster-sentinel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server /usr/<span class="built_in">local</span>/redis_cluster/master_7000/redis.conf</span><br><span class="line">redis-sentinel usr/<span class="built_in">local</span>/redis_cluster/master_7000/sentinel.conf</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨slave1å’Œslave1-sentinel"><a href="#å¯åŠ¨slave1å’Œslave1-sentinel" class="headerlink" title="å¯åŠ¨slave1å’Œslave1-sentinel"></a>å¯åŠ¨slave1å’Œslave1-sentinel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server /usr/<span class="built_in">local</span>/redis_cluster/slave_7001/redis.conf</span><br><span class="line">redis-sentinel /usr/<span class="built_in">local</span>/redis_cluster/slave_7001/sentinel.conf</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨slave2å’Œslave2-sentinel"><a href="#å¯åŠ¨slave2å’Œslave2-sentinel" class="headerlink" title="å¯åŠ¨slave2å’Œslave2-sentinel"></a>å¯åŠ¨slave2å’Œslave2-sentinel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server /usr/<span class="built_in">local</span>/redis_cluster/slave_7002/redis.conf</span><br><span class="line">redis-sentinel /usr/<span class="built_in">local</span>/redis_cluster/slave_7002/sentinel.conf</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹è¿›ç¨‹"><a href="#æŸ¥çœ‹è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹"></a>æŸ¥çœ‹è¿›ç¨‹</h3><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-144135.jpg" alt></p><h2 id="æŸ¥çœ‹çŠ¶æ€"><a href="#æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€"></a>æŸ¥çœ‹çŠ¶æ€</h2><blockquote><p>info Replication</p></blockquote><h3 id="æŸ¥çœ‹masterçŠ¶æ€"><a href="#æŸ¥çœ‹masterçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹masterçŠ¶æ€"></a>æŸ¥çœ‹masterçŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 7000</span><br></pre></td></tr></table></figure><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-144330.jpg" alt></p><h3 id="æŸ¥çœ‹slave1çŠ¶æ€"><a href="#æŸ¥çœ‹slave1çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹slave1çŠ¶æ€"></a>æŸ¥çœ‹slave1çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 7001</span><br></pre></td></tr></table></figure><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-144440.jpg" alt></p><h3 id="æŸ¥çœ‹slave2çŠ¶æ€"><a href="#æŸ¥çœ‹slave2çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹slave2çŠ¶æ€"></a>æŸ¥çœ‹slave2çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 7002</span><br></pre></td></tr></table></figure><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-144544.jpg" alt></p><h2 id="åœºæ™¯æµ‹è¯•"><a href="#åœºæ™¯æµ‹è¯•" class="headerlink" title="åœºæ™¯æµ‹è¯•"></a>åœºæ™¯æµ‹è¯•</h2><h3 id="åœºæ™¯1-slaveå®•æœº"><a href="#åœºæ™¯1-slaveå®•æœº" class="headerlink" title="åœºæ™¯1: slaveå®•æœº"></a>åœºæ™¯1: slaveå®•æœº</h3><p>å…³é—­slave1ï¼š<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-144813.jpg" alt><br>æŸ¥çœ‹masterçš„Replicationä¿¡æ¯ï¼š<br>æ­¤æ—¶åªå­˜åœ¨ä¸€ä¸ªslaveã€‚<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-144908.jpg" alt></p><h3 id="åœºæ™¯2ï¼šslaveæ¢å¤"><a href="#åœºæ™¯2ï¼šslaveæ¢å¤" class="headerlink" title="åœºæ™¯2ï¼šslaveæ¢å¤"></a>åœºæ™¯2ï¼šslaveæ¢å¤</h3><p><a href="#å¯åŠ¨slave1å’Œslave1-sentinel">é‡æ–°å¼€å¯slave1</a></p><p>æŸ¥çœ‹sentinelçŠ¶æ€ï¼š<br>sentinelèƒ½å¿«é€Ÿçš„å‘ç°slaveåŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼š<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-145043.jpg" alt><br>æŸ¥çœ‹masterçš„Replicationä¿¡æ¯ï¼š<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-145130.jpg" alt></p><h3 id="åœºæ™¯3ï¼šmasterå®•æœº"><a href="#åœºæ™¯3ï¼šmasterå®•æœº" class="headerlink" title="åœºæ™¯3ï¼šmasterå®•æœº"></a>åœºæ™¯3ï¼šmasterå®•æœº</h3><p>master-sentinelä½œä¸ºmaster 1çš„leaderï¼Œä¼šé€‰å–ä¸€ä¸ªmaster 1çš„slaveä½œä¸ºæ–°çš„masterã€‚slaveçš„é€‰å–æ˜¯æ ¹æ®ä¸€ä¸ªåˆ¤æ–­DNSæƒ…å†µçš„ä¼˜å…ˆçº§æ¥å¾—åˆ°ï¼Œä¼˜å…ˆçº§ç›¸åŒé€šè¿‡runidçš„æ’åºå¾—åˆ°ï¼Œä½†ç›®å‰ä¼˜å…ˆçº§è®¾å®šè¿˜æ²¡å®ç°ï¼Œæ‰€ä»¥ç›´æ¥è·å–runidæ’åºå¾—åˆ°slave 1ã€‚<br>ç„¶åå‘é€å‘½ä»¤slaveof no oneæ¥å–æ¶ˆslave 1çš„slaveçŠ¶æ€æ¥è½¬æ¢ä¸ºmasterã€‚å½“å…¶ä»–sentinelè§‚å¯Ÿåˆ°è¯¥slaveæˆä¸ºmasterå,å°±çŸ¥é“é”™è¯¯å¤„ç†ä¾‹ç¨‹å¯åŠ¨äº†ã€‚sentinel Aç„¶åå‘é€ç»™å…¶ä»–slave slaveof new-slave-ip-port å‘½ä»¤ï¼Œå½“æ‰€æœ‰slaveéƒ½é…ç½®å®Œåï¼Œsentinel Aä»ç›‘æµ‹çš„mastersåˆ—è¡¨ä¸­åˆ é™¤æ•…éšœmasterï¼Œç„¶åé€šçŸ¥å…¶ä»–sentinelsã€‚<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-145400.jpg" alt></p><h3 id="åœºæ™¯4ï¼šmasteræ¢å¤"><a href="#åœºæ™¯4ï¼šmasteræ¢å¤" class="headerlink" title="åœºæ™¯4ï¼šmasteræ¢å¤"></a>åœºæ™¯4ï¼šmasteræ¢å¤</h3><p><a href="#å¯åŠ¨masterå’Œmaster-sentinel">é‡æ–°å¯åŠ¨åŸæ¥çš„master</a></p><p>æŸ¥çœ‹sentinelçŠ¶æ€ï¼š<br>åŸæ¥çš„masterè‡ªåŠ¨åˆ‡æ¢æˆslaveï¼Œä¸ä¼šè‡ªåŠ¨æ¢å¤æˆmasterï¼š<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-145730.jpg" alt></p><p>è¿æ¥åˆ°slave2,å¯ä»¥çœ‹åˆ°ç›®å‰æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹äº†<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-15-145803.jpg" alt></p><p>å¥½äº†, æµ‹è¯•å®Œæˆ!</p><p><strong>æ³¨æ„ï¼šè‹¥åœ¨sentinelå·²é€‰å‡ºæ–°ä¸»ä½†å°šæœªå®Œæˆå…¶å®ƒå®ä¾‹çš„reconfigureä¹‹å‰ï¼Œé‡å¯old masterï¼Œåˆ™æ•´ä¸ªç³»ç»Ÿä¼šå‡ºç°æ— æ³•é€‰å‡ºnew masterçš„å¼‚å¸¸ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Sentinel </tag>
            
            <tag> Redisé›†ç¾¤ </tag>
            
            <tag> å“¨å…µæ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Intellij IDEAä½¿ç”¨MyBatis-generatorè‡ªåŠ¨ç”ŸæˆMyBatisä»£ç </title>
      <link href="//posts/bb71e7fb.html"/>
      <url>//posts/bb71e7fb.html</url>
      
        <content type="html"><![CDATA[<h1 id="STEP-1-æ–°å¢mavenæ’ä»¶"><a href="#STEP-1-æ–°å¢mavenæ’ä»¶" class="headerlink" title="STEP 1. æ–°å¢mavenæ’ä»¶"></a>STEP 1. æ–°å¢mavenæ’ä»¶</h1><p>åœ¨mavené¡¹ç›®çš„pom.xml æ·»åŠ mybatis-generator-maven-plugin æ’ä»¶<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p><a id="more"></a><h1 id="STEP-2-æ–°å»ºgeneratorConfig-xmlçš„é…ç½®æ–‡ä»¶"><a href="#STEP-2-æ–°å»ºgeneratorConfig-xmlçš„é…ç½®æ–‡ä»¶" class="headerlink" title="STEP 2. æ–°å»ºgeneratorConfig.xmlçš„é…ç½®æ–‡ä»¶"></a>STEP 2. æ–°å»ºgeneratorConfig.xmlçš„é…ç½®æ–‡ä»¶</h1><p>åœ¨mavené¡¹ç›®ä¸‹çš„src/main/resources ç›®å½•ä¸‹å»ºç«‹åä¸º generatorConfig.xmlçš„é…ç½®æ–‡ä»¶ï¼Œä½œä¸ºmybatis-generator-maven-plugin æ’ä»¶çš„æ‰§è¡Œç›®æ ‡ï¼Œæ¨¡æ¿å¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;!DOCTYPE generatorConfiguration  </span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"  </span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--å¯¼å…¥å±æ€§é…ç½® --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"generator.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!--æŒ‡å®šç‰¹å®šæ•°æ®åº“çš„jdbcé©±åŠ¨jaråŒ…çš„ä½ç½® --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">"$&#123;jdbc.driverLocation&#125;"</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"default"</span> <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3"</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!-- optionalï¼Œæ—¨åœ¨åˆ›å»ºclassæ—¶ï¼Œå¯¹æ³¨é‡Šè¿›è¡Œæ§åˆ¶ --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressDate"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!--jdbcçš„æ•°æ®åº“è¿æ¥ --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span> <span class="attr">connectionURL</span>=<span class="string">"$&#123;jdbc.connectionURL&#125;"</span> <span class="attr">userId</span>=<span class="string">"$&#123;jdbc.userId&#125;"</span> <span class="attr">password</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!-- éå¿…éœ€ï¼Œç±»å‹å¤„ç†å™¨ï¼Œåœ¨æ•°æ®åº“ç±»å‹å’Œjavaç±»å‹ä¹‹é—´çš„è½¬æ¢æ§åˆ¶--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span> &gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!-- Modelæ¨¡å‹ç”Ÿæˆå™¨,ç”¨æ¥ç”Ÿæˆå«æœ‰ä¸»é”®keyçš„ç±»ï¼Œè®°å½•ç±» ä»¥åŠæŸ¥è¯¢Exampleç±»  </span></span><br><span class="line"><span class="comment">            targetPackage     æŒ‡å®šç”Ÿæˆçš„modelç”Ÿæˆæ‰€åœ¨çš„åŒ…å  </span></span><br><span class="line"><span class="comment">            targetProject     æŒ‡å®šåœ¨è¯¥é¡¹ç›®ä¸‹æ‰€åœ¨çš„è·¯å¾„  </span></span><br><span class="line"><span class="comment">        --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"org.louis.hometutor.po"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å¯¹modelæ·»åŠ  æ„é€ å‡½æ•° --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"constructorBased"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å…è®¸å­åŒ…ï¼Œå³targetPackage.schemaName.tableName --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- å»ºç«‹çš„Modelå¯¹è±¡æ˜¯å¦ ä¸å¯æ”¹å˜  å³ç”Ÿæˆçš„Modelå¯¹è±¡ä¸ä¼šæœ‰ setteræ–¹æ³•ï¼Œåªæœ‰æ„é€ æ–¹æ³• --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"immutable"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- ç»™Modelæ·»åŠ ä¸€ä¸ªçˆ¶ç±» --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"rootClass"</span> <span class="attr">value</span>=<span class="string">"com.foo.louis.Hello"</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å¯¹ç±»CHARç±»å‹çš„åˆ—çš„æ•°æ®è¿›è¡Œtrimæ“ä½œ --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!--Mapperæ˜ å°„æ–‡ä»¶ç”Ÿæˆæ‰€åœ¨çš„ç›®å½• ä¸ºæ¯ä¸€ä¸ªæ•°æ®åº“çš„è¡¨ç”Ÿæˆå¯¹åº”çš„SqlMapæ–‡ä»¶ --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"org.louis.hometutor.domain"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">&lt;!-- å®¢æˆ·ç«¯ä»£ç ï¼Œç”Ÿæˆæ˜“äºä½¿ç”¨çš„é’ˆå¯¹Modelå¯¹è±¡å’ŒXMLé…ç½®æ–‡ä»¶ çš„ä»£ç   </span></span><br><span class="line"><span class="comment">                type="ANNOTATEDMAPPER",ç”ŸæˆJava Model å’ŒåŸºäºæ³¨è§£çš„Mapperå¯¹è±¡  </span></span><br><span class="line"><span class="comment">                type="MIXEDMAPPER",ç”ŸæˆåŸºäºæ³¨è§£çš„Java Model å’Œç›¸åº”çš„Mapperå¯¹è±¡  </span></span><br><span class="line"><span class="comment">                type="XMLMAPPER",ç”ŸæˆSQLMap XMLæ–‡ä»¶å’Œç‹¬ç«‹çš„Mapperæ¥å£  </span></span><br><span class="line"><span class="comment">        --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.foo.tourist.dao"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span> <span class="attr">type</span>=<span class="string">"MIXEDMAPPER"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">                    å®šä¹‰Maper.java æºä»£ç ä¸­çš„ByExample() æ–¹æ³•çš„å¯è§†æ€§ï¼Œå¯é€‰çš„å€¼æœ‰ï¼š  </span></span><br><span class="line"><span class="comment">                    public;  </span></span><br><span class="line"><span class="comment">                    private;  </span></span><br><span class="line"><span class="comment">                    protected;  </span></span><br><span class="line"><span class="comment">                    default  </span></span><br><span class="line"><span class="comment">                    æ³¨æ„ï¼šå¦‚æœ targetRuntime="MyBatis3",æ­¤å‚æ•°è¢«å¿½ç•¥  </span></span><br><span class="line"><span class="comment">             --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exampleMethodVisibility"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">                                           æ–¹æ³•åè®¡æ•°å™¨  </span></span><br><span class="line"><span class="comment">              Important <span class="doctag">note:</span> this property is ignored if the target runtime is MyBatis3.  </span></span><br><span class="line"><span class="comment">             --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"methodNameCalculator"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">                                                ä¸ºç”Ÿæˆçš„æ¥å£æ·»åŠ çˆ¶æ¥å£ </span></span><br><span class="line"><span class="comment">             --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"rootInterface"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"lession"</span> <span class="attr">schema</span>=<span class="string">"louis"</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- optional   , only for mybatis3 runtime  </span></span><br><span class="line"><span class="comment">                 è‡ªåŠ¨ç”Ÿæˆçš„é”®å€¼ï¼ˆidentity,æˆ–è€…åºåˆ—å€¼ï¼‰  </span></span><br><span class="line"><span class="comment">               å¦‚æœæŒ‡å®šæ­¤å…ƒç´ ï¼ŒMBGå°†ä¼šç”Ÿæˆ&lt;selectKey&gt;å…ƒç´ ï¼Œç„¶åå°†æ­¤å…ƒç´ æ’å…¥åˆ°SQL Mapçš„&lt;insert&gt; å…ƒç´ ä¹‹ä¸­  </span></span><br><span class="line"><span class="comment">               sqlStatement çš„è¯­å¥å°†ä¼šè¿”å›æ–°çš„å€¼  </span></span><br><span class="line"><span class="comment">               å¦‚æœæ˜¯ä¸€ä¸ªè‡ªå¢ä¸»é”®çš„è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„è¯­å¥,æˆ–è€…æ·»åŠ è‡ªå®šä¹‰çš„SQLè¯­å¥. é¢„å®šä¹‰çš„å€¼å¦‚ä¸‹:  </span></span><br><span class="line"><span class="comment">                  Cloudscape    This will translate to: VALUES IDENTITY_VAL_LOCAL()  </span></span><br><span class="line"><span class="comment">                  DB2:      VALUES IDENTITY_VAL_LOCAL()  </span></span><br><span class="line"><span class="comment">                  DB2_MF:       SELECT IDENTITY_VAL_LOCAL() FROM SYSIBM.SYSDUMMY1  </span></span><br><span class="line"><span class="comment">                  Derby:        VALUES IDENTITY_VAL_LOCAL()  </span></span><br><span class="line"><span class="comment">                  HSQLDB:   CALL IDENTITY()  </span></span><br><span class="line"><span class="comment">                  Informix:     select dbinfo('sqlca.sqlerrd1') from systables where tabid=1  </span></span><br><span class="line"><span class="comment">                  MySql:        SELECT LAST_INSERT_ID()  </span></span><br><span class="line"><span class="comment">                  SqlServer:    SELECT SCOPE_IDENTITY()  </span></span><br><span class="line"><span class="comment">                  SYBASE:   SELECT @@IDENTITY  </span></span><br><span class="line"><span class="comment">                  JDBC:     This will configure MBG to generate code for MyBatis3 suport of JDBC standard generated keys. This is a database independent method of obtaining the value from identity columns.  </span></span><br><span class="line"><span class="comment">                  identity: è‡ªå¢ä¸»é”®  If true, then the column is flagged as an identity column and the generated &lt;selectKey&gt; element will be placed after the insert (for an identity column). If false, then the generated &lt;selectKey&gt; will be placed before the insert (typically for a sequence).  </span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">            --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">""</span> <span class="attr">sqlStatement</span>=<span class="string">""</span> <span class="attr">identity</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">""</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- optional.  </span></span><br><span class="line"><span class="comment">                    åˆ—çš„å‘½åè§„åˆ™ï¼š  </span></span><br><span class="line"><span class="comment">                    MBGä½¿ç”¨ &lt;columnRenamingRule&gt; å…ƒç´ åœ¨è®¡ç®—åˆ—åçš„å¯¹åº” åç§°ä¹‹å‰ï¼Œå…ˆå¯¹åˆ—åè¿›è¡Œé‡å‘½åï¼Œ  </span></span><br><span class="line"><span class="comment">                    ä½œç”¨ï¼šä¸€èˆ¬éœ€è¦å¯¹BUSI_CLIENT_NO å‰çš„BUSI_è¿›è¡Œè¿‡æ»¤  </span></span><br><span class="line"><span class="comment">                    æ”¯æŒæ­£åœ¨è¡¨è¾¾å¼  </span></span><br><span class="line"><span class="comment">                     searchString è¡¨ç¤ºè¦è¢«æ¢æ‰çš„å­—ç¬¦ä¸²  </span></span><br><span class="line"><span class="comment">                     replaceString åˆ™æ˜¯è¦æ¢æˆçš„å­—ç¬¦ä¸²ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¯é€‰  </span></span><br><span class="line"><span class="comment">            --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">columnRenamingRule</span> <span class="attr">searchString</span>=<span class="string">""</span> <span class="attr">replaceString</span>=<span class="string">""</span>/&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!-- optional.å‘Šè¯‰ MBG å¿½ç•¥æŸä¸€åˆ—  </span></span><br><span class="line"><span class="comment">                    columnï¼Œéœ€è¦å¿½ç•¥çš„åˆ—  </span></span><br><span class="line"><span class="comment">                    delimitedColumnName:true ,åŒ¹é…columnçš„å€¼å’Œæ•°æ®åº“åˆ—çš„åç§° å¤§å°å†™å®Œå…¨åŒ¹é…ï¼Œfalse å¿½ç•¥å¤§å°å†™åŒ¹é…  </span></span><br><span class="line"><span class="comment">                    æ˜¯å¦é™å®šè¡¨çš„åˆ—åï¼Œå³å›ºå®šè¡¨åˆ—åœ¨Modelä¸­çš„åç§°  </span></span><br><span class="line"><span class="comment">            --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">ignoreColumn</span> <span class="attr">column</span>=<span class="string">"PLAN_ID"</span>  <span class="attr">delimitedColumnName</span>=<span class="string">"true"</span> /&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">&lt;!--optional.è¦†ç›–MBGå¯¹Model çš„ç”Ÿæˆè§„åˆ™  </span></span><br><span class="line"><span class="comment">                 column: æ•°æ®åº“çš„åˆ—å  </span></span><br><span class="line"><span class="comment">                 javaType: å¯¹åº”çš„Javaæ•°æ®ç±»å‹çš„å®Œå…¨é™å®šå  </span></span><br><span class="line"><span class="comment">                 åœ¨å¿…è¦çš„æ—¶å€™å¯ä»¥è¦†ç›–ç”±JavaTypeResolverè®¡ç®—å¾—åˆ°çš„javaæ•°æ®ç±»å‹. For some databases, this is necessary to handle "odd" database types (e.g. MySql's unsigned bigint type should be mapped to java.lang.Object).  </span></span><br><span class="line"><span class="comment">                 jdbcType:è¯¥åˆ—çš„JDBCæ•°æ®ç±»å‹(INTEGER, DECIMAL, NUMERIC, VARCHAR, etc.)ï¼Œè¯¥åˆ—å¯ä»¥è¦†ç›–ç”±JavaTypeResolverè®¡ç®—å¾—åˆ°çš„Jdbcç±»å‹ï¼Œå¯¹æŸäº›æ•°æ®åº“è€Œè¨€ï¼Œå¯¹äºå¤„ç†ç‰¹å®šçš„JDBC é©±åŠ¨ç™–å¥½ å¾ˆæœ‰å¿…è¦(e.g. DB2's LONGVARCHAR type should be mapped to VARCHAR for iBATIS).  </span></span><br><span class="line"><span class="comment">                 typeHandler:  </span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">            --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">columnOverride</span> <span class="attr">column</span>=<span class="string">""</span> <span class="attr">javaType</span>=<span class="string">""</span>    <span class="attr">jdbcType</span>=<span class="string">""</span> <span class="attr">typeHandler</span>=<span class="string">""</span>  <span class="attr">delimitedColumnName</span>=<span class="string">""</span> /&gt;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="é…ç½®æ–‡ä»¶generator-propertieså±æ€§æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶generator-propertieså±æ€§æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶generator.propertieså±æ€§æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶generator.propertieså±æ€§æ–‡ä»¶</h2><p>è¿™é‡Œä½¿ç”¨äº†å¤–ç½®çš„é…ç½®æ–‡ä»¶generator.propertiesï¼Œå¯ä»¥å°†ä¸€ä¸‹å±æ€§é…ç½®åˆ°propertiesæ–‡ä»¶ä¹‹ä¸­ï¼Œå¢åŠ é…ç½®çš„çµæ´»æ€§ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverLocation=D:\\maven\\com\\oracle\\ojdbc14\\10.2.0.4.0\\ojdbc14-10.2.0.4.0.jar  </span><br><span class="line">jdbc.driverClass=oracle.jdbc.driver.OracleDriver  </span><br><span class="line">jdbc.connectionURL=jdbc:oracle:thin:@//localhost:1521/XE  </span><br><span class="line">jdbc.userId=LOUIS  </span><br><span class="line">jdbc.password=123456</span><br></pre></td></tr></table></figure></p><h2 id="é¡¹ç›®ç›®å½•"><a href="#é¡¹ç›®ç›®å½•" class="headerlink" title="é¡¹ç›®ç›®å½•"></a>é¡¹ç›®ç›®å½•</h2><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-12-%E7%B2%98%E8%B4%B4%E7%9A%84%E5%9B%BE%E7%89%8717_9_12_%E4%B8%8B%E5%8D%882_38.jpg" alt></p><h1 id="STEP-3-æ–°å¢mavenè¿è¡Œé€‰é¡¹"><a href="#STEP-3-æ–°å¢mavenè¿è¡Œé€‰é¡¹" class="headerlink" title="STEP 3. æ–°å¢mavenè¿è¡Œé€‰é¡¹"></a>STEP 3. æ–°å¢mavenè¿è¡Œé€‰é¡¹</h1><p>åœ¨Intellij IDEAæ·»åŠ ä¸€ä¸ªâ€œRunè¿è¡Œâ€é€‰é¡¹ï¼Œä½¿ç”¨mavenè¿è¡Œmybatis-generator-maven-pluginæ’ä»¶ ï¼š<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-12-%E7%B2%98%E8%B4%B4%E7%9A%84%E5%9B%BE%E7%89%8717_9_12_%E4%B8%8B%E5%8D%882_39.jpg" alt="æ­¥éª¤1"></p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-12-%E7%B2%98%E8%B4%B4%E7%9A%84%E5%9B%BE%E7%89%8717_9_12_%E4%B8%8B%E5%8D%882_40-1.jpg" alt="æ­¥éª¤2"></p><p>ä¹‹åå¼¹å‡ºè¿è¡Œé…ç½®æ¡†ï¼Œä¸ºå½“å‰é…ç½®é…ç½®ä¸€ä¸ªåç§°ï¼Œè¿™é‡Œå…¶åä¸ºâ€generatorâ€,ç„¶ååœ¨ â€œCommand lineâ€ é€‰é¡¹ä¸­è¾“å…¥â€œ<code>mybatis-generator:generate  -e</code>â€</p><p>è¿™é‡ŒåŠ äº†â€œ-e â€é€‰é¡¹æ˜¯ä¸ºäº†è®©è¯¥æ’ä»¶è¾“å‡ºè¯¦ç»†ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½é—®é¢˜ã€‚<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-12-061534.jpg" alt="æ­¥éª¤3"></p><p><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-12-061541.jpg" alt="æ­¥éª¤4"></p><p>å¦‚æœæ·»åŠ æˆåŠŸï¼Œåˆ™ä¼šåœ¨run é€‰é¡¹ä¸­æœ‰â€œgeneratorâ€ é€‰é¡¹ï¼Œå¦‚ä¸‹ï¼š<br><img src="http://ow1k5uxqk.bkt.clouddn.com/2017-09-12-%E7%B2%98%E8%B4%B4%E7%9A%84%E5%9B%BE%E7%89%8717_9_12_%E4%B8%8B%E5%8D%882_41-1.jpg" alt="æ­¥éª¤5"></p><p>ç‚¹å‡»è¿è¡Œï¼Œç„¶åä¸å‡ºæ„å¤–çš„è¯ï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">C:\Java\jdk1.7.0_71\bin\java -Dmaven.home=D:\software\apache-maven-3.0.5-bin -Dclassworlds.conf=D:\software\apache-maven-3.0.5-bin\bin\m2.conf -Didea.launcher.port=7533 &quot;-Didea.launcher.bin.path=D:\applications\JetBrains\IntelliJ IDEA 14.0.2\bin&quot; -Dfile.encoding=UTF-8 -classpath &quot;D:\software\apache-maven-3.0.5-bin\boot\plexus-classworlds-2.4.jar;D:\applications\JetBrains\IntelliJ IDEA 14.0.2\lib\idea_rt.jar&quot; com.intellij.rt.execution.application.AppMain org.codehaus.classworlds.Launcher -Didea.version=14.0.2 -s D:\software\apache-maven-3.0.5-bin\conf\settings.xml mybatis-generator:generate -e  </span><br><span class="line">[INFO] Error stacktraces are turned on.  </span><br><span class="line">[INFO] Scanning for projects...  </span><br><span class="line">[INFO]                                                                           </span><br><span class="line">[INFO] ------------------------------------------------------------------------  </span><br><span class="line">[INFO] Building hometutor Maven Webapp 1.0-SNAPSHOT  </span><br><span class="line">[INFO] ------------------------------------------------------------------------  </span><br><span class="line">[INFO]   </span><br><span class="line">[INFO] --- mybatis-generator-maven-plugin:1.3.2:generate (default-cli) @ hometutor ---  </span><br><span class="line">[INFO] Connecting to the Database  </span><br><span class="line">[INFO] Introspecting table louis.lession  </span><br><span class="line">log4j:WARN No appenders could be found for logger (org.mybatis.generator.internal.db.DatabaseIntrospector).  </span><br><span class="line">log4j:WARN Please initialize the log4j system properly.  </span><br><span class="line">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.  </span><br><span class="line">[INFO] Generating Example class for table LOUIS.LESSION  </span><br><span class="line">[INFO] Generating Record class for table LOUIS.LESSION  </span><br><span class="line">[INFO] Generating Mapper Interface for table LOUIS.LESSION  </span><br><span class="line">[INFO] Generating SQL Map for table LOUIS.LESSION  </span><br><span class="line">[INFO] Saving file LessionMapper.xml  </span><br><span class="line">[INFO] Saving file LessionExample.java  </span><br><span class="line">[INFO] Saving file Lession.java  </span><br><span class="line">[INFO] Saving file LessionMapper.java  </span><br><span class="line">[WARNING] Root class com.foo.louis.Hello cannot be loaded, checking for member overrides is disabled for this class   </span><br><span class="line">[WARNING] Existing file E:\sources\tutor\src\main\java\org\louis\hometutor\po\Lession.java was overwritten  </span><br><span class="line">[WARNING] Existing file E:\sources\tutor\src\main\java\com\foo\tourist\dao\LessionMapper.java was overwritten  </span><br><span class="line">[INFO] ------------------------------------------------------------------------  </span><br><span class="line">[INFO] BUILD SUCCESS  </span><br><span class="line">[INFO] ------------------------------------------------------------------------  </span><br><span class="line">[INFO] Total time: 2.334s  </span><br><span class="line">[INFO] Finished at: Tue Jan 27 12:04:08 CST 2015  </span><br><span class="line">[INFO] Final Memory: 8M/107M  </span><br><span class="line">[INFO] ------------------------------------------------------------------------  </span><br><span class="line">  </span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure></p><p>å¥½ï¼Œçœ‹åˆ°BUILD SUCCESSï¼Œåˆ™å¤§åŠŸå‘Šæˆï¼Œå¦‚æœæœ‰é”™è¯¯çš„è¯ï¼Œç”±äºæ·»åŠ äº†-e é€‰é¡¹ï¼Œä¼šæŠŠå…·ä½“çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥çš„ï¼Œæ ¹æ®é”™è¯¯ä¿¡æ¯ä¿®æ”¹å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> Maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDEA </tag>
            
            <tag> Maven </tag>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisé…ç½®ä»¥åŠå¸¸è§„æ“ä½œç±»å°è£…</title>
      <link href="//posts/66a772a9.html"/>
      <url>//posts/66a772a9.html</url>
      
        <content type="html"><![CDATA[<p>ç›´æ¥ä¸Šä»£ç å§!!</p><h2 id="æŠ½è±¡åŸºç¡€ç±»"><a href="#æŠ½è±¡åŸºç¡€ç±»" class="headerlink" title="æŠ½è±¡åŸºç¡€ç±»"></a>æŠ½è±¡åŸºç¡€ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractBaseRedis</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> RedisTemplate&lt;K, V&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®redisTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisTemplate the redisTemplate to set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedisTemplate</span><span class="params">(RedisTemplate&lt;K, V&gt; redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å– String  RedisSerializer</span></span><br><span class="line"><span class="comment">     * &lt;br&gt;------------------------------&lt;br&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> RedisSerializer&lt;String&gt; <span class="title">getStringSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getStringSerializer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="JsonMapper"><a href="#JsonMapper" class="headerlink" title="JsonMapper"></a>JsonMapper</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.TimeZone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringEscapeUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude.Include;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonParser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JavaType;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializerProvider;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.util.JSONPObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonMapper</span> <span class="keyword">extends</span> <span class="title">ObjectMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger LOGGER = LoggerFactory.getLogger(JsonMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JsonMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JsonMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(Include.NON_EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JsonMapper</span><span class="params">(Include include)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®è¾“å‡ºæ—¶åŒ…å«å±æ€§çš„é£æ ¼</span></span><br><span class="line">        <span class="keyword">if</span> (include != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setSerializationInclusion(include);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¾ç½®è¾“å…¥æ—¶å¿½ç•¥åœ¨JSONå­—ç¬¦ä¸²ä¸­å­˜åœ¨ä½†Javaå¯¹è±¡å®é™…æ²¡æœ‰çš„å±æ€§</span></span><br><span class="line">        <span class="keyword">this</span>.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">        <span class="comment">// ç©ºå€¼å¤„ç†ä¸ºç©ºä¸²</span></span><br><span class="line">        <span class="keyword">this</span>.getSerializerProvider().setNullValueSerializer(<span class="keyword">new</span> JsonSerializer&lt;Object&gt;()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Object value, JsonGenerator jgen,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  SerializerProvider provider)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">                    JsonProcessingException </span>&#123;</span><br><span class="line">                jgen.writeString(<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// è¿›è¡ŒHTMLè§£ç ã€‚</span></span><br><span class="line">        <span class="keyword">this</span>.registerModule(<span class="keyword">new</span> SimpleModule().addSerializer(String.class, <span class="keyword">new</span> JsonSerializer&lt;String&gt;()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(String value, JsonGenerator jgen,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  SerializerProvider provider)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">                    JsonProcessingException </span>&#123;</span><br><span class="line">                jgen.writeString(StringEscapeUtils.unescapeHtml4(value));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="comment">// è®¾ç½®æ—¶åŒº</span></span><br><span class="line">        <span class="keyword">this</span>.setTimeZone(TimeZone.getDefault());<span class="comment">//getTimeZone("GMT+8:00")</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºåªè¾“å‡ºéNullä¸”éEmpty(å¦‚List.isEmpty)çš„å±æ€§åˆ°Jsonå­—ç¬¦ä¸²çš„Mapper,å»ºè®®åœ¨å¤–éƒ¨æ¥å£ä¸­ä½¿ç”¨.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JsonMapper <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mapper == <span class="keyword">null</span>)&#123;</span><br><span class="line">            mapper = <span class="keyword">new</span> JsonMapper().enableSimple();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºåªè¾“å‡ºåˆå§‹å€¼è¢«æ”¹å˜çš„å±æ€§åˆ°Jsonå­—ç¬¦ä¸²çš„Mapper, æœ€èŠ‚çº¦çš„å­˜å‚¨æ–¹å¼ï¼Œå»ºè®®åœ¨å†…éƒ¨æ¥å£ä¸­ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JsonMapper <span class="title">nonDefaultMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mapper == <span class="keyword">null</span>)&#123;</span><br><span class="line">            mapper = <span class="keyword">new</span> JsonMapper(Include.NON_DEFAULT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Objectå¯ä»¥æ˜¯POJOï¼Œä¹Ÿå¯ä»¥æ˜¯Collectionæˆ–æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœå¯¹è±¡ä¸ºNull, è¿”å›"null".</span></span><br><span class="line"><span class="comment">     * å¦‚æœé›†åˆä¸ºç©ºé›†åˆ, è¿”å›"[]".</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toJson</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.writeValueAsString(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">if</span>(LOGGER.isWarnEnabled())&#123;</span><br><span class="line">                LOGGER.warn(<span class="string">"write to json string error:"</span> + object, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ååºåˆ—åŒ–POJOæˆ–ç®€å•Collectionå¦‚List&lt;String&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å¦‚æœJSONå­—ç¬¦ä¸²ä¸ºNullæˆ–"null"å­—ç¬¦ä¸², è¿”å›Null.</span></span><br><span class="line"><span class="comment">     * å¦‚æœJSONå­—ç¬¦ä¸²ä¸º"[]", è¿”å›ç©ºé›†åˆ.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å¦‚éœ€ååºåˆ—åŒ–å¤æ‚Collectionå¦‚List&lt;MyBean&gt;, è¯·ä½¿ç”¨fromJson(String,JavaType)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #fromJson(String, JavaType)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">fromJson</span><span class="params">(String jsonString, Class&lt;T&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jsonString)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.readValue(jsonString, clazz);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">if</span>(LOGGER.isWarnEnabled())&#123;</span><br><span class="line">                LOGGER.warn(<span class="string">"parse json string error:"</span> + jsonString, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ååºåˆ—åŒ–å¤æ‚Collectionå¦‚List&lt;Bean&gt;, å…ˆä½¿ç”¨å‡½æ•¸createCollectionTypeæ„é€ ç±»å‹,ç„¶åè°ƒç”¨æœ¬å‡½æ•°.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #createCollectionType(Class, Class...)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">fromJson</span><span class="params">(String jsonString, JavaType javaType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jsonString)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) <span class="keyword">this</span>.readValue(jsonString, javaType);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">if</span>(LOGGER.isWarnEnabled())&#123;</span><br><span class="line">                LOGGER.warn(<span class="string">"parse json string error:"</span> + jsonString, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ§‹é€ æ³›å‹çš„Collection Typeå¦‚:</span></span><br><span class="line"><span class="comment">     * ArrayList&lt;MyBean&gt;, åˆ™è°ƒç”¨constructCollectionType(ArrayList.class,MyBean.class)</span></span><br><span class="line"><span class="comment">     * HashMap&lt;String,MyBean&gt;, åˆ™è°ƒç”¨(HashMap.class,String.class, MyBean.class)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JavaType <span class="title">createCollectionType</span><span class="params">(Class&lt;?&gt; collectionClass, Class&lt;?&gt;... elementClasses)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getTypeFactory().constructParametricType(collectionClass, elementClasses);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç•¶JSONè£¡åªå«æœ‰Beançš„éƒ¨åˆ†å±¬æ€§æ™‚ï¼Œæ›´æ–°ä¸€å€‹å·²å­˜åœ¨Beanï¼Œåªè¦†è“‹è©²éƒ¨åˆ†çš„å±¬æ€§.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">update</span><span class="params">(String jsonString, T object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) <span class="keyword">this</span>.readerForUpdating(object).readValue(jsonString);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">if</span>(LOGGER.isWarnEnabled())&#123;</span><br><span class="line">                LOGGER.warn(<span class="string">"update json string:"</span> + jsonString + <span class="string">" to object:"</span> + object + <span class="string">" error."</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">if</span>(LOGGER.isWarnEnabled())&#123;</span><br><span class="line">                LOGGER.warn(<span class="string">"update json string:"</span> + jsonString + <span class="string">" to object:"</span> + object + <span class="string">" error."</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¼¸å‡ºJSONPæ ¼å¼æ•¸æ“š.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toJsonP</span><span class="params">(String functionName, Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> toJson(<span class="keyword">new</span> JSONPObject(functionName, object));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¨­å®šæ˜¯å¦ä½¿ç”¨Enumçš„toStringå‡½æ•¸ä¾†è®€å¯«Enum,</span></span><br><span class="line"><span class="comment">     * ç‚ºFalseæ™‚æ™‚ä½¿ç”¨Enumçš„name()å‡½æ•¸ä¾†è®€å¯«Enum, é»˜èªç‚ºFalse.</span></span><br><span class="line"><span class="comment">     * æ³¨æ„æœ¬å‡½æ•¸ä¸€å®šè¦åœ¨Mapperå‰µå»ºå¾Œ, æ‰€æœ‰çš„è®€å¯«å‹•ä½œä¹‹å‰èª¿ç”¨.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonMapper <span class="title">enableEnumUseToString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.enable(SerializationFeature.WRITE_ENUMS_USING_TO_STRING);</span><br><span class="line">        <span class="keyword">this</span>.enable(DeserializationFeature.READ_ENUMS_USING_TO_STRING);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…è®¸å•å¼•å·</span></span><br><span class="line"><span class="comment">     * å…è®¸ä¸å¸¦å¼•å·çš„å­—æ®µåç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonMapper <span class="title">enableSimple</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.configure(Feature.ALLOW_SINGLE_QUOTES, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">this</span>.configure(Feature.ALLOW_UNQUOTED_FIELD_NAMES, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–å‡ºMapperåšè¿›ä¸€æ­¥çš„è®¾ç½®æˆ–ä½¿ç”¨å…¶ä»–åºåˆ—åŒ–API.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">getMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toJsonString</span><span class="params">(Object object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JsonMapper.getInstance().toJson(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">fromJsonString</span><span class="params">(String jsonString, Class&lt;T&gt; clazz)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JsonMapper.getInstance().fromJson(jsonString, clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†objå¯¹è±¡è½¬æ¢æˆ classç±»å‹çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">parseObject</span><span class="params">(Object obj, Class&lt;T&gt; clazz)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(JSON.toJSONString(obj), clazz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JSONåºåˆ—åŒ–"><a href="#JSONåºåˆ—åŒ–" class="headerlink" title="JSONåºåˆ—åŒ–"></a>JSONåºåˆ—åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.SerializationException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by SIVEN on 17/9/4.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonRedisSeriaziler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMPTY_JSON = <span class="string">"&#123;&#125;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JsonRedisSeriaziler</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * java-object as json-string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">seriazileAsString</span><span class="params">(Object object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (object== <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> EMPTY_JSON;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.objectMapper.writeValueAsString(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SerializationException(<span class="string">"Could not write JSON: "</span> + ex.getMessage(), ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * json-string to java-object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">deserializeAsObject</span><span class="params">(String str,Class&lt;T&gt; clazz)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(str == <span class="keyword">null</span> || clazz == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.objectMapper.readValue(str, clazz);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SerializationException(<span class="string">"Could not write JSON: "</span> + ex.getMessage(), ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RedisClient"><a href="#RedisClient" class="headerlink" title="RedisClient"></a>RedisClient</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.BoundHashOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisCallback;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisClient</span> <span class="keyword">extends</span> <span class="title">AbstractBaseRedis</span>&lt;<span class="title">String</span>, <span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ç¼“å­˜&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyç²¾ç¡®åŒ¹é…åˆ é™¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(key!=<span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(key.length == <span class="number">1</span>)&#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * ï¼ˆè¯¥æ“ä½œä¼šæ‰§è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨ï¼Œä»¥å…å½±å“æ€§èƒ½æˆ–è¯¯åˆ ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchDel</span><span class="params">(String... pattern)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String kp : pattern) &#123;</span><br><span class="line">            redisTemplate.delete(redisTemplate.keys(kp + <span class="string">"*"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–å¾—ç¼“å­˜ï¼ˆintå‹ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getInt</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        String value = stringRedisTemplate.boundValueOps(key).get();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(value))&#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–å¾—ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStr</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stringRedisTemplate.boundValueOps(key).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–å¾—ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStr</span><span class="params">(String key, <span class="keyword">boolean</span> retain)</span></span>&#123;</span><br><span class="line">        String value = stringRedisTemplate.boundValueOps(key).get();</span><br><span class="line">        <span class="keyword">if</span>(!retain)&#123;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * æ³¨ï¼šåŸºæœ¬æ•°æ®ç±»å‹(Characteré™¤å¤–)ï¼Œè¯·ç›´æ¥ä½¿ç”¨get(String key, Class&lt;T&gt; clazz)å–å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObj</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.boundValueOps(key).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * æ³¨ï¼šjava 8ç§åŸºæœ¬ç±»å‹çš„æ•°æ®è¯·ç›´æ¥ä½¿ç”¨get(String key, Class&lt;T&gt; clazz)å–å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> retain    æ˜¯å¦ä¿ç•™</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObj</span><span class="params">(String key, <span class="keyword">boolean</span> retain)</span></span>&#123;</span><br><span class="line">        Object obj = redisTemplate.boundValueOps(key).get();</span><br><span class="line">        <span class="keyword">if</span>(!retain)&#123;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * æ³¨ï¼šè¯¥æ–¹æ³•æš‚ä¸æ”¯æŒCharacteræ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(String key, Class&lt;T&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T)redisTemplate.boundValueOps(key).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜jsonå¯¹è±¡&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getJson</span><span class="params">(String key, Class&lt;T&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JsonMapper.fromJsonString(stringRedisTemplate.boundValueOps(key).get(), clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†valueå¯¹è±¡å†™å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time å¤±æ•ˆæ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key,Object value,Long time)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value.getClass().equals(String.class))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, value.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value.getClass().equals(Integer.class))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, value.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value.getClass().equals(Double.class))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, value.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value.getClass().equals(Float.class))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, value.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value.getClass().equals(Short.class))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, value.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value.getClass().equals(Long.class))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, value.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value.getClass().equals(Boolean.class))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, value.toString());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(time &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†valueå¯¹è±¡ä»¥JSONæ ¼å¼å†™å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time å¤±æ•ˆæ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJson</span><span class="params">(String key,Object value,Long time)</span></span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JsonMapper.toJsonString(value));</span><br><span class="line">        <span class="keyword">if</span>(time &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            stringRedisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°keyå¯¹è±¡fieldçš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   ç¼“å­˜key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> field ç¼“å­˜å¯¹è±¡field</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value ç¼“å­˜å¯¹è±¡fieldå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJsonField</span><span class="params">(String key, String field, String value)</span></span>&#123;</span><br><span class="line">        JSONObject obj = JSON.parseObject(stringRedisTemplate.boundValueOps(key).get());</span><br><span class="line">        obj.put(field, value);</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, obj.toJSONString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å‡æ“ä½œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">double</span> by)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å¢æ“ä½œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">double</span> by)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–doubleç±»å‹å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getDouble</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        String value = stringRedisTemplate.boundValueOps(key).get();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(value))&#123;</span><br><span class="line">            <span class="keyword">return</span> Double.valueOf(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®doubleç±»å‹å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time å¤±æ•ˆæ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDouble</span><span class="params">(String key, <span class="keyword">double</span> value, Long time)</span> </span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, String.valueOf(value));</span><br><span class="line">        <span class="keyword">if</span>(time &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            stringRedisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®doubleç±»å‹å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time å¤±æ•ˆæ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInt</span><span class="params">(String key, <span class="keyword">int</span> value, Long time)</span> </span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, String.valueOf(value));</span><br><span class="line">        <span class="keyword">if</span>(time &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            stringRedisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†mapå†™å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time å¤±æ•ˆæ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">setMap</span><span class="params">(String key, Map&lt;String, T&gt; map, Long time)</span></span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†mapå†™å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time å¤±æ•ˆæ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">setMap</span><span class="params">(String key, T obj, Long time)</span></span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = (Map&lt;String, String&gt;)JsonMapper.parseObject(obj, Map.class);</span><br><span class="line">        redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘keyå¯¹åº”çš„mapä¸­æ·»åŠ ç¼“å­˜å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">addMap</span><span class="params">(String key, Map&lt;String, T&gt; map)</span></span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘keyå¯¹åº”çš„mapä¸­æ·»åŠ ç¼“å­˜å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   cacheå¯¹è±¡key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> field mapå¯¹åº”çš„key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value     å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMap</span><span class="params">(String key, String field, String value)</span></span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().put(key, field, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘keyå¯¹åº”çš„mapä¸­æ·»åŠ ç¼“å­˜å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   cacheå¯¹è±¡key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> field mapå¯¹åº”çš„key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj   å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">addMap</span><span class="params">(String key, String field, T obj)</span></span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().put(key, field, obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–mapç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Map&lt;String, T&gt; <span class="title">mget</span><span class="params">(String key, Class&lt;T&gt; clazz)</span></span>&#123;</span><br><span class="line">        BoundHashOperations&lt;String, String, T&gt; boundHashOperations = redisTemplate.boundHashOps(key);</span><br><span class="line">        <span class="keyword">return</span> boundHashOperations.entries();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–mapç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMap</span><span class="params">(String key, Class&lt;T&gt; clazz)</span></span>&#123;</span><br><span class="line">        BoundHashOperations&lt;String, String, String&gt; boundHashOperations = redisTemplate.boundHashOps(key);</span><br><span class="line">        Map&lt;String, String&gt; map = boundHashOperations.entries();</span><br><span class="line">        <span class="keyword">return</span> JsonMapper.parseObject(map, clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–mapç¼“å­˜ä¸­çš„æŸä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> field</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapField</span><span class="params">(String key, String field, Class&lt;T&gt; clazz)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T)redisTemplate.boundHashOps(key).get(field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤mapä¸­çš„æŸä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> lh</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2016å¹´8æœˆ10æ—¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   mapå¯¹åº”çš„key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> field mapä¸­è¯¥å¯¹è±¡çš„key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delMapField</span><span class="params">(String key, String... field)</span></span>&#123;</span><br><span class="line">        BoundHashOperations&lt;String, String, ?&gt; boundHashOperations = redisTemplate.boundHashOps(key);</span><br><span class="line">        boundHashOperations.delete(field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šç¼“å­˜çš„å¤±æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> FangJun</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2016å¹´8æœˆ14æ—¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key ç¼“å­˜KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time å¤±æ•ˆæ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">expire</span><span class="params">(String key, Long time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(time &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ set</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sadd</span><span class="params">(String key, String... value)</span> </span>&#123;</span><br><span class="line">        redisTemplate.boundSetOps(key).add(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤seté›†åˆä¸­çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">srem</span><span class="params">(String key, String... value)</span> </span>&#123;</span><br><span class="line">        redisTemplate.boundSetOps(key).remove(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * seté‡å‘½å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldkey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newkey</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">srename</span><span class="params">(String oldkey, String newkey)</span></span>&#123;</span><br><span class="line">        redisTemplate.boundSetOps(oldkey).rename(newkey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŸ­ä¿¡ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fxl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2016å¹´9æœˆ11æ—¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIntForPhone</span><span class="params">(String key,Object value,<span class="keyword">int</span> time)</span></span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JsonMapper.toJsonString(value));</span><br><span class="line">        <span class="keyword">if</span>(time &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            stringRedisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡ç³ŠæŸ¥è¯¢keys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">keys</span><span class="params">(String pattern)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.keys(pattern);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="redis-xmlæ–‡ä»¶é…ç½®"><a href="#redis-xmlæ–‡ä»¶é…ç½®" class="headerlink" title="redis xmlæ–‡ä»¶é…ç½®"></a>redis xmlæ–‡ä»¶é…ç½®</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context-4.0.xsd"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">default-lazy-init</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Jedis Config<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:config/application-jedis.properties"</span> <span class="attr">ignore-unresolvable</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è¿æ¥æ± é…ç½®. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPoolConfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥æ± ä¸­æœ€å¤§è¿æ¥æ•°ã€‚é«˜ç‰ˆæœ¬ï¼šmaxTotalï¼Œä½ç‰ˆæœ¬ï¼šmaxActive --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.maxTotal&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥æ± ä¸­æœ€å¤§ç©ºé—²çš„è¿æ¥æ•°. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.maxIdle&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥æ± ä¸­æœ€å°‘ç©ºé—²çš„è¿æ¥æ•°. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.minIdle&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å½“è¿æ¥æ± èµ„æºè€—å°½æ—¶ï¼Œè°ƒç”¨è€…æœ€å¤§é˜»å¡çš„æ—¶é—´ï¼Œè¶…æ—¶å°†è·‘å‡ºå¼‚å¸¸ã€‚å•ä½ï¼Œæ¯«ç§’æ•°;é»˜è®¤ä¸º-1.è¡¨ç¤ºæ°¸ä¸è¶…æ—¶ã€‚é«˜ç‰ˆæœ¬ï¼šmaxWaitMillisï¼Œä½ç‰ˆæœ¬ï¼šmaxWait --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.maxWaitMillis&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥ç©ºé—²çš„æœ€å°æ—¶é—´ï¼Œè¾¾åˆ°æ­¤å€¼åç©ºé—²è¿æ¥å°†å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è´Ÿå€¼(-1)è¡¨ç¤ºä¸ç§»é™¤. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.minEvictableIdleTimeMillis&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¯¹äºâ€œç©ºé—²é“¾æ¥â€æ£€æµ‹çº¿ç¨‹è€Œè¨€ï¼Œæ¯æ¬¡æ£€æµ‹çš„é“¾æ¥èµ„æºçš„ä¸ªæ•°ã€‚é»˜è®¤ä¸º3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"numTestsPerEvictionRun"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.numTestsPerEvictionRun&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- â€œç©ºé—²é“¾æ¥â€æ£€æµ‹çº¿ç¨‹ï¼Œæ£€æµ‹çš„å‘¨æœŸï¼Œæ¯«ç§’æ•°ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä¸è¿è¡Œâ€œæ£€æµ‹çº¿ç¨‹â€ã€‚é»˜è®¤ä¸º-1. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.timeBetweenEvictionRunsMillis&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- testOnBorrow:å‘è°ƒç”¨è€…è¾“å‡ºâ€œé“¾æ¥â€èµ„æºæ—¶ï¼Œæ˜¯å¦æ£€æµ‹æ˜¯æœ‰æœ‰æ•ˆï¼Œå¦‚æœæ— æ•ˆåˆ™ä»è¿æ¥æ± ä¸­ç§»é™¤ï¼Œå¹¶å°è¯•è·å–ç»§ç»­è·å–ã€‚é»˜è®¤ä¸ºfalseã€‚å»ºè®®ä¿æŒé»˜è®¤å€¼. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.testOnBorrow&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- testOnReturn:å‘è¿æ¥æ± â€œå½’è¿˜â€é“¾æ¥æ—¶ï¼Œæ˜¯å¦æ£€æµ‹â€œé“¾æ¥â€å¯¹è±¡çš„æœ‰æ•ˆæ€§ã€‚é»˜è®¤ä¸ºfalseã€‚å»ºè®®ä¿æŒé»˜è®¤å€¼.--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnReturn"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.testOnReturn&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- testWhileIdle:å‘è°ƒç”¨è€…è¾“å‡ºâ€œé“¾æ¥â€å¯¹è±¡æ—¶ï¼Œæ˜¯å¦æ£€æµ‹å®ƒçš„ç©ºé—²è¶…æ—¶ï¼›é»˜è®¤ä¸ºfalseã€‚å¦‚æœâ€œé“¾æ¥â€ç©ºé—²è¶…æ—¶ï¼Œå°†ä¼šè¢«ç§»é™¤ã€‚å»ºè®®ä¿æŒé»˜è®¤å€¼. --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- whenExhaustedAction:å½“â€œè¿æ¥æ± â€ä¸­activeæ•°é‡è¾¾åˆ°é˜€å€¼æ—¶ï¼Œå³â€œé“¾æ¥â€èµ„æºè€—å°½æ—¶ï¼Œè¿æ¥æ± éœ€è¦é‡‡å–çš„æ‰‹æ®µ, é»˜è®¤ä¸º1(0:æŠ›å‡ºå¼‚å¸¸ã€‚1:é˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨é“¾æ¥èµ„æºã€‚2:å¼ºåˆ¶åˆ›å»ºæ–°çš„é“¾æ¥èµ„æº) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Springæä¾›çš„Redisè¿æ¥å·¥å‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥æ± é…ç½®. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span> <span class="attr">ref</span>=<span class="string">"jedisPoolConfig"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- RedisæœåŠ¡ä¸»æœº. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hostName"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.hostName&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- RedisæœåŠ¡ç«¯å£å·. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.port&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- RedisæœåŠ¡è¿æ¥å¯†ç . --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.password&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿è¶…æ—¶è®¾ç½®. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.timeout&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ˜¯å¦ä½¿ç”¨è¿æ¥æ± . --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"usePool"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- keyåºåˆ—åŒ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"stringRedisSerializer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"stringRedisTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.core.StringRedisTemplate"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"jedisConnectionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Springæä¾›çš„è®¿é—®Redisç±». --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.core.RedisTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"jedisConnectionFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"keySerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashKeySerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"valueSerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashValueSerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®ç¼“å­˜ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"cacheManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.cache.RedisCacheManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"redisTemplate"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisClient"</span> <span class="attr">class</span>=<span class="string">"cn.com.servyou.gzyjzx.frame.redis.RedisClient"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨AOP å®ç°Redisç¼“å­˜æ³¨è§£ï¼Œæ”¯æŒSPEL</title>
      <link href="//posts/e9084a5f.html"/>
      <url>//posts/e9084a5f.html</url>
      
        <content type="html"><![CDATA[<p>å…¬å¸é¡¹ç›®å¯¹Redisä½¿ç”¨æ¯”è¾ƒå¤šï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰åšAOPï¼Œæ‰€ä»¥ç¼“å­˜é€»è¾‘å’Œä¸šåŠ¡é€»è¾‘äº¤ç»‡åœ¨ä¸€èµ·ï¼Œç»´æŠ¤æ¯”è¾ƒè‰°éš¾<br>æ‰€ä»¥æœ€è¿‘å®ç°äº†é’ˆå¯¹äºRedisçš„@Cacheableï¼ŒæŠŠç¼“å­˜çš„å¯¹è±¡ä¾ç…§ç±»åˆ«åˆ†åˆ«å­˜æ”¾åˆ°redisçš„Hashä¸­ï¼Œå¯¹äºkeyä¹Ÿå®ç°äº†SPELæ”¯æŒã€‚</p><h2 id="å®šä¹‰ç¼“å­˜æ³¨è§£"><a href="#å®šä¹‰ç¼“å­˜æ³¨è§£" class="headerlink" title="å®šä¹‰ç¼“å­˜æ³¨è§£"></a>å®šä¹‰ç¼“å­˜æ³¨è§£</h2><p>åˆ›å»ºæ³¨è§£ï¼Œå…¶å®å¤§éƒ¨åˆ†æ•°æ®éƒ½æ˜¯ä»¥hashå½¢å¼å­˜å‚¨çš„ï¼ˆä½¿çš„keyæ˜“äºç®¡ç†ï¼‰ï¼Œæ‰€ä»¥ï¼Œæ³¨è§£ä¸­å®šä¹‰äº†fieldKeyï¼Œç”¨ä½œHashçš„fieldã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®ç¼“å­˜æ³¨è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DataCacheable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">cacheName</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;<span class="comment">//ç¼“å­˜çš„åç§°, é»˜è®¤å–(ç±»å + æ–¹æ³•å)</span></span><br><span class="line">    String[] fieldKey() ;<span class="comment">//ç¼“å­˜çš„å­—æ®µKey, ä½¿ç”¨SPELæ”¯æŒ, å¦‚:#userName</span></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">expireTime</span><span class="params">()</span> <span class="keyword">default</span> 0</span>; <span class="comment">//è¿‡æœŸæ—¶æ•ˆ(ç§’) [-1æ°¸ä¸è¿‡æœŸ]</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="å®šä¹‰åˆ‡é¢-å®šä¹‰PointCut"><a href="#å®šä¹‰åˆ‡é¢-å®šä¹‰PointCut" class="headerlink" title="å®šä¹‰åˆ‡é¢,å®šä¹‰PointCut"></a>å®šä¹‰åˆ‡é¢,å®šä¹‰PointCut</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®ç¼“å­˜åˆ‡é¢å¤„ç†</span></span><br><span class="line"><span class="comment"> * http://www.cnblogs.com/DajiangDev/p/3770894.html</span></span><br><span class="line"><span class="comment"> * Created by SIVEN on 17/9/1.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataCacheableAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯æ§çš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ExecutorService fixedThreadPool = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"#&#123;config['redis.cache.time']&#125;"</span>)</span><br><span class="line">    Long DEFAULT_CACHE_TIME = <span class="number">600L</span>; <span class="comment">//é»˜è®¤10åˆ†é’Ÿ</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"#&#123;config['redis.cache.enable']&#125;"</span>)</span><br><span class="line">    <span class="keyword">boolean</span> REDIS_CACHE_ENABLE;<span class="comment">//å¯ç”¨ç¼“å­˜å¼€å…³</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RedisClient redisClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ§åˆ¶ä¸šåŠ¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"execution(* gov.etax.dzswj.nsrzx.services..service..*.*(..)) &amp;&amp; @annotation(gov.etax.dzswj.nsrzx.component.cache.annotation.DataCacheable)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">doAround</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!REDIS_CACHE_ENABLE) &#123;</span><br><span class="line">            logger.debug(<span class="string">"ç¼“å­˜å¼€å…³ &gt;&gt; [ç¦ç”¨]"</span>);</span><br><span class="line">            <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method method = getMethod(pjp);</span><br><span class="line">        DataCacheable cacheable = method.getAnnotation(DataCacheable.class);</span><br><span class="line">        String hashKey = getHashKey(pjp, cacheable);</span><br><span class="line">        String fieldKey = parseKey(cacheable.fieldKey(), method, pjp.getArgs());</span><br><span class="line">        <span class="keyword">long</span> expireTime = cacheable.expireTime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–æ–¹æ³•çš„è¿”å›ç±»å‹,è®©ç¼“å­˜å¯ä»¥è¿”å›æ­£ç¡®çš„ç±»å‹</span></span><br><span class="line">        Class returnType = ((MethodSignature) pjp.getSignature()).getReturnType();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨redis çš„hashè¿›è¡Œå­˜å–ï¼Œæ˜“äºç®¡ç†</span></span><br><span class="line">        Object result = redisClient.getMapField(hashKey, fieldKey, returnType);</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">            logger.debug(<span class="string">"DataCacheableAspect: doAround() æŸ¥æ‰¾ç¼“å­˜ä¸ä¸ºç©º, è¿”å›ç¼“å­˜æ•°æ®"</span>);</span><br><span class="line">            setExpireTime(hashKey, expireTime);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        result = pjp.proceed();</span><br><span class="line">        <span class="comment">//åç½®å¤„ç†, å°†ä¸šåŠ¡æ•°æ®åŠ å…¥åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line">        doAfterReturning(hashKey, fieldKey, cacheable.expireTime(), result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åç½®å¤„ç†æ–¹æ³• (å†™å…¥ç¼“å­˜)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> point</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnValue</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(<span class="keyword">final</span> String hashKey, <span class="keyword">final</span> String fieldKey, <span class="keyword">final</span> Long expireTime, <span class="keyword">final</span> Object result)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//çº¿ç¨‹å¤„ç†</span></span><br><span class="line">        fixedThreadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                logger.debug(<span class="string">"DataCacheableAspect: doAfterReturning() ä¸šåŠ¡å¤„ç†å®Œæ¯•, å¼‚æ­¥å°†æ•°æ®æˆ–å†™å…¥ç¼“å­˜ä¸­.."</span>);</span><br><span class="line">                <span class="comment">//åŠ å…¥ç¼“å­˜</span></span><br><span class="line">                redisClient.addMap(hashKey, fieldKey, result);</span><br><span class="line">                <span class="comment">//è®¾ç½®å¤±æ•ˆæ—¶é•¿</span></span><br><span class="line">                setExpireTime(hashKey, expireTime);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hashKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expireTime</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setExpireTime</span><span class="params">(<span class="keyword">final</span> String hashKey, Long expireTime)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®å¤±æ•ˆæ—¶é•¿</span></span><br><span class="line">        Long cacheTime = expireTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == expireTime) &#123;</span><br><span class="line">            cacheTime = DEFAULT_CACHE_TIME;</span><br><span class="line">        &#125;</span><br><span class="line">        redisClient.expire(hashKey, cacheTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è¢«æ‹¦æˆªæ–¹æ³•å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * MethodSignature.getMethod() è·å–çš„æ˜¯é¡¶å±‚æ¥å£æˆ–è€…çˆ¶ç±»çš„æ–¹æ³•å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * è€Œç¼“å­˜çš„æ³¨è§£åœ¨å®ç°ç±»çš„æ–¹æ³•ä¸Š</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥åº”è¯¥ä½¿ç”¨åå°„è·å–å½“å‰å¯¹è±¡çš„æ–¹æ³•å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Method <span class="title">getMethod</span><span class="params">(JoinPoint pjp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–å‚æ•°çš„ç±»å‹</span></span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">        Class[] argTypes = <span class="keyword">new</span> Class[pjp.getArgs().length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">            argTypes[i] = args[i].getClass();</span><br><span class="line">        &#125;</span><br><span class="line">        Method method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            method = pjp.getTarget().getClass().getMethod(pjp.getSignature().getName(), argTypes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> method;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜Hash Key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cacheable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> point</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getHashKey</span><span class="params">(JoinPoint point, DataCacheable cacheable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringHelper.isNotEmpty(cacheable.cacheName())) &#123;</span><br><span class="line">            <span class="keyword">return</span> cacheable.cacheName();</span><br><span class="line">        &#125;</span><br><span class="line">        Signature signature = point.getSignature();</span><br><span class="line">        <span class="keyword">return</span> signature.getDeclaringTypeName() + <span class="string">"."</span> + signature.getName();<span class="comment">//ç±»å + æ–¹æ³•å</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜çš„key</span></span><br><span class="line"><span class="comment">     * key å®šä¹‰åœ¨æ³¨è§£ä¸Šï¼Œæ”¯æŒSPELè¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pjp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parseKey</span><span class="params">(String[] keys, Method method, Object[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–è¢«æ‹¦æˆªæ–¹æ³•å‚æ•°ååˆ—è¡¨(ä½¿ç”¨Springæ”¯æŒç±»åº“)</span></span><br><span class="line">        LocalVariableTableParameterNameDiscoverer u =</span><br><span class="line">                <span class="keyword">new</span> LocalVariableTableParameterNameDiscoverer();</span><br><span class="line">        String[] paraNameArr = u.getParameterNames(method);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨SPELè¿›è¡Œkeyçš„è§£æ</span></span><br><span class="line">        ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">        <span class="comment">//SPELä¸Šä¸‹æ–‡</span></span><br><span class="line">        StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();</span><br><span class="line">        <span class="comment">//æŠŠæ–¹æ³•å‚æ•°æ”¾å…¥SPELä¸Šä¸‹æ–‡ä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paraNameArr.length; i++) &#123;</span><br><span class="line">            context.setVariable(paraNameArr[i], args[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuffer parseKeyBuff = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">            parseKeyBuff.append(<span class="string">"_"</span>).append(parser.parseExpression(key).getValue(context, String.class));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parseKeyBuff.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RedisClientç›¸å…³å°è£…"><a href="#RedisClientç›¸å…³å°è£…" class="headerlink" title="RedisClientç›¸å…³å°è£…"></a>RedisClientç›¸å…³å°è£…</h2><p>å‚è§æ–‡ç« <a href="http://blog.siven.net/2017/09/10/Redisé…ç½®%20&amp;%20å¸¸è§„æ“ä½œç±»å°è£…/">Redisé…ç½® &amp; å¸¸è§„æ“ä½œç±»å°è£…</a></p><h2 id="AOPé…ç½®"><a href="#AOPé…ç½®" class="headerlink" title="AOPé…ç½®"></a>AOPé…ç½®</h2><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NsrxxServiceImpl</span> <span class="keyword">implements</span> <span class="title">INsrxxService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@DataCacheable</span>(fieldKey = <span class="string">"#dto.queryObj.djxh"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultDto&lt;NsrxxDto&gt; <span class="title">queryNsrxxByDjxh</span><span class="params">(QueryDto&lt;QueryByDjxh&gt; dto)</span> </span>&#123;</span><br><span class="line">        INsrxxMapper mapper = SessionTemplateUtil.getMapper(INsrxxMapper.class);</span><br><span class="line">        <span class="keyword">return</span> ResultDtoHelper.success(mapper.queryNsrxxByDjxh(dto.getQueryObj()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> Redis </tag>
            
            <tag> Spring </tag>
            
            <tag> AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ideaæ— æ³•ä¸‹è½½ä¾èµ–åŒ…çš„source,ä½¿ç”¨mavenä¸‹è½½source</title>
      <link href="//posts/dc4851bc.html"/>
      <url>//posts/dc4851bc.html</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ä½¿ç”¨Ideaæ—¶ï¼Œæƒ³æŸ¥çœ‹ä¾èµ–åŒ…çš„æºç ï¼Œä½†å‡ºç°æ— æ³•ä¸‹è½½çš„æç¤ºï¼š</p><blockquote><p>idea Sources for â€˜spring-context-4.3.2.RELEASE.jarâ€™ not found</p></blockquote><h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><h3 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h3><p>ä½¿ç”¨Mavenå‘½ä»¤ã€‚ç»è¿‡æµ‹è¯•ï¼Œå¥½ç”¨ã€‚ä¸‹è½½äº†æ‰€æœ‰POMé‡Œçš„ä¾èµ–åŒ…çš„sourceï¼Œè¿™ç‚¹ä¸æ˜¯æƒ³è¦çš„ï¼ŒåŸæ¥åªæƒ³ä¸‹è½½æƒ³çœ‹çš„ä¾èµ–çš„sourceã€‚å‚è€ƒï¼šIDEA-165800 Canâ€™t download dependencyâ€™s source code<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:resolve -Dclassifier=sources</span><br></pre></td></tr></table></figure></p><h3 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h3><p>1.ä¸‹è½½POMæ–‡ä»¶ä¾èµ–çš„åŒ…çš„source<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:sources</span><br></pre></td></tr></table></figure></p><p>2.ä¸‹è½½POMæ–‡ä»¶ä¾èµ–çš„åŒ…çš„javadoce<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:resolve -Dclassifier=javadoc</span><br></pre></td></tr></table></figure></p><p>3.ä¸‹è½½æŒ‡å®šä¾èµ–åŒ…ï¼ˆartifactIdï¼‰çš„sourceã€‚è¿™ä¸ªå¾ˆä¸é”™ï¼Œæ˜¯æˆ‘æƒ³è¦çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:sources -DincludeArtifactIds=guava</span><br></pre></td></tr></table></figure></p><p>å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/2059431/get-source-jars-from-maven-repository" target="_blank" rel="noopener">Get source JARs from Maven repository</a>ã€€ </p>]]></content>
      
      
      <categories>
          
          <category> Maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDEA </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springé€šè¿‡ApplicationContextä¸»åŠ¨è·å–bean</title>
      <link href="//posts/ac836b44.html"/>
      <url>//posts/ac836b44.html</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšé¡¹ç›®çš„æ—¶å€™æˆ‘å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šSpringçš„IOCå®¹å™¨ä¸èƒ½åœ¨Webä¸­è¢«å¼•ç”¨(æˆ–è€…è¯´ä¸èƒ½è¢«ä»»æ„åœ°å¼•ç”¨)ã€‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­è®©Springè‡ªåŠ¨è£…é…ï¼Œä½†å¹¶æ²¡æœ‰ç•™ä½ApplicationContextçš„å®ä¾‹ã€‚æˆ‘ä»¬å¦‚æœå¸Œæœ›åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä»»ä½•ä½ç½®éƒ½èƒ½æ‹¿åˆ°åŒä¸€ä¸ªApplicationContextæ¥è·å–IOCå®¹å™¨ä¸­çš„èµ„æºï¼Œå°±è¦è®©Springå°†ä¸Šä¸‹æ–‡ç¯å¢ƒå¡«å……åˆ°æˆ‘ä»¬èƒ½è·å–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¸‹é¢çš„åšæ³•ï¼š</p><ul><li>æ–¹æ³•ä¸€: å®ç°è‡ªApplicationContextAwareæ¥å£</li><li>æ–¹æ³•äºŒï¼Œä½¿ç”¨äº†æ³¨è§£å’Œé™æ€åŒ–çš„æ–¹å¼æ¥äº§ç”ŸSpringFactoryå¯¹è±¡</li></ul><a id="more"></a><h1 id="æ–¹æ³•ä¸€-å®ç°è‡ªApplicationContextAwareæ¥å£"><a href="#æ–¹æ³•ä¸€-å®ç°è‡ªApplicationContextAwareæ¥å£" class="headerlink" title="æ–¹æ³•ä¸€: å®ç°è‡ªApplicationContextAwareæ¥å£"></a>æ–¹æ³•ä¸€: å®ç°è‡ªApplicationContextAwareæ¥å£</h1><p>è‡ªå®šä¹‰ä¸€ä¸ªå·¥å…·ç±»ï¼Œå®ç°è‡ªApplicationContextAwareæ¥å£ï¼Œæ¥å£çš„æ–¹æ³•æ˜¯setApplicationContextï¼Œæˆ‘ä»¬å®ç°å®ƒï¼Œå¹¶è®©å…¶ä¸ºæˆ‘ä»¬æœåŠ¡ï¼Œå› ä¸ºSpringåœ¨loadè‡ªå·±çš„æ—¶å€™ä¼šå°†ä¸Šä¸‹æ–‡ç¯å¢ƒå¡«å……è¿›æ¥ã€‚æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯å°†å¾—åˆ°çš„ApplicationContextä¿å­˜ä¸‹æ¥ç”¨ã€‚</p><h2 id="å…³é”®ä»£ç "><a href="#å…³é”®ä»£ç " class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringContextUtil</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * å®ç°ApplicationContextAwareæ¥å£çš„contextæ³¨å…¥å‡½æ•°, å°†å…¶å­˜å…¥é™æ€å˜é‡. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> </span>&#123;  </span><br><span class="line">        SpringContextUtil.applicationContext = applicationContext; <span class="comment">// NOSONAR  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * å–å¾—å­˜å‚¨åœ¨é™æ€å˜é‡ä¸­çš„ApplicationContext. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title">getApplicationContext</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        checkApplicationContext();  </span><br><span class="line">        <span class="keyword">return</span> applicationContext;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * ä»é™æ€å˜é‡ApplicationContextä¸­å–å¾—Bean, è‡ªåŠ¨è½¬å‹ä¸ºæ‰€èµ‹å€¼å¯¹è±¡çš„ç±»å‹. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String name)</span> </span>&#123;  </span><br><span class="line">        checkApplicationContext();  </span><br><span class="line">        <span class="keyword">return</span> (T) applicationContext.getBean(name);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * ä»é™æ€å˜é‡ApplicationContextä¸­å–å¾—Bean, è‡ªåŠ¨è½¬å‹ä¸ºæ‰€èµ‹å€¼å¯¹è±¡çš„ç±»å‹. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; clazz)</span> </span>&#123;  </span><br><span class="line">        checkApplicationContext();  </span><br><span class="line">        <span class="keyword">return</span> (T) applicationContext.getBeansOfType(clazz);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * æ¸…é™¤applicationContexté™æ€å˜é‡. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cleanApplicationContext</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        applicationContext = <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">checkApplicationContext</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span> (applicationContext == <span class="keyword">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"applicaitonContextæœªæ³¨å…¥,è¯·åœ¨applicationContext.xmlä¸­å®šä¹‰SpringContextHolder"</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SPRINGé…ç½®"><a href="#SPRINGé…ç½®" class="headerlink" title="SPRINGé…ç½®"></a>SPRINGé…ç½®</h2><p>ä¸Šæ–‡çš„ç±»å°±æ˜¯æˆ‘ä»¬è¦ç”¨çš„ï¼Œè€Œå…¶ä¸­çš„setApplicationContextæ˜¯æ¥å£ä¸­éœ€è¦å®ç°çš„ï¼ŒSpringä¼šè‡ªåŠ¨è¿›è¡Œå¡«å……ã€‚æˆ‘ä»¬åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œä¸€ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"springContextUtil"</span> <span class="attr">class</span>=<span class="string">"xxx.xx.SpringContextUtil"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><p>è¿™æ ·å°±å¯ä»¥äº†ï¼ŒSpringæŠŠæˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ç»™æˆ‘ä»¬äº†ã€‚<br>æˆ‘ä»¬å°±å¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹è¿™æ ·åšï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YouClass obj = (YouClass)SpringUtil.getObject(<span class="string">"beanid"</span>);</span><br></pre></td></tr></table></figure></p><h1 id="æ–¹æ³•äºŒï¼Œä½¿ç”¨äº†æ³¨è§£å’Œé™æ€åŒ–çš„æ–¹å¼æ¥äº§ç”ŸSpringFactoryå¯¹è±¡"><a href="#æ–¹æ³•äºŒï¼Œä½¿ç”¨äº†æ³¨è§£å’Œé™æ€åŒ–çš„æ–¹å¼æ¥äº§ç”ŸSpringFactoryå¯¹è±¡" class="headerlink" title="æ–¹æ³•äºŒï¼Œä½¿ç”¨äº†æ³¨è§£å’Œé™æ€åŒ–çš„æ–¹å¼æ¥äº§ç”ŸSpringFactoryå¯¹è±¡"></a>æ–¹æ³•äºŒï¼Œä½¿ç”¨äº†æ³¨è§£å’Œé™æ€åŒ–çš„æ–¹å¼æ¥äº§ç”ŸSpringFactoryå¯¹è±¡</h1><p>ä¸Šæ–‡çš„æ–¹æ³•æœ‰ä¸ªéº»çƒ¦çš„åœ°æ–¹ï¼šéœ€è¦é…ç½®ã€‚è€ŒSpring2.5åŠä¹‹åçš„ç‰ˆæœ¬å®é™…ä¸ŠåŠ å…¥äº†æ³¨è§£çš„æ–¹å¼è¿›è¡Œä¾èµ–é¡¹çš„æ³¨å…¥ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç ä¹Ÿè®¸æ›´å¥½ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringContextUtil</span> <span class="keyword">extends</span> <span class="title">SpringBeanAutowiringSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é™æ€æ–¹æ³•åˆå§‹åŒ–ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SpringContextUtil instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> SpringContextUtil();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®beançš„idï¼Œè·å–å¯¹åº”ç±»å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//æ ¹æ®beançš„idè·å–beanå¯¹è±¡è¦æ¯”æ ¹æ®classè·å–beanå¯¹è±¡æ•ˆç‡é«˜ï¼Œä½†å®¹æ˜“å‡ºç°äººä¸ºé”™è¯¯</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String beanId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T)beanFactory.getBean(beanId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®beançš„ç±»å‹ï¼Œè·å–å¯¹åº”ç±»å¯¹è±¡ï¼Œ</span></span><br><span class="line">    <span class="comment">//ä¸å®¹æ˜“å‡ºç°è®¤ä¸ºé”™è¯¯ï¼Œä½†æ•ˆç‡ä¸å¦‚æ ¹æ®idè·å–beanå¯¹è±¡ï¼Œå› ä¸ºspringå†…éƒ¨æ˜¯æŠŠclassè½¬æ¢ä¸ºnameï¼Œç„¶åå†è¿›è¡ŒæŸ¥æ‰¾</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; classT)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beanFactory.getBean(classT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SpringContextUtil <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ³¨è§£æ‰«æ"><a href="#æ³¨è§£æ‰«æ" class="headerlink" title="æ³¨è§£æ‰«æ"></a>æ³¨è§£æ‰«æ</h2><p>å¦‚æœä½¿ç”¨@Autowiredæ³¨è§£è‡ªåŠ¨è£…é…çš„è¯ï¼Œç»§æ‰¿SpringBeanAutowiringSupportç±»æ˜¯ä¸èƒ½å°‘çš„ã€‚å½“ç„¶ï¼Œä½¿ç”¨@Componentç­‰æ³¨è§£ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½¿ç”¨æ³¨è§£çš„è¯é…ç½®å°±éœ€è¦æ”¹åŠ¨äº†ï¼Œä¸è¿‡å› ä¸ºæˆ‘ä»¬ä¸ºæ”¯æŒSpringæ³¨è§£çš„é…ç½®æ˜¯å¯ä»¥å¤šç”¨çš„ï¼Œæ‰€ä»¥è¿˜å¥½ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.ahe"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>é…ç½®å³å¯è®©org.aheä¸‹æ‰€æœ‰åŒ…(æ‚¨ä¾ç„¶å¯ä»¥é€šè¿‡å­æ ‡ç­¾çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ¥è¿›è¡Œæ›´å¤šè®¾ç½®)ä¸‹çš„æ³¨è§£èµ·ä½œç”¨ã€‚</p><h2 id="ä½¿ç”¨ç¤ºä¾‹-1"><a href="#ä½¿ç”¨ç¤ºä¾‹-1" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><p>è¿™æ ·å°±å¯ä»¥äº†ï¼ŒSpringæŠŠæˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ç»™æˆ‘ä»¬äº†ã€‚<br>æˆ‘ä»¬å°±å¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹è¿™æ ·åšï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyTestBean myTestBean = (MyTestBean ) SpringUtil.getInstance().getBean(MyTestBean.class);</span><br><span class="line">MyTestBean myTestBean1 = (MyTestBean) SpringUtil.getInstance().getBean(<span class="string">"myTestBean"</span>);</span><br></pre></td></tr></table></figure></p><h1 id="ç³»ç»Ÿåˆå§‹åŒ–æ— æ³•è·å–bean"><a href="#ç³»ç»Ÿåˆå§‹åŒ–æ— æ³•è·å–bean" class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–æ— æ³•è·å–bean"></a>ç³»ç»Ÿåˆå§‹åŒ–æ— æ³•è·å–bean</h1><p>ç›®å‰åˆåšäº†ä¸ªç³»ç»Ÿåˆå§‹åŒ–çš„ä¸œä¸œSystemInitï¼Œç„¶åå‘ç°ä¸Šé¢çš„getBean()ç”¨ä¸äº†äº†ã€‚çœ‹äº†ä¸‹å‘ç°æ˜¯å› ä¸ºåœ¨ç³»ç»Ÿåˆå§‹åŒ–çš„æ—¶å€™SpringContextUtilè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå¯¼è‡´åœ¨SystemInitç±»é‡Œé¢çš„ä¸œè¥¿getBean()å¤±è´¥ã€‚<br>äºæ˜¯å°æ”¹é€ äº†ä¸‹ï¼ŒæŠŠApplicationContextAwareæ”¾åœ¨SystemInitç±»ï¼Œç„¶åæ³¨å…¥åˆ°SpringContextUtilï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨æ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ–æ–¹æ³•ä¹‹å‰ï¼ŒapplicationContextä¸€å®šä¸æ˜¯nullã€‚</p><h2 id="SpringContextUtil"><a href="#SpringContextUtil" class="headerlink" title="SpringContextUtil"></a>SpringContextUtil</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * springä¸Šä¸‹æ–‡é…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mingchenchen</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringContextUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = Logger.getLogger(SpringContextUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Autowired æ²¿ç”¨springTestçš„è¿™ç§æ–¹æ³• æ˜¯å¦ä¼šæ›´å¥½ï¼Ÿ</span></span><br><span class="line">    <span class="comment">//ApplicationContext ctx;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        SpringContextUtil.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨æ„æ­¤å¤„å˜æˆäº†static</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title">getApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ bean nameé»˜è®¤ = ç±»å(é¦–å­—æ¯å°å†™)</span></span><br><span class="line"><span class="comment">     * ä¾‹å¦‚: A8sClusterDao = getBean("k8sClusterDao")</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationContext.getBean(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç±»åè·å–åˆ°bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getBeanByName</span><span class="params">(Class&lt;T&gt; clazz)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">char</span>[] cs=clazz.getSimpleName().toCharArray();</span><br><span class="line">            cs[<span class="number">0</span>] += <span class="number">32</span>;<span class="comment">//é¦–å­—æ¯å¤§å†™åˆ°å°å†™</span></span><br><span class="line">            <span class="keyword">return</span> (T) applicationContext.getBean(String.valueOf(cs));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">containsBean</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationContext.containsBean(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">(String name)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationContext.isSingleton(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç³»ç»Ÿåˆå§‹åŒ–ä»£ç "><a href="#ç³»ç»Ÿåˆå§‹åŒ–ä»£ç " class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–ä»£ç "></a>ç³»ç»Ÿåˆå§‹åŒ–ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Descripties: ç³»ç»Ÿåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangkaiping</span></span><br><span class="line"><span class="comment"> * 2016å¹´5æœˆ23æ—¥ ä¸Šåˆ11:58:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemInit</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span>,<span class="title">ApplicationContextAware</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = Logger.getLogger(SystemInit.class);</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ClusterDao clusterDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"--------------ç³»ç»Ÿåˆå§‹åŒ–ä¸­-------------------"</span>);</span><br><span class="line">        initClusterCache();<span class="comment">//åˆå§‹åŒ–é›†ç¾¤æ•°æ® å¿…é¡»æœ€å¼€å§‹å®Œæˆ</span></span><br><span class="line">        initRefreshAppStatusTask();</span><br><span class="line">        initUpdateAppStatusToDB();</span><br><span class="line">        initUpdateSession();</span><br><span class="line">        logger.info(<span class="string">"--------------ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ-------------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.åˆå§‹åŒ–é›†ç¾¤æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initClusterCache</span><span class="params">()</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">"1.åˆå§‹åŒ–é›†ç¾¤ä¿¡æ¯åˆ°ç¼“å­˜ä¸­:ClusterCacheå¼€å§‹"</span>);</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æ•°æ®åº“æ‰€æœ‰çš„é›†ç¾¤æ•°æ®</span></span><br><span class="line">        List&lt;ClusterEntity&gt; allClusterInfoList = clusterDao.selectAll(ClusterEntity.class, <span class="string">"delete_flag=0"</span>);</span><br><span class="line">        <span class="keyword">for</span> (ClusterEntity k8sClusterEntity : allClusterInfoList) &#123;</span><br><span class="line">            ClusterCache.put(k8sClusterEntity.getUuid() , k8sClusterEntity);<span class="comment">//å­˜å…¥ç¼“å­˜</span></span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">"1.åˆå§‹åŒ–é›†ç¾¤ä¿¡æ¯åˆ°ç¼“å­˜ä¸­:ClusterCacheå®Œæˆ,æ€»å…±"</span> + allClusterInfoList.size() + <span class="string">"æ¡æ•°æ®"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2.åˆå§‹åŒ–å¼‚æ­¥ä»»åŠ¡:åˆ·æ–°æ‰€æœ‰åº”ç”¨çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initRefreshAppStatusTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"2.åˆå§‹åŒ–ä»»åŠ¡:RefreshAllAppStatusTask åˆ·æ–°åº”ç”¨ä¸‹çš„k8sçš„podçŠ¶æ€å¹¶å­˜å…¥å¾…æ›´æ–°é˜Ÿåˆ—"</span>);</span><br><span class="line">        RefreshAppStatusExcutor.init();</span><br><span class="line">        logger.info(<span class="string">"2.åˆå§‹åŒ–ä»»åŠ¡:RefreshAllAppStatusTask å®Œæˆ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3.åˆå§‹åŒ–å¼‚æ­¥ä»»åŠ¡:æ›´æ–°çŠ¶æ€åˆ°æ•°æ®åº“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUpdateAppStatusToDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"3.åˆå§‹åŒ–ä»»åŠ¡:RefreshToDBTask ä»å¾…æ›´æ–°Appinstanceé˜Ÿåˆ—å–å‡ºæ•°æ®å¹¶æ›´æ–°æ•°æ®åº“"</span>);</span><br><span class="line">        UpdateAppStatusToDBExcutor.init();</span><br><span class="line">        logger.info(<span class="string">"3.åˆå§‹åŒ–ä»»åŠ¡:RefreshToDBTask å®Œæˆ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 4. åˆå§‹åŒ–å¼‚æ­¥ä»»åŠ¡ï¼š æ›´æ–°ç”¨æˆ·çš„æ‰€æœ‰session</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUpdateSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"4.åˆå§‹åŒ–ä»»åŠ¡ï¼šæ›´æ–°sessionå¼€å§‹"</span>);</span><br><span class="line">        UserSessionUpdateExcutor.init();</span><br><span class="line">        logger.info(<span class="string">"4.åˆå§‹åŒ–ä»»åŠ¡ï¼šæ›´æ–°sessionç»“æŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ­¤æ–¹æ³•ä¸€å®šä¸è¦å†™æˆstatic</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> </span></span><br><span class="line"><span class="function">                                                <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="comment">//å®é™…ä¸Šæ˜¯æŠŠapplicationContextä¼ å…¥åˆ°äº†SpringContextUtilé‡Œé¢</span></span><br><span class="line">        SpringContextUtil.setApplicationContext(applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring3 æ•´åˆMyBatis3 é…ç½®å¤šæ•°æ®æº åŠ¨æ€é€‰æ‹©SqlSessionFactory</title>
      <link href="//posts/7fd48064.html"/>
      <url>//posts/7fd48064.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>Springæ•´åˆMyBatisåˆ‡æ¢SqlSessionFactoryæœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ã€ ç»§æ‰¿SqlSessionDaoSupportï¼Œé‡å†™è·å–SqlSessionFactoryçš„æ–¹æ³•ã€‚ç¬¬äºŒã€ç»§æ‰¿SqlSessionTemplate é‡å†™getSqlSessionFactoryã€getConfigurationå’ŒSqlSessionInterceptorè¿™ä¸ªæ‹¦æˆªå™¨ã€‚å…¶ä¸­æœ€ä¸ºå…³é”®è¿˜æ˜¯ç»§æ‰¿SqlSessionTemplate å¹¶é‡å†™é‡Œé¢çš„æ–¹æ³•ã€‚</p><p>è€ŒSpringæ•´åˆMyBatisä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é…ç½®MapperFactoryBeanï¼Œå¦ä¸€ç§åˆ™æ˜¯åˆ©ç”¨MapperScannerConfigurerè¿›è¡Œæ‰«ææ¥å£æˆ–åŒ…å®Œæˆå¯¹è±¡çš„è‡ªåŠ¨åˆ›å»ºã€‚ç›¸å¯¹æ¥è¯´åè€…æ›´æ–¹ä¾¿äº›ã€‚MapperFactoryBeanç»§æ‰¿äº†SqlSessionDaoSupportä¹Ÿå°±æ˜¯åŠ¨æ€åˆ‡æ¢SqlSessionFactoryçš„ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™å’Œå®ç°SqlSessionDaoSupportæ–¹æ³•ï¼Œæˆ–è€…æ˜¯ç»§æ‰¿MapperFactoryBeanæ¥é‡å†™è¦†ç›–ç›¸å…³æ–¹æ³•ã€‚å¦‚æœåˆ©ç”¨MapperScannerConfigurerçš„é…ç½®æ•´åˆæ¥åˆ‡æ¢SqlSessionFactoryï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç»§æ‰¿SqlSessionTemplateï¼Œé‡å†™ä¸Šé¢æåˆ°çš„æ–¹æ³•ã€‚åœ¨æ•´åˆçš„é…ç½®ä¸­å¾ˆå¤šåœ°æ–¹éƒ½æ˜¯å¯ä»¥æ³¨å…¥SqlSessionTemplateä»£æ›¿SqlSessionFactoryçš„æ³¨å…¥çš„ã€‚å› ä¸ºSqlSessionTemplateçš„åˆ›å»ºä¹Ÿæ˜¯éœ€è¦æ³¨å…¥SqlSessionFactoryçš„ã€‚</p><a id="more"></a><h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><h3 id="ç»§æ‰¿SqlSessionTemplate-é‡å†™getSqlSessionFactoryã€getConfigurationå’ŒSqlSessionInterceptor"><a href="#ç»§æ‰¿SqlSessionTemplate-é‡å†™getSqlSessionFactoryã€getConfigurationå’ŒSqlSessionInterceptor" class="headerlink" title="ç»§æ‰¿SqlSessionTemplate é‡å†™getSqlSessionFactoryã€getConfigurationå’ŒSqlSessionInterceptor"></a>ç»§æ‰¿SqlSessionTemplate é‡å†™getSqlSessionFactoryã€getConfigurationå’ŒSqlSessionInterceptor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.reflect.Proxy.newProxyInstance;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.ibatis.reflection.ExceptionUtil.unwrapThrowable;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mybatis.spring.SqlSessionUtils.closeSqlSession;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mybatis.spring.SqlSessionUtils.getSqlSession;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mybatis.spring.SqlSessionUtils.isSqlSessionTransactional;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.exceptions.PersistenceException;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.BatchResult;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ExecutorType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.RowBounds;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.MyBatisExceptionTranslator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.support.PersistenceExceptionTranslator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;function:&lt;/b&gt; ç»§æ‰¿SqlSessionTemplate é‡å†™ç›¸å…³æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hoojo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createDate</span> 2013-10-18 ä¸‹åˆ03:07:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@file</span> CustomSqlSessionTemplate.java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> com.hoo.framework.mybatis.support</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> SHMB</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@blog</span> http://blog.csdn.net/IBM_hoojo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> hoojo_@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSqlSessionTemplate</span> <span class="keyword">extends</span> <span class="title">SqlSessionTemplate</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorType executorType;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SqlSession sqlSessionProxy;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PersistenceExceptionTranslator exceptionTranslator;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Map&lt;Object, SqlSessionFactory&gt; targetSqlSessionFactorys;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory defaultTargetSqlSessionFactory;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTargetSqlSessionFactorys</span><span class="params">(Map&lt;Object, SqlSessionFactory&gt; targetSqlSessionFactorys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.targetSqlSessionFactorys = targetSqlSessionFactorys;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultTargetSqlSessionFactory</span><span class="params">(SqlSessionFactory defaultTargetSqlSessionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.defaultTargetSqlSessionFactory = defaultTargetSqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomSqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(sqlSessionFactory, sqlSessionFactory.getConfiguration().getDefaultExecutorType());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomSqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory, ExecutorType executorType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(sqlSessionFactory, executorType, <span class="keyword">new</span> MyBatisExceptionTranslator(sqlSessionFactory.getConfiguration()</span><br><span class="line">                .getEnvironment().getDataSource(), <span class="keyword">true</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomSqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory, ExecutorType executorType,</span></span></span><br><span class="line"><span class="function"><span class="params">            PersistenceExceptionTranslator exceptionTranslator)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">super</span>(sqlSessionFactory, executorType, exceptionTranslator);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">this</span>.sqlSessionFactory = sqlSessionFactory;</span><br><span class="line">        <span class="keyword">this</span>.executorType = executorType;</span><br><span class="line">        <span class="keyword">this</span>.exceptionTranslator = exceptionTranslator;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.sqlSessionProxy = (SqlSession) newProxyInstance(</span><br><span class="line">                SqlSessionFactory.class.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> Class[] &#123; SqlSession.class &#125;, </span><br><span class="line">                <span class="keyword">new</span> SqlSessionInterceptor());</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">this</span>.defaultTargetSqlSessionFactory = sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        SqlSessionFactory targetSqlSessionFactory = targetSqlSessionFactorys.get(CustomerContextHolder.getContextType());</span><br><span class="line">        <span class="keyword">if</span> (targetSqlSessionFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> targetSqlSessionFactory;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (defaultTargetSqlSessionFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> defaultTargetSqlSessionFactory;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Assert.notNull(targetSqlSessionFactorys, <span class="string">"Property 'targetSqlSessionFactorys' or 'defaultTargetSqlSessionFactory' are required"</span>);</span><br><span class="line">            Assert.notNull(defaultTargetSqlSessionFactory, <span class="string">"Property 'defaultTargetSqlSessionFactory' or 'targetSqlSessionFactorys' are required"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Configuration <span class="title">getConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getSqlSessionFactory().getConfiguration();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExecutorType <span class="title">getExecutorType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.executorType;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> PersistenceExceptionTranslator <span class="title">getPersistenceExceptionTranslator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.exceptionTranslator;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">selectOne</span><span class="params">(String statement)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;T&gt; selectOne(statement);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">selectOne</span><span class="params">(String statement, Object parameter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;T&gt; selectOne(statement, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;K, V&gt; <span class="function">Map&lt;K, V&gt; <span class="title">selectMap</span><span class="params">(String statement, String mapKey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;K, V&gt; selectMap(statement, mapKey);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;K, V&gt; <span class="function">Map&lt;K, V&gt; <span class="title">selectMap</span><span class="params">(String statement, Object parameter, String mapKey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;K, V&gt; selectMap(statement, parameter, mapKey);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;K, V&gt; <span class="function">Map&lt;K, V&gt; <span class="title">selectMap</span><span class="params">(String statement, Object parameter, String mapKey, RowBounds rowBounds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;K, V&gt; selectMap(statement, parameter, mapKey, rowBounds);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">selectList</span><span class="params">(String statement)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;E&gt; selectList(statement);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">selectList</span><span class="params">(String statement, Object parameter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;E&gt; selectList(statement, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">selectList</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.&lt;E&gt; selectList(statement, parameter, rowBounds);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">(String statement, ResultHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionProxy.select(statement, handler);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">(String statement, Object parameter, ResultHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionProxy.select(statement, parameter, handler);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionProxy.select(statement, parameter, rowBounds, handler);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(String statement)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.insert(statement);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(String statement, Object parameter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.insert(statement, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String statement)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.update(statement);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String statement, Object parameter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.update(statement, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(String statement)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.delete(statement);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(String statement, Object parameter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.delete(statement, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getConfiguration().getMapper(type, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Manual commit is not allowed over a Spring managed SqlSession"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">(<span class="keyword">boolean</span> force)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Manual commit is not allowed over a Spring managed SqlSession"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Manual rollback is not allowed over a Spring managed SqlSession"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">(<span class="keyword">boolean</span> force)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Manual rollback is not allowed over a Spring managed SqlSession"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Manual close is not allowed over a Spring managed SqlSession"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionProxy.clearCache();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0.2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;BatchResult&gt; <span class="title">flushStatements</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionProxy.flushStatements();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Proxy needed to route MyBatis method calls to the proper SqlSession got from Spring's Transaction Manager It also</span></span><br><span class="line"><span class="comment">     * unwraps exceptions thrown by &#123;<span class="doctag">@code</span> Method#invoke(Object, Object...)&#125; to pass a &#123;<span class="doctag">@code</span> PersistenceException&#125; to</span></span><br><span class="line"><span class="comment">     * the &#123;<span class="doctag">@code</span> PersistenceExceptionTranslator&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionInterceptor</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> SqlSession sqlSession = getSqlSession(</span><br><span class="line">                    CustomSqlSessionTemplate.<span class="keyword">this</span>.getSqlSessionFactory(),</span><br><span class="line">                    CustomSqlSessionTemplate.<span class="keyword">this</span>.executorType, </span><br><span class="line">                    CustomSqlSessionTemplate.<span class="keyword">this</span>.exceptionTranslator);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Object result = method.invoke(sqlSession, args);</span><br><span class="line">                <span class="keyword">if</span> (!isSqlSessionTransactional(sqlSession, CustomSqlSessionTemplate.<span class="keyword">this</span>.getSqlSessionFactory())) &#123;</span><br><span class="line">                    <span class="comment">// force commit even on non-dirty sessions because some databases require</span></span><br><span class="line">                    <span class="comment">// a commit/rollback before calling close()</span></span><br><span class="line">                    sqlSession.commit(<span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                Throwable unwrapped = unwrapThrowable(t);</span><br><span class="line">                <span class="keyword">if</span> (CustomSqlSessionTemplate.<span class="keyword">this</span>.exceptionTranslator != <span class="keyword">null</span> &amp;&amp; unwrapped <span class="keyword">instanceof</span> PersistenceException) &#123;</span><br><span class="line">                    Throwable translated = CustomSqlSessionTemplate.<span class="keyword">this</span>.exceptionTranslator</span><br><span class="line">                        .translateExceptionIfPossible((PersistenceException) unwrapped);</span><br><span class="line">                    <span class="keyword">if</span> (translated != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        unwrapped = translated;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> unwrapped;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                closeSqlSession(sqlSession, CustomSqlSessionTemplate.<span class="keyword">this</span>.getSqlSessionFactory());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å†™åçš„getSqlSessionFactoryæ–¹æ³•ä¼šä»æˆ‘ä»¬é…ç½®çš„SqlSessionFactoryé›†åˆtargetSqlSessionFactorysæˆ–é»˜è®¤çš„defaultTargetSqlSessionFactoryä¸­è·å–Sessionå¯¹è±¡ã€‚è€Œæ”¹å†™çš„SqlSessionInterceptor æ˜¯è¿™ä¸ªMyBatisæ•´åˆSpringçš„å…³é”®ï¼Œæ‰€æœ‰çš„SqlSessionFactoryå¯¹è±¡çš„sessionéƒ½å°†åœ¨è¿™é‡Œå®Œæˆåˆ›å»ºã€æäº¤ã€å…³é—­ç­‰æ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬æ”¹å†™è¿™é‡Œçš„ä»£ç ï¼Œåœ¨è¿™é‡Œè·å–getSqlSessionFactoryçš„æ—¶å€™ï¼Œä»å¤šä¸ªSqlSessionFactoryä¸­è·å–æˆ‘ä»¬è®¾ç½®çš„é‚£ä¸ªå³å¯ã€‚</p><p>ä¸Šé¢æ·»åŠ äº†targetSqlSessionFactorysã€defaultTargetSqlSessionFactoryä¸¤ä¸ªå±æ€§æ¥é…ç½®å¤šä¸ªSqlSessionFactoryå¯¹è±¡å’Œé»˜è®¤çš„SqlSessionFactoryå¯¹è±¡ã€‚</p><h3 id="CustomerContextHolder-è®¾ç½®SqlSessionFactoryçš„ç±»å‹"><a href="#CustomerContextHolder-è®¾ç½®SqlSessionFactoryçš„ç±»å‹" class="headerlink" title="CustomerContextHolder è®¾ç½®SqlSessionFactoryçš„ç±»å‹"></a>CustomerContextHolder è®¾ç½®SqlSessionFactoryçš„ç±»å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;function:&lt;/b&gt; å¤šæ•°æ®æº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hoojo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createDate</span> 2013-9-27 ä¸Šåˆ11:36:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@file</span> CustomerContextHolder.java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> com.hoo.framework.spring.support</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> SHMB</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@blog</span> http://blog.csdn.net/IBM_hoojo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> hoojo_@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerContextHolder</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String SESSION_FACTORY_MYSQL = <span class="string">"mysql"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String SESSION_FACTORY_ORACLE = <span class="string">"oracle"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; contextHolder = <span class="keyword">new</span> ThreadLocal&lt;String&gt;();  </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setContextType</span><span class="params">(String contextType)</span> </span>&#123;  </span><br><span class="line">        contextHolder.set(contextType);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getContextType</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> contextHolder.get();  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clearContextType</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        contextHolder.remove();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ç›¸å…³çš„æ–‡ä»¶applicationContext-session-factory-xml"><a href="#é…ç½®ç›¸å…³çš„æ–‡ä»¶applicationContext-session-factory-xml" class="headerlink" title="é…ç½®ç›¸å…³çš„æ–‡ä»¶applicationContext-session-factory.xml"></a>é…ç½®ç›¸å…³çš„æ–‡ä»¶applicationContext-session-factory.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mysqlDataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- åŸºæœ¬å±æ€§ urlã€userã€password --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- Filters --&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name="filters" value="config,stat" /&gt;  </span></span><br><span class="line"><span class="comment">        &lt;property name="connectionProperties" value="config.decrypt=true" /&gt; --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filters"</span> <span class="attr">value</span>=<span class="string">"stat"</span> /&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"20"</span> /&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"300000"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validationQuery"</span> <span class="attr">value</span>=<span class="string">"SELECT 'x'"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnReturn"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å° --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolPreparedStatements"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolPreparedStatementPerConnectionSize"</span> <span class="attr">value</span>=<span class="string">"20"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- æ•°æ®æº2 --&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"oracleDataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span>    </span><br><span class="line">        <span class="comment">&lt;!-- åŸºæœ¬å±æ€§ urlã€userã€password --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;dataSource2.driver&#125;"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;dataSource2.url&#125;"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;dataSource2.username&#125;"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;dataSource2.password&#125;"</span> /&gt;</span>    </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"20"</span> /&gt;</span>    </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span>    </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span>    </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"300000"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validationQuery"</span> <span class="attr">value</span>=<span class="string">"SELECT 'x' FROM DUAL"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnReturn"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span>    </span><br><span class="line">        <span class="comment">&lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å° --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolPreparedStatements"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolPreparedStatementPerConnectionSize"</span> <span class="attr">value</span>=<span class="string">"20"</span> /&gt;</span>    </span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filters --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filters"</span> <span class="attr">value</span>=<span class="string">"stat"</span> /&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>    </span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"oracleSqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"oracleDataSource"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis/mybatis-config.xml"</span>/&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- mapperå’Œresultmapé…ç½®è·¯å¾„ --&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span>  </span><br><span class="line">                <span class="comment">&lt;!-- è¡¨ç¤ºåœ¨com.hooç›®å½•ä¸‹çš„ä»»æ„åŒ…ä¸‹çš„resultmapåŒ…ç›®å½•ä¸­ï¼Œä»¥-resultmap.xmlæˆ–-mapper.xmlç»“å°¾æ‰€æœ‰æ–‡ä»¶ --&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath*:/mapper/TestMapper.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®SqlSessionFactoryBean --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mysqlSqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"mysqlDataSource"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis/mybatis-config.xml"</span>/&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- mapperå’Œresultmapé…ç½®è·¯å¾„ --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span>  </span><br><span class="line">                <span class="comment">&lt;!-- è¡¨ç¤ºåœ¨com.hooç›®å½•ä¸‹çš„ä»»æ„åŒ…ä¸‹çš„resultmapåŒ…ç›®å½•ä¸­ï¼Œä»¥-resultmap.xmlæˆ–-mapper.xmlç»“å°¾æ‰€æœ‰æ–‡ä»¶ ï¼ˆoracleå’Œmysqlæ‰«æçš„é…ç½®å’Œè·¯å¾„ä¸ä¸€æ ·ï¼Œå¦‚æœæ˜¯å…¬å…±çš„éƒ½æ‰«æ è¿™é‡Œè¦åŒºåˆ†ä¸‹ï¼Œä¸ç„¶å°±æŠ¥é”™ æ‰¾ä¸åˆ°å¯¹åº”çš„è¡¨ã€è§†å›¾ï¼‰--&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:com/zlzkj/app/mapper/*-mapper.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>      </span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®è‡ªå®šä¹‰çš„SqlSessionTemplateæ¨¡æ¿ï¼Œæ³¨å…¥ç›¸å…³é…ç½® --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionTemplate"</span> <span class="attr">class</span>=<span class="string">"com.zlzkj.app.support.CustomSqlSessionTemplate"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"mysqlSqlSessionFactory"</span> /&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetSqlSessionFactorys"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span>       </span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">value-ref</span>=<span class="string">"oracleSqlSessionFactory"</span> <span class="attr">key</span>=<span class="string">"oracle"</span>/&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">value-ref</span>=<span class="string">"mysqlSqlSessionFactory"</span> <span class="attr">key</span>=<span class="string">"mysql"</span>/&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- é€šè¿‡æ‰«æçš„æ¨¡å¼ï¼Œæ‰«æç›®å½•åœ¨com/hoo/ä»»æ„ç›®å½•ä¸‹çš„mapperç›®å½•ä¸‹ï¼Œæ‰€æœ‰çš„mapperéƒ½éœ€è¦ç»§æ‰¿SqlMapperæ¥å£çš„æ¥å£ --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- æ³¨æ„æ³¨å…¥sqlSessionTemplate --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionTemplateBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionTemplate"</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.zlzkj.app.mapper,com.zlzkj.core.mybatis,com.zlzkj.app.omapper"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Serciceæµ‹è¯•è°ƒç”¨"><a href="#Serciceæµ‹è¯•è°ƒç”¨" class="headerlink" title="Serciceæµ‹è¯•è°ƒç”¨"></a>Serciceæµ‹è¯•è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CustomerContextHolder.setContextType(CustomerContextHolder.SESSION_FACTORY_ORACLE);  </span><br><span class="line"><span class="keyword">try</span> &#123;  </span><br><span class="line">    Test test = mapper.selectByPrimaryKey((<span class="keyword">short</span>)<span class="number">1</span>);  </span><br><span class="line">    System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;"</span>+test.getName());  </span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">    e.printStackTrace();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œå¦‚æœæ•°æ®èƒ½è¯»å‡ºæ¥ï¼Œé‚£å°±æ­å–œä½ ï¼Œä½ é…ç½®å¤šæ•°æ®æºæˆåŠŸäº†ã€‚</p><h2 id="æ³¨è§£æ”¯æŒ"><a href="#æ³¨è§£æ”¯æŒ" class="headerlink" title="æ³¨è§£æ”¯æŒ"></a>æ³¨è§£æ”¯æŒ</h2><p>ä½¿ç”¨æ³¨è§£æ–¹å¼, åŠ¨æ€é…ç½®æ•°æ®æº</p><h3 id="è‡ªå®šä¹‰å®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰å®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰å®šä¹‰æ³¨è§£:"></a>è‡ªå®šä¹‰å®šä¹‰æ³¨è§£:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ‡æ¢æ•°æ®æº</span></span><br><span class="line"><span class="comment"> * åœ¨service implæ–¹æ³•è¿›è¡Œæ³¨è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SwitchDataSource &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">DataSoure <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> DataSoure.gt3</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®æº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> DataSoure &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysqlæ•°æ®æº</span></span><br><span class="line">    mysql,</span><br><span class="line">    <span class="comment">//oracleæ•°æ®æº</span></span><br><span class="line">    oracle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AOPæ‹¦æˆªæ³¨è§£"><a href="#AOPæ‹¦æˆªæ³¨è§£" class="headerlink" title="AOPæ‹¦æˆªæ³¨è§£"></a>AOPæ‹¦æˆªæ³¨è§£</h3><p>ä½¿ç”¨ä¸šåŠ¡å‰ç½®çš„æ–¹å¼,å¯¹ä¸šåŠ¡æ–¹æ³•è¿›è¡Œåˆ‡é¢å¤„ç†<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤šæ•°æ®æºåˆ‡é¢å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwitchDataSourceAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(value = <span class="string">"execution(* gov.etax.dzswj.nsrzx.services..service..*.*(..)) and @annotation(gov.etax.dzswj.nsrzx.services.common.datasource.annotation.SwitchDataSource))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Signature signature = joinPoint.getSignature();</span><br><span class="line">        MethodSignature methodSignature = (MethodSignature) signature;</span><br><span class="line">        Method method = methodSignature.getMethod();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (method != <span class="keyword">null</span>) &#123;</span><br><span class="line">            SwitchDataSource annotation = method.getAnnotation(SwitchDataSource.class);</span><br><span class="line">            <span class="comment">//è®¾ç½®æ•°æ®æº</span></span><br><span class="line">            CustomerContextHolder.setContextType(annotation.value().name());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        CustomerContextHolder.clearContextType();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="è°ƒç”¨ç¤ºä¾‹"><a href="#è°ƒç”¨ç¤ºä¾‹" class="headerlink" title="è°ƒç”¨ç¤ºä¾‹"></a>è°ƒç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº³ç¨äººä¿¡æ¯æŸ¥è¯¢æœåŠ¡å®ç°ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> SIVEN</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NsrxxServiceImpl</span> <span class="keyword">implements</span> <span class="title">INsrxxService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SwitchDataSource</span>(DataSoure.gt3)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultDto&lt;NsrxxDto&gt; <span class="title">queryNsrxxByDjxh</span><span class="params">(QueryDto&lt;QueryByDjxh&gt; dto)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//int i = 1 /0;</span></span><br><span class="line">        INsrxxMapper mapper = SessionTemplateUtil.getMapper(INsrxxMapper.class);</span><br><span class="line">        <span class="keyword">return</span> ResultDtoHelper.success(mapper.queryNsrxxByDjxh(dto.getQueryObj()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒæ–‡ç« :</p><ul><li><a href="http://www.cnblogs.com/hoojo/p/dynamic_switch_sqlSessionfactory_muliteSqlSessionFactory.html" target="_blank" rel="noopener">Spring3 æ•´åˆMyBatis3 é…ç½®å¤šæ•°æ®æº åŠ¨æ€é€‰æ‹©SqlSessionFactory</a></li><li><a href="http://blog.csdn.net/qq_28118497/article/details/52751202" target="_blank" rel="noopener">Spring+Mybatiså¤šæ•°æ®æºé…ç½®mysql+oracle</a></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> Mybatis </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®©Macä¹Ÿèƒ½æ‹¥æœ‰apt-getç±»ä¼¼çš„åŠŸèƒ½â€”â€”Brew</title>
      <link href="//posts/3f92a831.html"/>
      <url>//posts/3f92a831.html</url>
      
        <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ï¼š<a href="http://snowolf.iteye.com/blog/774312" target="_blank" rel="noopener">http://snowolf.iteye.com/blog/774312</a></p><p>ä¹‹å‰ä¸€ç›´æ€€å¿µubuntuä¸‹çš„apt-getï¼Œå› ä¸ºå®åœ¨æ˜¯æ–¹ä¾¿ï¼Œéœ€è¦å®‰è£…ä»€ä¹ˆï¼Œä¸€ä¸ªå‘½ä»¤æå®šï¼Œç›¸å…³çš„ä¾èµ–åŒ…ç»Ÿç»Ÿç”±apt-getç»´æŠ¤ã€‚ä¸‹è½½ï¼Œç¼–è¯‘ï¼Œå®‰è£…ï¼Œé‚£å«ä¸€ä¸ªç—›å¿«ã€‚ä»€ä¹ˆè½¯ä»¶ç”¨ç€ä¸çˆ½ï¼Œä¸€ä¸ªå‘½ä»¤å¸è½½ï¼</p><p>æ€€å¿µapt-getä¹‹ä½™ï¼Œå‘ç°äº†æ›¿ä»£å·¥å…·MacPortsï¼Œæ®è¯´ä¹Ÿå¯ä»¥è§£å†³æˆ‘çš„é—®é¢˜ã€‚ä½†å¯æƒœï¼Œæˆ‘æ€»æ˜¯æ— æ³•æ›´æ–°æœ¬åœ°è½¯ä»¶ç´¢å¼•åº“ï¼</p><p>homebrewä¸»é¡µå¯¹brewè¿›è¡Œäº†è¯¦ç»†çš„æè¿°ï¼Œä¸è¿‡æˆ‘ä»¬æ›´å¸Œæœ›ä¸‹è½½ä¸‹æ¥å®æˆ˜æ¼”ç»ƒï¼</p><a id="more"></a><h2 id="1-å®‰è£…brewï¼š"><a href="#1-å®‰è£…brewï¼š" class="headerlink" title="1.å®‰è£…brewï¼š"></a>1.å®‰è£…brewï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LsSf http://github.com/mxcl/homebrew/tarball/master | sudo tar xvz -C/usr/<span class="built_in">local</span> --strip 1</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤ï¼Œåœ¨å®˜ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°ï¼</p><h2 id="2-ä½¿ç”¨brewå®‰è£…è½¯ä»¶"><a href="#2-ä½¿ç”¨brewå®‰è£…è½¯ä»¶" class="headerlink" title="2.ä½¿ç”¨brewå®‰è£…è½¯ä»¶"></a>2.ä½¿ç”¨brewå®‰è£…è½¯ä»¶</h2><p>åˆ«çš„å·¥å…·ä¸è¯´ï¼Œwgetå°‘ä¸äº†ï¼Œä½†æ˜¯macä¸Šé»˜è®¤æ²¡æœ‰ï¼<br>å°±å…ˆæ‹¿å®ƒæ¥å¼€åˆ€äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install wget</span><br></pre></td></tr></table></figure><p>ç”šè‡³æ˜¯å®‰è£…tomcatï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install tomcat</span><br></pre></td></tr></table></figure><h2 id="3-ä½¿ç”¨brewå¸è½½è½¯ä»¶"><a href="#3-ä½¿ç”¨brewå¸è½½è½¯ä»¶" class="headerlink" title="3.ä½¿ç”¨brewå¸è½½è½¯ä»¶"></a>3.ä½¿ç”¨brewå¸è½½è½¯ä»¶</h2><p>å®‰è£…ç®€å•ï¼Œå¸è½½å°±æ›´ç®€å•äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew uninstall unrar</span><br></pre></td></tr></table></figure><h2 id="4-ä½¿ç”¨brewæ£€ç´¢è½¯ä»¶"><a href="#4-ä½¿ç”¨brewæ£€ç´¢è½¯ä»¶" class="headerlink" title="4.ä½¿ç”¨brewæ£€ç´¢è½¯ä»¶"></a>4.ä½¿ç”¨brewæ£€ç´¢è½¯ä»¶</h2><p>çœ‹çœ‹æˆ‘ä»¬èƒ½æœåˆ°ä»€ä¹ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew search /apache*/</span><br></pre></td></tr></table></figure><p>/apache*/ä½¿ç”¨çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ³¨æ„ä½¿ç”¨/åˆ†éš”ï¼</p>]]></content>
      
      
      <categories>
          
          <category> MAC OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MAC OS </tag>
            
            <tag> Brew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤å°LinuxæœåŠ¡å™¨ä¹‹é—´é€šè¿‡SCPä¼ è¾“æ–‡ä»¶å¤¹ï¼ˆæ— é¡»å¯†ç éªŒè¯ï¼‰</title>
      <link href="//posts/25395298.html"/>
      <url>//posts/25395298.html</url>
      
        <content type="html"><![CDATA[<p>åŸæ–‡å‚è€ƒï¼š<a href="http://buddie.iteye.com/blog/1988730" target="_blank" rel="noopener">http://buddie.iteye.com/blog/1988730</a></p><p>æœ€è¿‘å› å·¥ä½œéœ€è¦ï¼Œè¦åœ¨ä¸¤å°LinuxæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ–‡ä»¶å¤¹ã€‚<br>Linuxå‘½ä»¤é€‰æ‹©æ˜¯SCPï¼ŒSCPå‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -p port user@serverip:/home/user/filename /home/user/filename</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç«¯å£p ä¸ºå‚æ•°ï¼Œport ç«¯å£ï¼›<br>user ä¸ºè¿œç¨‹æœåŠ¡å™¨çš„ç”¨æˆ·ï¼›<br>serverip ä¸ºè¿œç¨‹æœåŠ¡å™¨ipæˆ–è€…åŸŸåï¼›<br>ç¬¬ä¸€ä¸ª/home/user/filename ä¸ºè¦ä¼ è¾“çš„è¿œç¨‹æœåŠ¡å™¨çš„æ–‡ä»¶åï¼›<br>ç¬¬äºŒä¸ª/home/user/filename ä¸ºæœ¬åœ°æœåŠ¡æœåŠ¡å™¨çš„æ–‡ä»¶åã€‚</p><a id="more"></a><p>å¦‚æœç«¯å£æ˜¯é»˜è®¤ï¼Œåˆ™å¯çœç•¥-p portï¼›å¦‚æœä¼ ä¼ è¾“çš„ä¸ºæ–‡ä»¶å¤¹ï¼Œåˆ™è¦åŠ -rå‚æ•°ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r user@serverip:/home/user/folder /home/user/folder</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šæ˜¯ä»serveripè¿™å°æœåŠ¡å™¨ä¸Šä¸‹è½½æ–‡ä»¶å¤¹/home/user/folderåˆ°æœ¬æœåŠ¡å™¨çš„/home/user/folderä¸­ã€‚<br>å¦‚æœè¦ä»æœ¬åœ°ä¸Šä¼ æ–‡ä»¶å¤¹åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œé‚£å°±æ˜¯ä¸‹é¢çš„ç±»ä¼¼æŒ‡ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /home/user/folder user@serverip:/home/user/folder</span><br></pre></td></tr></table></figure><p> è¿™æ ·å°±å®ç°äº†ä¸¤å°LinuxæœåŠ¡å™¨ä¹‹é—´çš„æ–‡ä»¶ã€æ–‡ä»¶å¤¹ä¼ è¾“ã€‚</p><p>å¯æ˜¯æ¯æ¬¡éƒ½è¦è¾“å…¥å¯†ç éªŒè¯ï¼Œå¾ˆéº»çƒ¦ã€‚<br>ä¸ºäº†ä¸ç”¨æ¯æ¬¡è¾“å…¥å¯†ç éªŒè¯ï¼Œéœ€è¦åœ¨ä¸¤ä¸ªæœåŠ¡å™¨è¿™é—´å»ºç«‹äº’ä¿¡é€šä¿¡ã€‚<br>é¦–å…ˆï¼Œä½¿ç”¨ssh-keygenç”Ÿæˆå¯†é’¥æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­rsaä¸ºä¸€ç§åŠ å¯†æ–¹å¼ï¼Œå¦ä¸€ç§ä¸ºdsa<br>è¿™æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæé†’ä½ è¾“å…¥å¯†é’¥æ–‡ä»¶çš„æ–‡ä»¶åï¼Œé»˜è®¤ä¸º/root/.ssh/id_rsa<br>ç›´æ¥å›è½¦<br>è¿™æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæé†’ä½ è¾“å…¥å¯†ç ã€‚å¦‚æœæƒ³ä»¥åé€šè¿‡è¯¥å¯†é’¥åœ¨ä¸¤å°æœåŠ¡å™¨è¿™é—´é€šä¿¡æ—¶ï¼Œä¸éœ€è¦å†è¾“å…¥å¯†ç çš„è¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±ä¸ç”¨è¾“å…¥ä»»åŠ¡å­—ç¬¦ï¼Œç›´æ¥å›è½¦å°±å¥½ï¼<br>ç³»ç»Ÿä¼šå†ç¡®è®¤ä¸€ä¸‹å¯†ç ï¼Œä»ç„¶å›è½¦ã€‚<br>è¿™æ ·å°±åœ¨/root/.ssh/ç›®å½•ä¸‹ï¼Œç”Ÿæˆäº†id_rsa.pubå’Œid_rsaä¸¤ä¸Šæ–‡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°±è¦å°†id_rsa.pubæ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨çš„/root/.ssh/ç›®å½•ä¸‹ï¼Œé‡å‘½åä¸ºauthorized_keys</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /root/.ssh/id_rsa.pub user@serverip:/root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œè¾“å…¥ç›®æ ‡æœåŠ¡å™¨çš„å¯†ç ï¼Œå¾…æ–‡ä»¶ä¼ è¾“å®Œæˆåå³å¯ã€‚<br>å¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œå·²ç»å­˜åœ¨äº†authorized_keysï¼Œé‚£ä¹ˆå°±å°†id_rsa.pubä¸­çš„å†…å®¹è¿½åŠ åˆ°ç›®æ ‡æœåŠ¡å™¨çš„authorized_keysæ–‡ä»¶ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/.ssh/id_rsa.pub | ssh user@serverip <span class="string">'cat &gt;&gt; /root/.ssh/authorized_keys'</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå†ä½¿ç”¨scpåœ¨è¿™ä¸¤å°æœåŠ¡å™¨è¿™é—´ä¼ è¾“æ–‡ä»¶ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ï¼Œéœ€è¦è¾“å…¥å¯†ç å¤–ï¼Œä»¥åå°±å†ä¹Ÿä¸ç”¨è¾“å…¥å¯†ç éªŒè¯äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="//posts/4a17b156.html"/>
      <url>//posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="http://muyunyun.cn/posts/f55182c5/#more" target="_blank" rel="noopener">hexo æ‘¸çˆ¬æ»šæ‰“ä¹‹è¿›é˜¶æ•™ç¨‹</a></li><li><a href="https://www.v2ex.com/t/298727" target="_blank" rel="noopener">Hexo next ä¸»é¢˜çš„ local search åŠŸèƒ½å¤±æ•ˆï¼Œç‚¹å‡»æœç´¢é“¾æ¥æ— æ³•å¼¹å‡ºå åŠ å±‚</a></li><li><a href="http://blog.csdn.net/huihut/article/details/73196343" target="_blank" rel="noopener">hexo æ„å»ºé™æ€æ–‡ä»¶æ— æ³•ç”Ÿæˆ index.htmlç­‰æ–‡ä»¶</a></li><li><a href="https://zhuanlan.zhihu.com/p/21518843" target="_blank" rel="noopener">Hexoè¿›ç¨‹å®ˆæŠ¤</a></li><li><a href="https://www.jianshu.com/p/4ef35521fee9" target="_blank" rel="noopener">Hexo-Next-ä¸»é¢˜ä¼˜åŒ–</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
